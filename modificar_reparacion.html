<!DOCTYPE html> <!-- --------- INGRESO DE DOCUMENTOS  --------- -->
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario de Documentos</title>
  <script src="dir_formularioapps.js"></script>

  <style>
    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      background-color: #f5f5f7;
      color: #1d1d1f;
      overflow-x: hidden;
    }

    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }

    /* Header styles */
    header {
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      transition: all 0.4s ease;
    }

    .top-header {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px 5%;
      max-width: 1400px;
      margin: 0 auto;
      text-align: center;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .logo img {
      height: 40px;
      transition: transform 0.3s ease;
    }

    .logo:hover img {
      transform: scale(1.05);
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-left: 0;
    }

    .logo-text h1 {
      font-size: 24px;
      font-weight: 600;
      letter-spacing: -0.5px;
    }

    .logo-text span {
      font-size: 12px;
      font-weight: 400;
      color: #86868b;
    }
    
    /* Form container */
    #cont_form {
      max-width: 1100px;
      margin: 40px auto;
      padding: 30px;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      animation: fadeIn 1s ease-in-out;
      text-align: center;
      overflow-x: hidden;
    }

    /* Animaci√≥n de entrada */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Form title */
    .form-title {
      font-size: 28px;
      font-weight: 600;
      color: #1d1d1f;
      margin-bottom: 25px;
      text-align: center;
    }

    /* Labels e inputs */
    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      margin-bottom: 8px;
      text-align: left;
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 15px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      background-color: #ffffff;
      margin-bottom: 15px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: #06c;
      box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.2);
      outline: none;
    }

    input[type="checkbox"] {
      width: 16px;
      height: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      vertical-align: middle;
      margin-right: 8px;
    }

    /* Form section and rows */
    .form-section {
      margin-bottom: 25px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      width: 100%;
      margin-bottom: 15px;
      align-items: flex-start;
    }

    .form-group {
      flex: 1;
      min-width: 200px;
    }

    /* Suggestions styling */
    .color_suggestions {
      color: #06c;
      font-size: 14px;
      margin-top: 5px;
      text-align: left;
    }

    /* Table container */
    .cont_tabla2 {
      max-height: 250px;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 8px;
      display: inline-block;
      width: 100%;
      margin: 15px 0;
      background-color: #fcfcfc;
    }

    /* Buttons */
    .button1,
    .button2,
    .button3 {
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 500;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      margin: 8px;
      min-width: 100px;
    }

    .button1 {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: white;
      box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
    }

    .button1:hover {
      background: linear-gradient(135deg, #219a52, #27ae60);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(46, 204, 113, 0.4);
    }

    .button2 {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
      box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
    }

    .button2:hover {
      background: linear-gradient(135deg, #c0392b, #a93226);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(231, 76, 60, 0.4);
    }

    .button3 {
      background: linear-gradient(135deg, #2980b9, #3498db);
      color: white;
      box-shadow: 0 4px 12px rgba(41, 128, 185, 0.3);
    }

    .button3:hover {
      background: linear-gradient(135deg, #216a9e, #2980b9);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(41, 128, 185, 0.4);
    }

    .btn-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 25px;
    }

    /* Loader styling */
    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loader.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loader-animation {
      width: 80px;
      height: 80px;
      position: relative;
    }

    .loader-circle {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      border: 4px solid transparent;
      border-top-color: #3fdb34;
      animation: spin 1s linear infinite;
    }

    .loader-logo {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 40px;
      opacity: 0.8;
    }

    .loader-message {
      position: absolute;
      bottom: -30px;
      width: 100%;
      text-align: center;
      font-weight: 500;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    #cargandoOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 20px;
      font-family: sans-serif;
      z-index: 9999;
      display: none;
    }

    /* Footer styles */
    footer {
      background-color: #f5f5f7;
      color: #1d1d1f;
      padding: 60px 5%;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      margin-top: 60px;
    }

    .footer-container {
      display: flex;
      justify-content: space-between;
      max-width: 1400px;
      margin: 0 auto;
    }

    .footer-column {
      flex: 1;
      padding: 0 20px;
    }

    .footer-column h3 {
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: 600;
    }

    .footer-column p {
      margin-bottom: 10px;
      color: #86868b;
      font-size: 14px;
    }

    .footer-column ul {
      list-style: none;
    }

    .footer-column ul li {
      margin-bottom: 12px;
    }

    .footer-column a {
      color: #06c;
      text-decoration: none;
      font-size: 14px;
      transition: opacity 0.3s ease;
    }

    .footer-column a:hover {
      opacity: 0.7;
    }

    .footer-bottom {
      max-width: 1400px;
      margin: 40px auto 0;
      padding-top: 20px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      text-align: center;
      font-size: 12px;
      color: #86868b;
    }

    /* Media queries for responsive design */
    @media (max-width: 992px) {
      .footer-container {
        flex-direction: column;
      }

      .footer-column {
        margin-bottom: 40px;
      }
    }

    @media (max-width: 768px) {
      #cont_form {
        padding: 20px 15px;
      }

      .form-group {
        min-width: 100%;
      }

      .button1,
      .button2,
      .button3 {
        width: 90%;
        margin: 5px auto;
        display: block;
      }

      .btn-container {
        flex-direction: column;
      }
    }

    /* Maintain original classes for compatibility */
    .negritas {
      font-weight: bold;
    }

    .azul {
      color: #06c;
    }

    .listo {
      color: #2ecc71;
      font-weight: bold;
    }

    #spinner-container {
      display: none;
    }
  </style>
</head>

<body>
  <!-- Loader -->
  <div class="loader">
    <div class="loader-animation">
      <div class="loader-circle"></div>
      <img src="logo_MUNI.png" alt="Logo" class="loader-logo">
      <div class="loader-message">Cargando...</div>
    </div>
  </div>

  <!-- Header -->
  <header>
    <div class="top-header">
      <div class="logo">
        <img src="logo_MUNI.png" alt="Logo Municipalidad de Arica">
        <div class="logo-text">
          <h1>ARICA</h1>
          <span>MUNICIPALIDAD | mejor ciudad</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Form Container -->
  <div id="cont_form">
    <form id="formulario">
      <div id="cargandoOverlay">Cargando archivos...<br>Por favor espere</div>

      <h2 class="form-title">Modificar Registros</h2>

      <div class="form-section">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">A√±o</label>
            <select id="numAnio" name="numAnio" class="form-select" onclick="borrar_div(0)">
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">N¬∞ de Control</label>
            <input type="text" id="ident" name="ident" class="form-control" placeholder="Ingresa N¬∞ control"
              oninput="showSuggestionsNumer()">
            <div class="color_suggestions" id="suggestionsNumber"></div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Patente</label>
            <input type="text" class="form-control" id="patente" name="patente" placeholder="Ingresa la Patente"
              oninput="showSuggestionsPatente()">
            <div class="color_suggestions" id="suggestionsPatente"></div>
          </div>

          <div class="form-group">
            <label class="form-label">Direcci√≥n</label>
            <input type="text" class="form-control" id="direccion" name="direccion" placeholder="Ingresa la direcci√≥n"
              oninput="showSuggestionsDireccion()">
            <div class="color_suggestions" id="suggestionsDireccion"></div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Conductor</label>
            <input type="text" class="form-control" id="conductor" name="conductor" placeholder="Ingresa el conductor"
              oninput="showSuggestionsConductor()">
            <div class="color_suggestions" id="suggestionsConductor"></div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Sistema Afectado</label>
            <select class="form-select" name="sistema" id="sistema" onchange="selectTipoFalla()">
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Tipo de Falla</label>
            <select class="form-select" name="tipoFalla" id="tipoFalla">
            </select>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Trabajos a Realizar</label>
            <input type="text" class="form-control" id="jobType" name="jobType" placeholder="Describe el tipo de trabajo a realizar"
              oninput="showSuggestionsTrabajo()">
            <div class="color_suggestions" id="suggestionsTrabajo"></div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Operario</label>
            <input type="text" class="form-control" id="operario" name="operario" placeholder="Ingresa el operario"
              oninput="showSuggestionsOperario()">
            <div class="color_suggestions" id="suggestionsOperario"></div>
          </div>
        </div>
      </div>

      <div class="btn-container">
        <button class="button1" type="button" onclick="TabularDatos()">BUSCAR</button>
        <button class="button3" type="button" onclick="limpiarInputs()">LIMPIAR</button>
      </div>

      <div class="cont_tabla2" id="tabla-container2"></div>

      <div id="div_s1" hidden class="btn-container">
        <button class="button1" type="button" onclick="guardarDatos()">GUARDAR</button>
        <button class="button3" type="button" onclick="limpiarDatos()">LIMPIAR</button>
        <button class="button2" id="butt1" type="button" onclick="cerrarForm()">CERRAR</button>
      </div>

      <div id="div_s2" class="btn-container">
        <button class="button2" id="butt2" type="button" onclick="cerrarForm()">CERRAR</button>
      </div>
    </form>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-column">
        <h3>Municipalidad de Arica</h3>
        <p>Renato Rocca, Arica</p>
        <p>Anexo: 6959</p>
        <p>Email: roberto.mamani@municipalidadarica.cl</p>
        <div class="social-icons">
          <a href="#">üìò</a>
          <a href="#">üì±</a>
          <a href="#">üê¶</a>
          <a href="#">üì∏</a>
        </div>
      </div>
      <div class="footer-column">
        <h3>Colaboraci√≥n Interdepartamental</h3>
        <p style="line-height: 1.6;">
          Este proyecto surge con el prop√≥sito de fortalecer la colaboraci√≥n entre diversas √°reas municipales, como <strong>iluminaci√≥n p√∫blica</strong>, <strong>Of. Mantenimiento de Veh√≠culos y Maquinaria</strong>, <strong>Aseo y Ornato</strong>, <strong>Asesor√≠a Tecnica</strong> y m√°s, en un solo sistema integral.
          Buscando consolidar la informaci√≥n y los procesos en un solo sistema, permitiendo un <strong>mayor control operativo</strong>, <strong>gesti√≥n por √°reas</strong> y una visi√≥n integral para la <strong>mejora continua de los servicios municipales</strong>.
        </p>
      </div>
      <div class="footer-column licitaciones">
        <h3>Licitaciones</h3>
        <ul class="licitaciones-list">
          <li><a href="licitacion_agil.html">Licitaci√≥n √Ågil</a></li>
          <li><a href="licitacion_gran_compra.html">Gran Compra</a></li>
          <li><a href="licitacion_trato_directo.html">Trato Directo</a></li>
          <li><a href="licitacion_publica.html">Licitaci√≥n P√∫blica</a></li>
          <li><a href="licitacion_convenio_marco.html">Convenio Marco</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>¬© 2025 Municipalidad de Arica. Todos los derechos reservados.</p>
      <p>Desarrollado por Junior Barrera</p>
    </div>
  </footer>

  <script>
    function ocultarLoader() {
      const loader = document.querySelector('.loader');
      loader.classList.add('hidden');
      setTimeout(function () {
        loader.style.display = 'none';
      }, 500);
    }

    function mostrarSpinner() {
      mostrarLoader();
    }

    function ocultarSpinner() {
      ocultarLoader();
    }

    function actualizarMensajeLoader(mensaje) {
      const mensajeElement = document.querySelector('.loader-message');
      if (mensajeElement) {
        mensajeElement.textContent = mensaje;
      }
    }

    // C√≥digo del loader
    document.addEventListener('DOMContentLoaded', function () {
      // Ocultar el loader cuando la p√°gina termine de cargar
      window.addEventListener('load', function () {
        // A√±adir la clase hidden para activar la transici√≥n
        document.querySelector('.loader').classList.add('hidden');

        // Eliminar completamente despu√©s de la transici√≥n
        setTimeout(function () {
          document.querySelector('.loader').style.display = 'none';
        }, 500);
      });
    });
  </script>

  <script>

    function ocultarLoader() {
      const loader = document.querySelector('.loader');
      loader.classList.add('hidden');
      setTimeout(function () {
        loader.style.display = 'none';
      }, 500);
    }

    // Reemplazar las funciones existentes que controlan el spinner
    function mostrarSpinner() {
      mostrarLoader();
    }

    function ocultarSpinner() {
      ocultarLoader();
    }

    // Si quieres cambiar el mensaje del loader
    function actualizarMensajeLoader(mensaje) {
      const mensajeElement = document.querySelector('.loader-message');
      if (mensajeElement) {
        mensajeElement.textContent = mensaje;
      }
    }
  </script>
  <!-- Script para el loader -->
  <script>
    // C√≥digo del loader (puedes moverlo a un archivo externo)
    document.addEventListener('DOMContentLoaded', function () {
      // Ocultar el loader cuando la p√°gina termine de cargar
      window.addEventListener('load', function () {
        // A√±adir la clase hidden para activar la transici√≥n
        document.querySelector('.loader').classList.add('hidden');

        // Eliminar completamente despu√©s de la transici√≥n
        setTimeout(function () {
          document.querySelector('.loader').style.display = 'none';
        }, 500);
      });
    });
  </script>


  <script>


    var num_fil = new Array();

    var separa7 = " - ";

    var caractCheck = "‚úì";
    var listCheck = "";
    var ultimoId = "";

    var form_anio = "";
    var form_unid = "";
    var form_ncta = "";
    var form_desc = "";
    var form_pryt = "";
    var form_cmpr = "";

    var cmpr_tt = 0;          // Valor de la columna comprometido (Total de la cta)
    var cmpr_tx = "";         // Valor de la columna comprom-ID (valor de cada uno)
    var gast_tt = 0;          // Valor de la columna Gasto (Total de la cta)
    var gast_tx = "";         // Valor de la columna gasto-ID (valor de cada uno)
    var sald_tt = 0;          // Valor de la columna Saldo (Total de la cta)

    var separa1 = "&nbsp;";
    var separa5 = "/";        // Separador entre datos de los unitarios

    var fila_dt = 0;
    var fila_pac = 0;

    const anioActual = new Date().getFullYear();
    var este_anio = parseInt(anioActual);

    var maxDoc = "";
    var nnleer = 0;
    var nuevas = 0;
    var permiso = new Array();              // Permiso de la oficina (ejemplo: VMQ)
    permiso[0] = "";

    var xcompr = new Array();

    var antigu = new Array();              // Array con todos los datos originales
    var nuevod = new Array();              // Array con todos los datos incluidos los modificados

    var selec0 = "-- INGRESAR --";
    var permisott = "";

    var colmcta = 0;                        // Columna de Anex 1a donde esta el N¬∞ de cuenta & descripcion

    var chck1 = 0;                          // Check button para modificar registros

    var gast0 = "0/0/0/0/0/0/0/0/0/0";      // Valor inicial del Comprometido y del Gastado por cada compra

    var dat_PAT = new Array();      // Todos los datos de la hoja PATENTES
    var dato_dt = new Array();      // Todos los datos de la hoja DATOS
    var dato_v1 = new Array();      // Todos los datos de la hoja VARIABLE1
    var dato_v2 = new Array();      // Todos los datos de la hoja VARIABLE2

    var tipNumer = new Array();      // Tipos de N¬∞ de Control
    var tipTraba = new Array();      // Tipos de Trabajos
    var tipPaten = new Array();      // Listado de Patentes
    var tipDirec = new Array();      // Listado de Direcciones
    var tipOpera = new Array();      // Listado de Operarios
    var tipCondu = new Array();      // Listado de Conductores

    var suggest = new Array();
    suggest = ["suggestionsDocument", "suggestionsDescripc", "suggestionsCuentas"];

    var sel_dept = "";                      // Seleccionar el tipo de DEPTO


    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby_bjwOglJAYSCYSA24UhC_mBz0U0hI0pJPWo8oZyNryy9Uat6nRZ4D-9v-8x6Cy_OU/exec";     // Implementacion
    // const WEB_APP_URL = dir_pac;

    cargarDatosGenerales();       // Activar la rueda de LOADING ....

    // ************************************************************************
    // ************************************************************************


    function mostrarToast(tmensaje, tcolor) {
      var toast = document.getElementById('toast1');
      toast.textContent = tmensaje;
      toast.style.backgroundColor = tcolor;
      toast.className = "show";
      setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
    }


    function guardarDatos() {

      var pp = 0;
      var error = 0;
      var tx_err = new Array();

      if (error == 0) {

        baul_compra = 0;
        for (ii = 0; ii < antigu.length; ii++) {
          baul1 = (antigu[ii][5]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baul2 = (antigu[ii][6]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baul3 = (antigu[ii][7]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baul4 = (antigu[ii][8]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baul5 = (antigu[ii][12]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baul6 = (antigu[ii][14]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          antigu[ii][5] = baul1.toString();
          antigu[ii][6] = baul2.toString();
          antigu[ii][7] = baul3.toString();
          antigu[ii][8] = baul4.toString();
          antigu[ii][12] = baul5.toString();
          antigu[ii][14] = baul6.toString();
          var baulm = new Array();
          for (jj = 0; jj < antigu[0].length; jj++) {
            baulm[jj] = (document.getElementById("info[" + ii + "][" + jj + "]").value).toString();
          }
          taman = antigu[0].length;
          fila_pac = num_fil[ii];
          baulm[taman + 0] = (dat_PAC[fila_pac][taman + 0]).toString();
          baulm[taman + 1] = (dat_PAC[fila_pac][taman + 1]).toString();
          baulm[taman + 2] = (dat_PAC[fila_pac][taman + 2]).toString();
          baulm[taman + 3] = (dat_PAC[fila_pac][taman + 3]).toString();
          baulm[taman + 4] = (dat_PAC[fila_pac][taman + 4]).toString();
          baulm[5] = (baulm[5]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baulm[6] = (baulm[6]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baulm[7] = (baulm[7]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baulm[8] = (baulm[8]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baulm[12] = (baulm[12]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baulm[14] = (baulm[14]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baulm[17] = (baulm[17]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baulm[19] = (baulm[19]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          baulm[21] = (baulm[21]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
          nuevod.push(baulm);
        }

        var baulfila = 0;
        yy = 0;
        for (ii = 0; ii < antigu.length; ii++) {
          pp = 0;
          baulfila = -1;
          for (jj = 0; jj < antigu[0].length; jj++) {
            if (antigu[ii][jj] !== nuevod[ii][jj]) {
              baulfila = num_fil[ii] + 1;
              pp++;
              yy++;
              break;         // Si hay una diferencia se sale
            }
          }


          // %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
          // %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
          // %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


          if (pp > 0) {      //Guarda la fila diferente
            dat_PAC[num_fil[ii]] = nuevod[ii];
            enviarDatos("PAC", baulfila, nuevod[ii], 1);
          }
        }
        if (yy == 0) {
          alert("No hay ningun registro por modificar");
        }
        if (yy > 0) {
          alert("Felicidades, se modificaron " + yy + " registros.");
          chck1 = 0;
          // modificar_chck();
        }
        yy = 0;

      } else {
        baul = "";
        for (ii = 0; ii < tx_err.length; ii++) { baul = baul + "\n" + tx_err[ii]; }
        alert("Faltan los siguientes datos por completar:" + baul);
      }

    }



    function enviarDatos(pagina, fila, datos, tipo) {

      fetch(WEB_APP_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ pagina, fila, datos, tipo })
      })
        .then(() => {
          // mostrarToast('Datos enviados exitosamente üéâ', '#27ae60');
          // alert('Datos enviados exitosamente');
          document.getElementById("cargandoOverlay").style.display = "none";     // Ocultar mensaje Cargando ...
          ingresar_compra1();
          window.scrollTo({ top: 0, behavior: 'smooth' });                       // Scroll al inicio con animacion                                            // Scroll sin animaci√≥n
        })
        .catch(error => {
          // console.error('Error al enviar datos:', error);
          // mostrarToast('Error al enviar los datos.', '#e74c3c');
          alert('Error al enviar los datos');
        })
        .finally(() => {
        });

    }



    function limpiarDatos() { location.reload(); }



    function borrar_div(nn) {
      if (nn > 0) {
        for (jj = 0; jj < suggest.length; jj++) {
          if ((jj + 1) != nn) { document.getElementById(suggest[jj]).innerHTML = ""; }
        }
      }
      if (nn == 0) {
        for (jj = 0; jj < suggest.length; jj++) { document.getElementById(suggest[jj]).innerHTML = ""; }
      }
    }



    function cargando_icon(nn) {        // Rueda de carga (LOADING ...)
      const spinner = document.getElementById('spinner-container');
      if (nn === 1) {
        spinner.style.display = 'block';
      } else {
        spinner.style.display = 'none';
      }
    }


    // ************************************************************************
    // ************************************************************************


    var select = document.getElementById("numAnio");
    select.innerHTML = "";
    var delta = 1;
    for (jj = 0; jj < 4; jj++) {
      if (jj == 0) {
        let option = document.createElement('option');
        option.value = "0";
        option.text = selec0;
        select.appendChild(option);
      }
      baul = ((este_anio + delta) - jj);
      let option = document.createElement('option');
      option.value = (baul).toString();
      option.text = (baul).toString();
      select.appendChild(option);
    }
    form_anio = (este_anio).toString();
    select.value = form_anio;



    function cargarDatosGenerales() {

      aanum = 0;
      fetch(WEB_APP_URL + "?h=PD12")           // Lee las hojas PAC, REGISTRO y Anexo
        .then(response => response.json())
        .then(data => {
          // Asigna los datos recibidos a las variables bidimensionales
          dat_PATx = data.dat_PAT;    // Datos de la hoja "PATENTE"
          dato_dtx = data.dato_dt;    // Datos de la hoja "Datos"
          dato_v1x = data.dato_v1;    // Datos de la hoja "Variable1"
          dato_v2x = data.dato_v2;    // Datos de la hoja "Variable2"

          if (dat_PATx.length > 0) {
            baul_n1 = new Array();
            for (ii = 0; ii < dat_PATx.length; ii++) {
              if (dat_PATx[ii][0] == "") { break; }
              if (ii > 0) {
                jj = ii - 1;
                tipPaten[jj] = dat_PATx[ii][0];    // Columna A
                baul_n1[jj] = dat_PATx[ii][3];    // Columna D
                dat_PAT[jj] = dat_PATx[ii];
              }
            }
            tipDirec = [...new Set(baul_n1)];
          }
          if (dato_dtx.length > 0) {
            for (ii = 0; ii < dato_dtx.length; ii++) {
              if (dato_dtx[ii][0] == "") { break; }
              dato_dt[ii] = dato_dtx[ii];
              tipNumer[ii] = dato_dt[ii][0];    // Columna A
              if (ii > 0) {
                dato_dt[ii][0] = dato_dt[ii][0].replace(/\./g, '').replace(/\D/g, '');
                dato_dt[ii][4] = dato_dt[ii][4].replace(/\./g, '').replace(/\D/g, '');
                dato_dt[ii][15] = dato_dt[ii][15].replace(/\./g, '').replace(/\D/g, '');
                dato_dt[ii][20] = dato_dt[ii][20].replace(/\./g, '').replace(/\D/g, '');
                dato_dt[ii][21] = dato_dt[ii][21].replace(/\./g, '').replace(/\D/g, '');
              }
            }

          }
          if (dato_v1x.length > 0) {
            for (ii = 0; ii < dato_v1x.length; ii++) {
              pp = 0;
              for (jj = 0; jj < 22; jj++) {
                if (dato_v1x[ii][jj] != "") { pp++; break; }
              }
              if (pp > 0) { dato_v1[ii] = dato_v1x[ii]; }
              if (pp == 0) { break; }
            }
          }

          if (dato_v2x.length > 0) {
            for (ii = 0; ii < dato_v2x.length; ii++) {
              if (dato_v2x[ii][0] == "") { break; }
              if (ii > 0) {
                jj = ii - 1;
                tipOpera[jj] = dato_v2x[ii][0];    // Columna A
                tipCondu[jj] = dato_v2x[ii][1];    // Columna B
                tipTraba[jj] = dato_v2x[ii][2];    // Columna C
                dato_v2[jj] = dato_v2x[ii];
              }
            }
          }
          pp = 0;

          if ((dat_PAT.length > 0) && (dato_dt.length > 0) && (dato_v1.length > 0) && (dato_v2.length > 0)) {

            pp = 0;
            var select = document.getElementById("sistema");
            select.innerHTML = "";
            for (jj = 0; jj < dato_v1[0].length; jj++) {
              if (dato_v1[0][jj] == "") { break; }
              if (jj == 0) {
                let option = document.createElement('option');
                option.value = "0";
                option.text = "Ingresa Sistema";
                select.appendChild(option);
              }
              let option = document.createElement('option');
              option.value = (jj + 1).toString();
              option.text = dato_v1[0][jj];
              select.appendChild(option);
            }
            select.value = "0";

            var select = document.getElementById("tipoFalla");
            select.innerHTML = "";
            let option = document.createElement('option');
            option.value = "0";
            option.text = "Ingresa tipo de Falla";
            select.appendChild(option);
            select.value = "0";
          }

        })
        .catch(error => {
          console.error('Error al obtener los datos:', error);
        });
    }


    // *****************************************************************
    // *****************************************************************


    function limpiarInputs() {
      document.getElementById("ident").value = "";
      document.getElementById("numAnio").value = (este_anio).toString();
      document.getElementById("patente").value = "";
      document.getElementById("direccion").value = "";
      document.getElementById("sistema").value = "0";
      document.getElementById("tipoFalla").value = "0";
      document.getElementById("jobType").value = "";

      tablaContainer = document.getElementById('tabla-container2');
      tablaContainer.innerHTML = "";         // Limpia la tabla de datos

      document.getElementById("div_s1").setAttribute("hidden", "");
      document.getElementById("div_s2").removeAttribute("hidden");
    }


    function selectTipoFalla() {

      var select = document.getElementById("sistema");
      if (select.value != "0") {
        baul = parseInt(select.value) - 1;
        var select = document.getElementById("tipoFalla");
        select.innerHTML = "";
        for (jj = 0; jj < dato_v1.length; jj++) {
          if (dato_v1[jj][baul] == "") { break; }
          if (jj == 0) {
            let option = document.createElement('option');
            option.value = "0";
            option.text = "Ingresa tipo de Falla";
            select.appendChild(option);
          }
          let option = document.createElement('option');
          option.value = dato_v1[jj][baul];
          option.text = dato_v1[jj][baul];
          select.appendChild(option);
        }
        select.value = "0";
      }
    }


    // ####################################################################################
    // ####################################################################################


    function TabularDatos() {

      tablaContainer = document.getElementById('tabla-container2');
      tablaContainer.innerHTML = "";         // Limpia la tabla de datos

      pp = 0;

      antigu.length = 0;                     // Limpia la variable antigu
      num_fil.length = 0;        // Limpia la variable num_fil

      baul1 = document.getElementById("numAnio").value.toString().toUpperCase();     // Numero del a√±o
      baul2 = document.getElementById("ident").value.toString().toUpperCase();       // Numero del ID del registro
      baul3 = document.getElementById("patente").value.toString().toUpperCase();     // Patente
      baul4 = document.getElementById("direccion").value.toString().toUpperCase();   // Direccion
      baul5 = document.getElementById("conductor").value.toString().toUpperCase();   // Conductor
      baul6 = document.getElementById("sistema").value.toString().toUpperCase();     // Sistema de la falla
      baul7 = document.getElementById("tipoFalla").value.toString().toUpperCase();   // Tipo de falla
      baul8 = document.getElementById("jobType").value.toString().toUpperCase();     // Descripcion del trabajo
      baul9 = document.getElementById("operario").value.toString().toUpperCase();     // Descripcion del trabajo

      table = "<table border=1><thead><tr>";
      colum_dat = 0;
      for (jj = 0; jj < dato_dt[0].length; jj++) {
        if (dato_dt[0][jj] == "") { break; }
        table += "<th>" + dato_dt[0][jj] + "</th>";
        colum_dat++;
      }
      table += "</tr></thead><tbody>";

      for (ii = 1; ii < dato_dt.length; ii++) {

        if (dato_dt[ii][0] == "") { break; }

        var ss1 = 0; var ss2 = 0; var ss3 = 0; var ss4 = 0;
        var ss5 = 0; var ss6 = 0; var ss7 = 0; var ss8 = 0;
        var ss9 = 0;

        if (baul1 == "0") { ss1 = 1; }
        if (ss1 == 0) {
          var baulfch = new Array();
          baulfch = ((dato_dt[ii][1]).toString()).split("/");
          if (baul1 == (baulfch[2]).toString()) { ss1 = 1; }
        }

        if (ss1 > 0) {
          if (baul2 == "") { ss2 = 1; }
          if (baul2 == dato_dt[ii][0].toString().toUpperCase()) { ss2 = 1; }
        }

        if (ss2 > 0) {
          if (baul3 == "") { ss3 = 1; }
          if (baul3 == dato_dt[ii][3].toString().toUpperCase()) { ss3 = 1; }
        }

        if (ss3 > 0) {
          if (baul4 == "") { ss4 = 1; }
          if (baul4 == dato_dt[ii][7].toString().toUpperCase()) { ss4 = 1; }
        }

        if (ss4 > 0) {
          if (baul5 == "") { ss5 = 1; }
          if (baul5 == dato_dt[ii][9].toString().toUpperCase()) { ss5 = 1; }
        }

        if (ss5 > 0) {
          if ((baul6 == "") || (baul6 == "0")) { ss6 = 1; }
          if (baul6 == dato_dt[ii][12].toString().toUpperCase()) { ss6 = 1; }
        }

        if (ss6 > 0) {
          if ((baul7 == "") || (baul7 == "0")) { ss7 = 1; }
          if (baul7 == dato_dt[ii][10].toString().toUpperCase()) { ss7 = 1; }
        }

        if (ss7 > 0) {
          if (baul8 == "") { ss8 = 1; }
          if (ss8 == 0) {
            baulaa = (dato_dt[ii][14].toString() + " " + dato_dt[ii][17].toString()).toUpperCase();
            if (baulaa.includes(baul8)) { ss8 = 1; }
          }
        }

        if (ss8 > 0) {
          if (baul9 == "") { ss9 = 1; }
          if (baul9 == dato_dt[ii][13].toString().toUpperCase()) { ss9 = 1; }
        }

        if ((ss1 * ss2 * ss3 * ss4 * ss5 * ss6 * ss7 * ss8 * ss9) > 0) {

          table += "<tr>"
          var bbnada = new Array();
          for (jj = 0; jj < colum_dat; jj++) {
            cofre1 = dato_dt[ii][jj];
            cofre2 = "";
            btype = "text";
            kk = 0;
            if ((jj == 1) || (jj == 18) || (jj == 19)) { kk = 1; }
            if ((jj == 4) || (jj == 20) || (jj == 21)) { kk = 2; }
            if (kk == 1) { btype = "date"; cofre1 = oficesarFechaTexto(cofre1); }
            if (kk == 2) { cofre1 = formatearNumero2(cofre1); cofre2 = "oninput='formatearNumero(this)'"; }
            table += "<td>" + "<input type='" + btype + "' id='info[" + pp + "][" + jj + "]' value='" + cofre1 + "' " + cofre2 + "></td>";
            bbnada[jj] = dato_dt[ii][jj];
          }
          antigu.push(bbnada);
          num_fil[pp] = ii;
          table += "</tr>";

          pp++;

        }
      }

      if (pp > 0) {
        table += "</tbody></table>"
        tablaContainer = document.getElementById('tabla-container2');
        tablaContainer.innerHTML = table;         // Escribe la tabla de datos
      }

      document.getElementById("div_s2").setAttribute("hidden", "");
      document.getElementById("div_s1").removeAttribute("hidden");
    }


    // ************************************************************************
    // ************************************************************************


    function cerrarForm() {
      // window.close();
      // window.history.back();
      location.href = "formulario-1.html";
    }


    // ***************************************************************************************************************
    // ***************************************************************************************************************

    function showSuggestionsNumer() {
      const input = document.getElementById("ident").value.toLowerCase();
      const suggestionsDiv = document.getElementById("suggestionsNumber");
      suggestionsDiv.innerHTML = '';  // Limpiar sugerencias anteriores

      if (input) {
        const filteredNumb = tipNumer.filter(numb => numb.toLowerCase().includes(input));

        filteredNumb.forEach(numb => {
          const suggestionItem = document.createElement("div");
          suggestionItem.textContent = numb;
          suggestionItem.onclick = () => selectNum(numb);
          suggestionsDiv.appendChild(suggestionItem);
        });
      }
    }

    function selectNum(numb) {
      document.getElementById("ident").value = numb;
      document.getElementById("suggestionsNumber").innerHTML = '';  // Limpiar las sugerencias una vez seleccionado
    }

    // ***************************************************************************************************************

    function showSuggestionsTrabajo() {
      const input = document.getElementById("jobType").value.toLowerCase();
      const suggestionsDiv = document.getElementById("suggestionsTrabajo");
      suggestionsDiv.innerHTML = '';  // Limpiar sugerencias anteriores

      if (input) {
        const filteredJobs = tipTraba.filter(job => job.toLowerCase().includes(input));

        filteredJobs.forEach(job => {
          const suggestionItem = document.createElement("div");
          suggestionItem.textContent = job;
          suggestionItem.onclick = () => selectJob(job);
          suggestionsDiv.appendChild(suggestionItem);
        });
      }
    }

    function selectJob(job) {
      document.getElementById("jobType").value = job;
      document.getElementById("suggestionsTrabajo").innerHTML = '';  // Limpiar las sugerencias una vez seleccionado
    }

    // ***************************************************************************************************************

    function showSuggestionsPatente() {
      const input = document.getElementById("patente").value.toLowerCase();
      const suggestionsDiv = document.getElementById("suggestionsPatente");
      suggestionsDiv.innerHTML = '';  // Limpiar sugerencias anteriores

      if (input) {
        const filteredJobs = tipPaten.filter(paten => paten.toLowerCase().includes(input));

        filteredJobs.forEach(paten => {
          const suggestionItem = document.createElement("div");
          suggestionItem.textContent = paten;
          suggestionItem.onclick = () => selectPaten(paten);
          suggestionsDiv.appendChild(suggestionItem);
        });
      }
    }

    function selectPaten(paten) {
      document.getElementById("patente").value = paten;
      document.getElementById("suggestionsPatente").innerHTML = '';     // Limpiar las sugerencias una vez seleccionado
    }

    // ***************************************************************************************************************

    function showSuggestionsConductor() {
      const input = document.getElementById("conductor").value.toLowerCase();
      const suggestionsDiv = document.getElementById("suggestionsConductor");
      suggestionsDiv.innerHTML = '';  // Limpiar sugerencias anteriores

      if (input) {
        const filteredJobs = tipCondu.filter(condu => condu.toLowerCase().includes(input));

        filteredJobs.forEach(condu => {
          const suggestionItem = document.createElement("div");
          suggestionItem.textContent = condu;
          suggestionItem.onclick = () => selectCond(condu);
          suggestionsDiv.appendChild(suggestionItem);
        });
      }
    }

    function selectCond(condu) {
      document.getElementById("conductor").value = condu;
      document.getElementById("suggestionsConductor").innerHTML = '';   // Limpiar las sugerencias una vez seleccionado
    }

    // ***************************************************************************************************************

    function showSuggestionsOperario() {
      const input = document.getElementById("operario").value.toLowerCase();
      const suggestionsDiv = document.getElementById("suggestionsOperario");
      suggestionsDiv.innerHTML = '';  // Limpiar sugerencias anteriores

      if (input) {
        const filteredJobs = tipOpera.filter(opera => opera.toLowerCase().includes(input));

        filteredJobs.forEach(opera => {
          const suggestionItem = document.createElement("div");
          suggestionItem.textContent = opera;
          suggestionItem.onclick = () => selectOpera(opera);
          suggestionsDiv.appendChild(suggestionItem);
        });
      }
    }

    function selectOpera(opera) {
      document.getElementById("operario").value = opera;
      document.getElementById("suggestionsOperario").innerHTML = '';   // Limpiar las sugerencias una vez seleccionado
    }

    // ***************************************************************************************************************

    function showSuggestionsDireccion() {
      const input = document.getElementById("direccion").value.toLowerCase();
      const suggestionsDiv = document.getElementById("suggestionsDireccion");
      suggestionsDiv.innerHTML = '';  // Limpiar sugerencias anteriores

      if (input) {
        const filteredJobs = tipDirec.filter(dir => dir.toLowerCase().includes(input));

        filteredJobs.forEach(dir => {
          const suggestionItem = document.createElement("div");
          suggestionItem.textContent = dir;
          suggestionItem.onclick = () => selectDir(dir);
          suggestionsDiv.appendChild(suggestionItem);
        });
      }
    }
    function selectDir(dir) {
      document.getElementById("direccion").value = dir;
      document.getElementById("suggestionsDireccion").innerHTML = '';   // Limpiar las sugerencias una vez seleccionado
    }

    // #############################################################

    function obtenerFechaActual() {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0'); // Mes en formato 2 d√≠gitos
      const day = String(today.getDate()).padStart(2, '0'); // D√≠a en formato 2 d√≠gitos
      return `${year}-${month}-${day}`;
    }
    function updateSelect() {
      valorin = document.getElementById("movimiento").value;
      if (valorin == "ENTRADA/SALIDA") {
        document.getElementById('dias').value = "1";
        document.getElementById('dias').setAttribute('readonly', true);
      } else {
        document.getElementById('dias').removeAttribute('readonly');
      }
    }

    // ************************************************************************

    function formatearNumero(input) {
      // Eliminar puntos y caracteres no num√©ricos
      let valor = input.value.replace(/\./g, '').replace(/\D/g, '');
      // Convertir a n√∫mero y formatear con puntos
      let numeroFormateado = new Intl.NumberFormat('es-ES').format(valor);
      // Actualizar el valor del input con el formato correcto
      input.value = numeroFormateado;
    }


    function formatearNumero2(valor1) {
      // Eliminar puntos y caracteres no num√©ricos
      let valor2 = valor1.replace(/\./g, '').replace(/\D/g, '');
      // Convertir a n√∫mero y formatear con puntos
      let numeroFormateado = new Intl.NumberFormat('es-ES').format(valor2);
      // Actualizar el valor del input con el formato correcto
      return numeroFormateado;
    }

    // ###############################################################################


    // Pasar la fecha de TEXTO DD/MM/YYYY a una FECHA YYYY-MM-DD (DATE)
    function oficesarFechaTexto(fechaTexto) {
      const partes = fechaTexto.split('/');
      if (partes.length !== 3) return null; // Verifica que el formato sea correcto

      const dia2 = partes[0].padStart(2, '0');  // Asegura 2 d√≠gitos para el d√≠a
      const mes2 = partes[1].padStart(2, '0');  // Asegura 2 d√≠gitos para el mes
      const ano2 = partes[2].padStart(4, '0');  // Asegura 4 d√≠gitos para el a√±o

      // Devuelve la fecha en formato YYYY-MM-DD
      return `${ano2}-${mes2}-${dia2}`;
    }

    // *******************************************************************************

    // Pasar la fecha de un DATE YYY-MM-DD a un texto en formato DD/MM/YYYY
    function transformarFecha(fechaInput) {
      if (!fechaInput) {
        console.log("No se seleccion√≥ una fecha.");
        return null;
      }

      // Crear un objeto de fecha a partir del valor del input (YYYY-MM-DD)
      const fecha1 = new Date(fechaInput);
      fecha1.setHours(fecha1.getHours() + 12);

      // Extraer d√≠a, mes y a√±o, asegurando 2 d√≠gitos para d√≠a y mes y 4 digitos para el a√±o
      const dia1 = String(fecha1.getDate()).padStart(2, '0');
      const mes1 = String(fecha1.getMonth() + 1).padStart(2, '0');   // Los meses empiezan en 0
      const ano1 = String(fecha1.getFullYear());

      // Formatear la fecha como DD/MM/YYYY
      const fechaTexto = `${dia1}/${mes1}/${ano1}`;
      return fechaTexto;
    }


    // *******************************************************************************


    function borrar_div(nn) { }



  </script>

</body>

</html>