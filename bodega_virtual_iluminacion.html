<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bodega Virtual - Iluminaci√≥n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f7;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            text-align: center;
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            text-align: center;
            color: #718096;
            font-size: 1.1em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #4a5568;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        .warehouse-map {
            background: linear-gradient(135deg, #e2e8f0 0%, #f7fafc 100%);
            border: 3px solid #4a5568;
            border-radius: 15px;
            padding: 15px;
            height: 500px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Elementos estructurales de la bodega */
        .wall {
            position: absolute;
            background: #2d3748;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }

        .wall-top { top: 0; left: 0; width: 100%; height: 8px; }
        .wall-bottom { bottom: 0; left: 0; width: 100%; height: 8px; }
        .wall-left { top: 0; left: 0; width: 8px; height: 100%; }
        .wall-right { top: 0; right: 0; width: 8px; height: 100%; }

        .aisle {
            position: absolute;
            background: repeating-linear-gradient(
                90deg,
                #cbd5e0 0px,
                #cbd5e0 2px,
                #e2e8f0 2px,
                #e2e8f0 20px
            );
            border: 1px dashed #a0aec0;
        }

        .main-aisle { top: 180px; left: 15px; width: calc(100% - 30px); height: 40px; }
        .vertical-aisle { top: 15px; left: 180px; width: 40px; height: 150px; }
        .vertical-aisle-2 { top: 15px; left: 280px; width: 40px; height: 150px; }
        .side-aisle { top: 240px; left: 15px; width: calc(100% - 30px); height: 30px; }

        .loading-dock {
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 80px;
            height: 40px;
            background: linear-gradient(45deg, #f56565, #e53e3e);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 10px;
            box-shadow: 0 2px 8px rgba(229, 62, 62, 0.3);
        }

        .office {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 60px;
            height: 50px;
            background: linear-gradient(45deg, #48bb78, #38a169);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 9px;
            box-shadow: 0 2px 8px rgba(72, 187, 120, 0.3);
        }

        /* Estanter√≠as realistas */
        .shelf {
            position: absolute;
            background: linear-gradient(45deg, #4a5568, #2d3748);
            border: 2px solid #1a202c;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 11px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .shelf::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #e2e8f0, #cbd5e0, #e2e8f0);
            border-radius: 3px 3px 0 0;
        }

        .shelf::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #e2e8f0, #cbd5e0, #e2e8f0);
            border-radius: 0 0 3px 3px;
        }

        .shelf:hover {
            background: linear-gradient(45deg, #667eea, #764ba2);
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .shelf.selected {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
        }

        /* Elementos editables */
        .editable {
            cursor: move;
            user-select: none;
            border: 2px dashed transparent;
            transition: all 0.2s ease;
        }

        .editable:hover {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .editable.dragging {
            opacity: 0.8;
            transform: scale(1.05);
            z-index: 1000;
            border-color: #e53e3e;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #667eea;
            border: 2px solid white;
            border-radius: 50%;
            cursor: nw-resize;
            display: none;
        }

        .resize-handle.bottom-right {
            bottom: -5px;
            right: -5px;
        }

        .editable:hover .resize-handle,
        .editable.selected .resize-handle {
            display: block;
        }

        .edit-controls {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            border: 1px solid #667eea;
        }

        .edit-mode-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .edit-mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .edit-mode-btn.active {
            background: linear-gradient(45deg, #e53e3e, #c53030);
        }

        .save-layout-btn {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .save-layout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        .reset-layout-btn {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .reset-layout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.4);
        }

        .edit-instructions {
            margin-top: 10px;
            font-size: 12px;
            color: #4a5568;
            line-height: 1.4;
        }

        /* Indicadores de productos en estanter√≠as */
        .shelf-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e53e3e;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            border: 2px solid white;
            pointer-events: none;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .inventory-table th,
        .inventory-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .inventory-table th {
            background: #f7fafc;
            font-weight: bold;
            color: #4a5568;
        }

        .inventory-table tr:hover {
            background: #f7fafc;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }

        .search-bar::after {
            content: "üîç";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #c6f6d5;
            color: #2d7d32;
            border: 1px solid #9ae6b4;
        }

        .alert.error {
            background: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .zone-info {
            margin-top: 15px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí° Bodega Virtual - Iluminaci√≥n</h1>
            <p>Sistema de gesti√≥n inteligente para control de inventario</p>
        </div>

        <div class="alert" id="alert"></div>

        <div class="main-grid">
            <div class="left-panel">
                <!-- Formulario de ingreso/salida -->
                <div class="card">
                    <h2>üì¶ Gesti√≥n de Productos</h2>
                    <form id="productForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="productName">Nombre del Producto:</label>
                                <input type="text" id="productName" required>
                            </div>
                            <div class="form-group">
                                <label for="productCode">C√≥digo:</label>
                                <input type="text" id="productCode" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="quantity">Cantidad:</label>
                                <input type="number" id="quantity" min="1" required>
                            </div>
                            <div class="form-group">
                                <label for="action">Acci√≥n:</label>
                                <select id="action" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="entrada">Entrada</option>
                                    <option value="salida">Salida</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="zone">Zona:</label>
                                <select id="zone" required>
                                    <option value="">Seleccionar zona...</option>
                                    <option value="A">Zona A - LEDs Residenciales</option>
                                    <option value="B">Zona B - LEDs Comerciales</option>
                                    <option value="C">Zona C - Reflectores</option>
                                    <option value="D">Zona D - L√°mparas Decorativas</option>
                                    <option value="E">Zona E - Accesorios</option>
                                    <option value="F">Zona F - Focos Tradicionales</option>
                                    <option value="G">Zona G - Iluminaci√≥n Exterior</option>
                                    <option value="H">Zona H - Sistemas Smart</option>
                                    <option value="I">Zona I - Repuestos</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="category">Categor√≠a:</label>
                                <select id="category" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="LED">LED</option>
                                    <option value="Fluorescente">Fluorescente</option>
                                    <option value="Incandescente">Incandescente</option>
                                    <option value="Hal√≥geno">Hal√≥geno</option>
                                    <option value="Accesorio">Accesorio</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="description">Descripci√≥n:</label>
                            <input type="text" id="description" placeholder="Descripci√≥n adicional...">
                        </div>
                        <button type="submit" class="btn btn-primary">‚úÖ Procesar Movimiento</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">üóëÔ∏è Limpiar</button>
                    </form>
                </div>

                <!-- Inventario -->
                <div class="card">
                    <h2>üìã Inventario Actual</h2>
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Buscar productos..." onkeyup="searchProducts()">
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="inventory-table">
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Producto</th>
                                    <th>Cantidad</th>
                                    <th>Zona</th>
                                    <th>Categor√≠a</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTable">
                                <!-- Los productos se mostrar√°n aqu√≠ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Panel derecho -->
            <div class="right-panel">
                <!-- Mapa de zonas -->
                <div class="card">
                    <h2>üè≠ Plano de Bodega - Vista Superior</h2>
                    
                    <div class="warehouse-map" id="warehouseMap">
                        <!-- Paredes perimetrales -->
                        <div class="wall wall-top editable" data-type="wall" style="top: 0; left: 0; width: 100%; height: 8px;">
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="wall wall-bottom editable" data-type="wall" style="bottom: 0; left: 0; width: 100%; height: 8px;">
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="wall wall-left editable" data-type="wall" style="top: 0; left: 0; width: 8px; height: 100%;">
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="wall wall-right editable" data-type="wall" style="top: 0; right: 0; width: 8px; height: 100%;">
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        
                        <!-- Pasillos -->
                        <div class="aisle main-aisle editable" data-type="aisle" title="Pasillo Principal" style="top: 180px; left: 15px; width: calc(100% - 30px); height: 40px;">
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="aisle vertical-aisle editable" data-type="aisle" title="Pasillo Vertical 1" style="top: 15px; left: 180px; width: 40px; height: 150px;">
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="aisle vertical-aisle-2 editable" data-type="aisle" title="Pasillo Vertical 2" style="top: 15px; left: 280px; width: 40px; height: 150px;">
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="aisle side-aisle editable" data-type="aisle" title="Pasillo Lateral" style="top: 240px; left: 15px; width: calc(100% - 30px); height: 30px;">
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        
                        <!-- √Åreas especiales -->
                        <div class="office editable" data-type="office" title="Oficina de Supervisi√≥n" style="top: 15px; right: 15px; width: 60px; height: 50px;">
                            üìã<br>OFICINA
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="loading-dock editable" data-type="dock" title="Muelle de Carga" style="bottom: 15px; right: 15px; width: 80px; height: 40px;">
                            üöõ<br>CARGA
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        
                        <!-- Estanter√≠as con productos -->
                        <div class="shelf shelf-a editable" data-zone="A" onclick="selectZone('A')" title="Estanter√≠a A - LEDs Residenciales" style="top: 30px; left: 30px; width: 100px; height: 70px;">
                            A<br>üí°<br><small>LEDs<br>Residenc.</small>
                            <div class="shelf-indicator" id="indicator-a">0</div>
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="shelf shelf-b editable" data-zone="B" onclick="selectZone('B')" title="Estanter√≠a B - LEDs Comerciales" style="top: 30px; left: 140px; width: 100px; height: 70px;">
                            B<br>üè¢<br><small>LEDs<br>Comercial</small>
                            <div class="shelf-indicator" id="indicator-b">0</div>
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="shelf shelf-c editable" data-zone="C" onclick="selectZone('C')" title="Estanter√≠a C - Reflectores" style="top: 30px; left: 330px; width: 100px; height: 70px;">
                            C<br>üî¶<br><small>Reflectores<br>LED</small>
                            <div class="shelf-indicator" id="indicator-c">0</div>
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="shelf shelf-d editable" data-zone="D" onclick="selectZone('D')" title="Estanter√≠a D - L√°mparas Decorativas" style="top: 110px; left: 30px; width: 100px; height: 60px;">
                            D<br>ü™î<br><small>L√°mparas<br>Decorat.</small>
                            <div class="shelf-indicator" id="indicator-d">0</div>
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="shelf shelf-e editable" data-zone="E" onclick="selectZone('E')" title="Estanter√≠a E - Accesorios" style="top: 110px; left: 140px; width: 100px; height: 60px;">
                            E<br>üîå<br><small>Accesorios<br>y Partes</small>
                            <div class="shelf-indicator" id="indicator-e">0</div>
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="shelf shelf-f editable" data-zone="F" onclick="selectZone('F')" title="Estanter√≠a F - Focos Tradicionales" style="top: 290px; left: 30px; width: 90px; height: 80px;">
                            F<br>üí°<br><small>Focos<br>Tradicion.</small>
                            <div class="shelf-indicator" id="indicator-f">0</div>
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="shelf shelf-g editable" data-zone="G" onclick="selectZone('G')" title="Estanter√≠a G - Iluminaci√≥n Exterior" style="top: 290px; left: 140px; width: 90px; height: 80px;">
                            G<br>üåü<br><small>Exterior<br>IP65</small>
                            <div class="shelf-indicator" id="indicator-g">0</div>
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="shelf shelf-h editable" data-zone="H" onclick="selectZone('H')" title="Estanter√≠a H - Sistemas Smart" style="top: 290px; left: 250px; width: 90px; height: 80px;">
                            H<br>üì±<br><small>Smart<br>Tech</small>
                            <div class="shelf-indicator" id="indicator-h">0</div>
                            <div class="resize-handle bottom-right"></div>
                        </div>
                        <div class="shelf shelf-i editable" data-zone="I" onclick="selectZone('I')" title="Estanter√≠a I - Repuestos" style="top: 290px; left: 360px; width: 80px; height: 80px;">
                            I<br>üîß<br><small>Repuestos<br>y Manten.</small>
                            <div class="shelf-indicator" id="indicator-i">0</div>
                            <div class="resize-handle bottom-right"></div>
                        </div>
                    </div>
                    <div class="zone-info" id="zoneInfo">
                        <strong>üè≠ Bodega de Iluminaci√≥n Virtual</strong><br>
                        <small>‚Ä¢ Haz clic en cualquier estanter√≠a para ver los productos almacenados<br>
                        ‚Ä¢ Los n√∫meros rojos indican la cantidad de productos en cada zona<br>
                        ‚Ä¢ Activa el modo edici√≥n para personalizar el dise√±o de tu bodega</small>
                    </div>
                </div>
 <!-- Controles de edici√≥n -->
 <div class="edit-controls">
    <button class="edit-mode-btn" id="editModeBtn" onclick="toggleEditMode()">
        ‚úèÔ∏è Activar Modo Edici√≥n
    </button>
    <button class="save-layout-btn" onclick="saveLayout()">
        üíæ Guardar Dise√±o
    </button>
    <button class="reset-layout-btn" onclick="resetLayout()">
        üîÑ Restaurar Original
    </button>
    <div class="edit-instructions" id="editInstructions" style="display: none;">
        <strong>Modo Edici√≥n Activo:</strong><br>
        ‚Ä¢ Arrastra cualquier elemento para moverlo<br>
        ‚Ä¢ Usa los puntos azules en las esquinas para redimensionar<br>
        ‚Ä¢ Haz clic fuera del elemento para deseleccionarlo<br>
        ‚Ä¢ Los cambios se guardan autom√°ticamente
    </div>
</div>
    
            </div>
        </div>
    </div>
<!-- Estad√≠sticas -->
<div class="card">
    <h2>üìä Estad√≠sticas</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <h3 id="totalProducts">0</h3>
            <p>Total Productos</p>
        </div>
        <div class="stat-card">
            <h3 id="totalStock">0</h3>
            <p>Stock Total</p>
        </div>
        <div class="stat-card">
            <h3 id="activeZones">0</h3>
            <p>Zonas Activas</p>
        </div>
        <div class="stat-card">
            <h3 id="todayMovements">0</h3>
            <p>Movimientos Hoy</p>
        </div>
    </div>
</div>
    <script>
// Base de datos en memoria
let inventory = [];
let movements = [];

// Datos de ejemplo iniciales
inventory = [
    {code: 'LED001', name: 'LED Bulbo 9W', quantity: 45, zone: 'A', category: 'LED', description: 'Luz blanca fr√≠a'},
    {code: 'LED002', name: 'LED Panel 60x60', quantity: 12, zone: 'B', category: 'LED', description: 'Para oficinas'},
    {code: 'REF001', name: 'Reflector LED 50W', quantity: 8, zone: 'C', category: 'LED', description: 'Exterior IP65'},
    {code: 'DEC001', name: 'L√°mpara Colgante', quantity: 15, zone: 'D', category: 'Accesorio', description: 'Decorativa moderna'},
    {code: 'ACC001', name: 'Dimmer Digital', quantity: 25, zone: 'E', category: 'Accesorio', description: 'Control de intensidad'},
    {code: 'FLU001', name: 'Fluorescente T8 18W', quantity: 30, zone: 'F', category: 'Fluorescente', description: 'Tradicional'},
    {code: 'EXT001', name: 'Foco Exterior LED', quantity: 20, zone: 'G', category: 'LED', description: 'Resistente al agua'},
    {code: 'SMT001', name: 'Bombilla Smart WiFi', quantity: 18, zone: 'H', category: 'LED', description: 'Control por app'},
    {code: 'REP001', name: 'Balastro LED', quantity: 10, zone: 'I', category: 'Accesorio', description: 'Repuesto universal'}
];

// Variables para el modo edici√≥n
let editMode = false;
let selectedElement = null;
let isDragging = false;
let isResizing = false;
let dragOffset = { x: 0, y: 0 };
let originalLayout = {};

// Funci√≥n para mostrar alertas
function showAlert(message, type) {
    const alert = document.getElementById('alert');
    alert.textContent = message;
    alert.className = `alert ${type}`;
    alert.style.display = 'block';
    setTimeout(() => {
        alert.style.display = 'none';
    }, 5000);
}

// Funci√≥n para procesar formulario
function initializeFormHandler() {
    document.getElementById('productForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const productName = document.getElementById('productName').value.trim();
        const productCode = document.getElementById('productCode').value.trim().toUpperCase();
        const quantity = parseInt(document.getElementById('quantity').value);
        const action = document.getElementById('action').value;
        const zone = document.getElementById('zone').value;
        const category = document.getElementById('category').value;
        const description = document.getElementById('description').value.trim();

        // Validaciones b√°sicas
        if (!productName || !productCode || !quantity || !action || !zone || !category) {
            showAlert('‚ùå Por favor completa todos los campos obligatorios', 'error');
            return;
        }

        // Buscar producto existente
        let existingProduct = inventory.find(p => p.code === productCode);

        if (action === 'entrada') {
            if (existingProduct) {
                // Actualizar producto existente
                existingProduct.quantity += quantity;
                // Actualizar otros campos si han cambiado
                existingProduct.name = productName;
                existingProduct.zone = zone;
                existingProduct.category = category;
                existingProduct.description = description;
                showAlert(`‚úÖ Entrada registrada: ${quantity} unidades de ${productName}`, 'success');
            } else {
                // Crear nuevo producto
                inventory.push({
                    code: productCode,
                    name: productName,
                    quantity: quantity,
                    zone: zone,
                    category: category,
                    description: description
                });
                showAlert(`‚úÖ Nuevo producto agregado: ${productName}`, 'success');
            }
        } else if (action === 'salida') {
            if (existingProduct) {
                if (existingProduct.quantity >= quantity) {
                    existingProduct.quantity -= quantity;
                    if (existingProduct.quantity === 0) {
                        inventory = inventory.filter(p => p.code !== productCode);
                    }
                    showAlert(`‚úÖ Salida registrada: ${quantity} unidades de ${productName}`, 'success');
                } else {
                    showAlert(`‚ùå Stock insuficiente. Solo hay ${existingProduct.quantity} unidades disponibles`, 'error');
                    return;
                }
            } else {
                showAlert(`‚ùå Producto no encontrado en inventario`, 'error');
                return;
            }
        }

        // Registrar movimiento
        movements.push({
            date: new Date(),
            code: productCode,
            name: productName,
            quantity: quantity,
            action: action,
            zone: zone,
            category: category
        });

        // Actualizar vistas
        updateInventoryTable();
        updateStats();
        updateShelfIndicators();
        clearForm();
    });
}

// Funci√≥n para actualizar tabla de inventario
function updateInventoryTable() {
    const tbody = document.getElementById('inventoryTable');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    // Ordenar por c√≥digo
    const sortedInventory = [...inventory].sort((a, b) => a.code.localeCompare(b.code));
    
    sortedInventory.forEach(product => {
        const row = tbody.insertRow();
        row.innerHTML = `
            <td><strong>${product.code}</strong></td>
            <td>${product.name}</td>
            <td><span class="quantity-badge">${product.quantity}</span></td>
            <td><span class="zone-badge zone-${product.zone.toLowerCase()}">${product.zone}</span></td>
            <td><span class="category-badge">${product.category}</span></td>
            <td>
                <button class="btn-action btn-edit" onclick="editProduct('${product.code}')" title="Editar">
                    ‚úèÔ∏è
                </button>
                <button class="btn-action btn-delete" onclick="removeProduct('${product.code}')" title="Eliminar">
                    üóëÔ∏è
                </button>
            </td>
        `;
        
        // Aplicar clase para stock bajo
        if (product.quantity < 10) {
            row.classList.add('low-stock');
        }
    });
}

// Funci√≥n para editar producto
function editProduct(code) {
    const product = inventory.find(p => p.code === code);
    if (product) {
        document.getElementById('productName').value = product.name;
        document.getElementById('productCode').value = product.code;
        document.getElementById('zone').value = product.zone;
        document.getElementById('category').value = product.category;
        document.getElementById('description').value = product.description;
        
        // Enfocar en el campo de cantidad
        document.getElementById('quantity').focus();
        showAlert(`üìù Producto ${product.name} cargado para edici√≥n`, 'info');
    }
}

// Funci√≥n para eliminar producto
function removeProduct(code) {
    const product = inventory.find(p => p.code === code);
    if (product && confirm(`¬øEst√°s seguro de eliminar "${product.name}"?`)) {
        inventory = inventory.filter(p => p.code !== code);
        
        // Registrar movimiento de eliminaci√≥n
        movements.push({
            date: new Date(),
            code: product.code,
            name: product.name,
            quantity: product.quantity,
            action: 'eliminacion',
            zone: product.zone,
            category: product.category
        });
        
        updateInventoryTable();
        updateStats();
        updateShelfIndicators();
        showAlert(`‚úÖ Producto "${product.name}" eliminado correctamente`, 'success');
    }
}

// Funci√≥n para buscar productos
function searchProducts() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const rows = document.querySelectorAll('#inventoryTable tr');
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
}

// Funci√≥n para seleccionar zona
function selectZone(zoneLetter) {
    if (editMode) return; // No funcionar en modo edici√≥n
    
    // Remover selecci√≥n anterior
    document.querySelectorAll('.shelf').forEach(z => z.classList.remove('selected'));
    
    // Seleccionar nueva estanter√≠a
    const shelf = document.querySelector(`.shelf-${zoneLetter.toLowerCase()}`);
    if (shelf) {
        shelf.classList.add('selected');
    }
    
    // Actualizar selector de zona en formulario
    document.getElementById('zone').value = zoneLetter;
    
    // Mostrar informaci√≥n de la zona
    const zoneProducts = inventory.filter(p => p.zone === zoneLetter);
    const zoneInfo = document.getElementById('zoneInfo');
    
    const zoneNames = {
        'A': 'LEDs Residenciales',
        'B': 'LEDs Comerciales', 
        'C': 'Reflectores LED',
        'D': 'L√°mparas Decorativas',
        'E': 'Accesorios y Partes',
        'F': 'Focos Tradicionales',
        'G': 'Iluminaci√≥n Exterior',
        'H': 'Sistemas Smart Tech',
        'I': 'Repuestos y Mantenimiento'
    };
    
    if (zoneProducts.length > 0) {
        const totalStock = zoneProducts.reduce((sum, p) => sum + p.quantity, 0);
        const categories = [...new Set(zoneProducts.map(p => p.category))];
        
        zoneInfo.innerHTML = `
            <strong>üì¶ Estanter√≠a ${zoneLetter} - ${zoneNames[zoneLetter]}</strong><br>
            <div style="margin-top: 10px; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; border-left: 4px solid #667eea;">
                üìä <strong>Productos √∫nicos:</strong> ${zoneProducts.length}<br>
                üì¶ <strong>Stock total:</strong> ${totalStock} unidades<br>
                üè∑Ô∏è <strong>Categor√≠as:</strong> ${categories.join(', ')}<br><br>
                <strong>üìã Inventario detallado:</strong><br>
                <div style="margin-left: 10px; font-family: monospace; font-size: 12px; max-height: 150px; overflow-y: auto;">
                    ${zoneProducts.map(p => `
                        <div style="margin: 4px 0; padding: 4px 8px; background: rgba(255,255,255,0.8); border-radius: 4px;">
                            <strong>${p.code}</strong> - ${p.name}<br>
                            <span style="color: #666;">Stock: ${p.quantity} | ${p.category}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    } else {
        zoneInfo.innerHTML = `
            <strong>üì¶ Estanter√≠a ${zoneLetter} - ${zoneNames[zoneLetter]}</strong><br>
            <div style="margin-top: 10px; padding: 12px; background: rgba(255, 193, 7, 0.1); border-radius: 8px; border-left: 4px solid #ffc107;">
                ‚ö†Ô∏è <strong>Estanter√≠a vac√≠a</strong><br>
                <small>No hay productos almacenados en esta zona.<br>
                Puedes agregar productos seleccionando esta zona en el formulario.</small>
            </div>
        `;
    }
}

// Funci√≥n para actualizar indicadores de estanter√≠as
function updateShelfIndicators() {
    const zones = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];
    
    zones.forEach(zone => {
        const zoneProducts = inventory.filter(p => p.zone === zone);
        const totalStock = zoneProducts.reduce((sum, p) => sum + p.quantity, 0);
        const indicator = document.getElementById(`indicator-${zone.toLowerCase()}`);
        
        if (indicator) {
            indicator.textContent = totalStock;
            
            // Actualizar color seg√∫n stock
            if (totalStock === 0) {
                indicator.style.background = '#94a3b8'; // Gris - vac√≠o
                indicator.style.color = 'white';
            } else if (totalStock < 10) {
                indicator.style.background = '#ef4444'; // Rojo - stock bajo
                indicator.style.color = 'white';
            } else if (totalStock < 30) {
                indicator.style.background = '#f59e0b'; // Amarillo - stock medio
                indicator.style.color = 'white';
            } else {
                indicator.style.background = '#10b981'; // Verde - stock alto
                indicator.style.color = 'white';
            }
        }
    });
}

// Funci√≥n para actualizar estad√≠sticas
function updateStats() {
    // Total de productos √∫nicos
    document.getElementById('totalProducts').textContent = inventory.length;
    
    // Stock total
    const totalStock = inventory.reduce((sum, p) => sum + p.quantity, 0);
    document.getElementById('totalStock').textContent = totalStock;
    
    // Zonas activas (con productos)
    const activeZones = new Set(inventory.map(p => p.zone)).size;
    document.getElementById('activeZones').textContent = activeZones;
    
    // Movimientos de hoy
    const today = new Date().toDateString();
    const todayMovements = movements.filter(m => m.date.toDateString() === today).length;
    document.getElementById('todayMovements').textContent = todayMovements;
}

// Funci√≥n para limpiar formulario
function clearForm() {
    document.getElementById('productForm').reset();
    document.querySelectorAll('.shelf').forEach(z => z.classList.remove('selected'));
    document.getElementById('zoneInfo').innerHTML = `
        <strong>üè≠ Bodega de Iluminaci√≥n Virtual</strong><br>
        <small>‚Ä¢ Haz clic en cualquier estanter√≠a para ver los productos almacenados<br>
        ‚Ä¢ Los n√∫meros indican la cantidad de productos en cada zona<br>
        ‚Ä¢ Verde = Stock alto | Amarillo = Stock medio | Rojo = Stock bajo | Gris = Vac√≠o<br>
        ‚Ä¢ Activa el modo edici√≥n para personalizar el dise√±o de tu bodega</small>
    `;
}

// === MODO EDICI√ìN ===

// Guardar dise√±o original al cargar
function saveOriginalLayout() {
    const editableElements = document.querySelectorAll('.editable');
    editableElements.forEach(el => {
        const classList = Array.from(el.classList);
        const identifier = classList.find(c => c.includes('shelf-') || c.includes('wall-') || c.includes('aisle')) || 
                          el.dataset.type + '-' + classList.join('-');
        
        originalLayout[identifier] = {
            top: el.style.top || getComputedStyle(el).top,
            left: el.style.left || getComputedStyle(el).left,
            right: el.style.right || getComputedStyle(el).right,
            bottom: el.style.bottom || getComputedStyle(el).bottom,
            width: el.style.width || getComputedStyle(el).width,
            height: el.style.height || getComputedStyle(el).height
        };
    });
}

// Activar/desactivar modo edici√≥n
function toggleEditMode() {
    editMode = !editMode;
    const btn = document.getElementById('editModeBtn');
    const instructions = document.getElementById('editInstructions');
    
    if (editMode) {
        btn.textContent = 'üîí Desactivar Edici√≥n';
        btn.classList.add('active');
        instructions.style.display = 'block';
        enableEditMode();
        showAlert('‚úèÔ∏è Modo edici√≥n activado - Puedes mover y redimensionar elementos', 'info');
    } else {
        btn.textContent = '‚úèÔ∏è Activar Modo Edici√≥n';
        btn.classList.remove('active');
        instructions.style.display = 'none';
        disableEditMode();
        showAlert('üîí Modo edici√≥n desactivado', 'info');
    }
}

function enableEditMode() {
    const editableElements = document.querySelectorAll('.editable');
    editableElements.forEach(el => {
        el.addEventListener('mousedown', handleMouseDown);
        el.style.cursor = 'move';
        
        // Deshabilitar clics de estanter√≠as en modo edici√≥n
        if (el.dataset.zone) {
            el.onclick = null;
        }
    });
    
    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mouseup', handleMouseUp);
    
    // Prevenir selecci√≥n de texto
    document.body.style.userSelect = 'none';
}

function disableEditMode() {
    const editableElements = document.querySelectorAll('.editable');
    editableElements.forEach(el => {
        el.removeEventListener('mousedown', handleMouseDown);
        el.classList.remove('dragging', 'selected');
        el.style.cursor = '';
        
        // Reactivar clics de estanter√≠as
        if (el.dataset.zone) {
            el.onclick = () => selectZone(el.dataset.zone);
        }
    });
    
    document.removeEventListener('mousemove', handleMouseMove);
    document.removeEventListener('mouseup', handleMouseUp);
    selectedElement = null;
    
    // Reactivar selecci√≥n de texto
    document.body.style.userSelect = '';
}

function handleMouseDown(e) {
    if (!editMode) return;
    
    e.preventDefault();
    e.stopPropagation();
    
    selectedElement = e.currentTarget;
    
    // Deseleccionar otros elementos
    document.querySelectorAll('.editable').forEach(el => {
        el.classList.remove('selected');
    });
    
    selectedElement.classList.add('selected');
    
    const rect = selectedElement.getBoundingClientRect();
    const parentRect = selectedElement.parentElement.getBoundingClientRect();
    
    // Verificar si se est√° haciendo clic en el handle de redimensi√≥n
    if (e.target.classList.contains('resize-handle')) {
        isResizing = true;
        selectedElement.classList.add('dragging');
    } else {
        isDragging = true;
        selectedElement.classList.add('dragging');
        
        dragOffset.x = e.clientX - rect.left;
        dragOffset.y = e.clientY - rect.top;
    }
}

function handleMouseMove(e) {
    if (!editMode || !selectedElement) return;
    
    const parentRect = selectedElement.parentElement.getBoundingClientRect();
    
    if (isDragging) {
        const newX = e.clientX - parentRect.left - dragOffset.x;
        const newY = e.clientY - parentRect.top - dragOffset.y;
        
        // Limitar dentro del contenedor
        const maxX = parentRect.width - selectedElement.offsetWidth;
        const maxY = parentRect.height - selectedElement.offsetHeight;
        
        const constrainedX = Math.max(0, Math.min(newX, maxX));
        const constrainedY = Math.max(0, Math.min(newY, maxY));
        
        selectedElement.style.left = constrainedX + 'px';
        selectedElement.style.top = constrainedY + 'px';
        selectedElement.style.right = 'auto';
        selectedElement.style.bottom = 'auto';
        
    } else if (isResizing) {
        const elementRect = selectedElement.getBoundingClientRect();
        const newWidth = e.clientX - elementRect.left + 5;
        const newHeight = e.clientY - elementRect.top + 5;
        
        // Tama√±os m√≠nimos
        const minWidth = 30;
        const minHeight = 20;
        
        // Tama√±os m√°ximos (dentro del contenedor)
        const maxWidth = parentRect.width - (elementRect.left - parentRect.left);
        const maxHeight = parentRect.height - (elementRect.top - parentRect.top);
        
        const finalWidth = Math.max(minWidth, Math.min(newWidth, maxWidth));
        const finalHeight = Math.max(minHeight, Math.min(newHeight, maxHeight));
        
        selectedElement.style.width = finalWidth + 'px';
        selectedElement.style.height = finalHeight + 'px';
    }
}

function handleMouseUp(e) {
    if (!editMode) return;
    
    isDragging = false;
    isResizing = false;
    
    if (selectedElement) {
        selectedElement.classList.remove('dragging');
    }
}

// Guardar dise√±o personalizado
function saveLayout() {
    const layout = {};
    const editableElements = document.querySelectorAll('.editable');
    
    editableElements.forEach(el => {
        const classList = Array.from(el.classList);
        const identifier = classList.find(c => c.includes('shelf-') || c.includes('wall-') || c.includes('aisle')) || 
                          el.dataset.type + '-' + classList.join('-');
        
        layout[identifier] = {
            top: el.style.top,
            left: el.style.left,
            right: el.style.right,
            bottom: el.style.bottom,
            width: el.style.width,
            height: el.style.height
        };
    });
    
    // En una aplicaci√≥n real, aqu√≠ guardar√≠as en localStorage o servidor
    console.log('Dise√±o guardado:', layout);
    showAlert('üíæ Dise√±o de bodega guardado correctamente', 'success');
}

// Restaurar dise√±o original
function resetLayout() {
    if (confirm('¬øEst√°s seguro de restaurar el dise√±o original? Se perder√°n todos los cambios.')) {
        const editableElements = document.querySelectorAll('.editable');
        editableElements.forEach(el => {
            const classList = Array.from(el.classList);
            const identifier = classList.find(c => c.includes('shelf-') || c.includes('wall-') || c.includes('aisle')) || 
                              el.dataset.type + '-' + classList.join('-');
            
            if (originalLayout[identifier]) {
                Object.assign(el.style, originalLayout[identifier]);
            }
        });
        showAlert('üîÑ Dise√±o restaurado al original', 'success');
    }
}

// === FUNCIONES DE UTILIDAD ===

// Exportar datos (simulado)
function exportData() {
    const data = {
        inventory: inventory,
        movements: movements,
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    console.log('Datos exportados:', dataStr);
    
    // En un entorno real, descargar√≠as el archivo
    showAlert('üì§ Datos exportados a la consola (F12)', 'info');
}

// Importar datos (simulado)
function importData(jsonData) {
    try {
        const data = JSON.parse(jsonData);
        if (data.inventory) {
            inventory = data.inventory;
            updateInventoryTable();
            updateStats();
            updateShelfIndicators();
            showAlert('üì• Datos importados correctamente', 'success');
        }
    } catch (error) {
        showAlert('‚ùå Error al importar datos: formato incorrecto', 'error');
    }
}

// Generar reporte de stock bajo
function generateLowStockReport() {
    const lowStockItems = inventory.filter(p => p.quantity < 10);
    
    if (lowStockItems.length === 0) {
        showAlert('‚úÖ No hay productos with stock bajo', 'success');
        return;
    }
    
    console.log('=== REPORTE DE STOCK BAJO ===');
    console.log(`Productos con menos de 10 unidades: ${lowStockItems.length}`);
    lowStockItems.forEach(item => {
        console.log(`- ${item.code}: ${item.name} (${item.quantity} unidades) - Zona ${item.zone}`);
    });
    
    showAlert(`‚ö†Ô∏è ${lowStockItems.length} productos con stock bajo. Ver consola (F12)`, 'warning');
}

// Prevenir seleccionar elementos en modo normal
document.addEventListener('click', function(e) {
    if (editMode && !e.target.closest('.editable') && !e.target.closest('.edit-controls')) {
        document.querySelectorAll('.editable').forEach(el => {
            el.classList.remove('selected');
        });
        selectedElement = null;
    }
});

// Atajos de teclado
document.addEventListener('keydown', function(e) {
    // Escape para salir del modo edici√≥n
    if (e.key === 'Escape' && editMode) {
        toggleEditMode();
    }
    
    // Ctrl+S para guardar dise√±o
    if (e.ctrlKey && e.key === 's' && editMode) {
        e.preventDefault();
        saveLayout();
    }
    
    // Suprimir para eliminar elemento seleccionado (solo en modo edici√≥n)
    if (e.key === 'Delete' && editMode && selectedElement) {
        e.preventDefault();
        if (confirm('¬øEliminar este elemento del dise√±o?')) {
            selectedElement.style.display = 'none';
            selectedElement = null;
        }
    }
});

// === INICIALIZACI√ìN ===

// Inicializar aplicaci√≥n cuando se carga el DOM
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Inicializando Bodega Virtual...');
    
    // Inicializar componentes
    initializeFormHandler();
    updateInventoryTable();
    updateStats();
    updateShelfIndicators();
    saveOriginalLayout();
    
    // Configurar eventos adicionales
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', searchProducts);
    }
    
    // Mensaje de bienvenida
    setTimeout(() => {
        showAlert('üè≠ Bodega Virtual inicializada correctamente', 'success');
    }, 500);
    
    console.log('‚úÖ Bodega Virtual lista para usar');
});

// Funciones globales para acceso desde HTML
window.selectZone = selectZone;
window.removeProduct = removeProduct;
window.editProduct = editProduct;
window.searchProducts = searchProducts;
window.clearForm = clearForm;
window.toggleEditMode = toggleEditMode;
window.saveLayout = saveLayout;
window.resetLayout = resetLayout;
window.exportData = exportData;
window.importData = importData;
window.generateLowStockReport = generateLowStockReport;
    </script>
</body>
</html>