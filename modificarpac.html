<!DOCTYPE html> <!-- --------- INGRESO DE DOCUMENTOS  --------- -->
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Documentos</title>
    <script src="dir_formularioapps.js"></script>

    <style>
        /* Reset b√°sico */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Fondo con degradado */
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #ffffff, #596271);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        /* Contenedor del formulario estilo glassmorphism */
        #cont_form {
            background: rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            padding: 30px 20px;
            /* Reducido el padding lateral para m√≥viles */
            width: 100%;
            max-width: 1200px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: fadeIn 1s ease-in-out;
            text-align: center;
            margin: 0 auto;
            /* Centrado adicional */
            overflow-x: hidden;
            /* Evita scroll horizontal */
        }


        .cont_tabla2 {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #ccc;
            display: inline-block;
            width: 100%;
            /* Ancho completo para responsividad */
            max-width: 100%;
            /* Asegura que no exceda el ancho del contenedor */
        }

        /* Animaci√≥n de entrada */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Labels e inputs */
        label {
            /* display: block; */
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        input[type="text"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 5px 6px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
            background-color: #ffffffc7;
            text-transform: uppercase;
        }


        input[type="checkbox"] {
            width: 24px;
            height: 24px;
            border: 2px solid #ccc;
            border-radius: 4px;
            transition: all 0.3s ease;
            background-color: #ffffffc7;
            cursor: pointer;
            vertical-align: middle;
        }

        /* Centramos la tabla de checkbox */
        #chck1-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: #3498db;
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.4);
            outline: none;
        }

        /* Botones */
        .button1,
        .button2,
        .button3 {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 5px 10px;
            border: none;
        }

        .button1 {
            background-color: #27ae60;
            color: white;
        }

        .button1:hover {
            background-color: #1e8449;
        }

        .button2 {
            background-color: #e74c3c;
            color: white;
        }

        .button2:hover {
            background-color: #c0392b;
        }

        .button3 {
            background-color: #2980b9;
            color: white;
        }

        .button3:hover {
            background-color: #21618c;
        }

        /* Colores de texto */
        .negritas {
            font-weight: bold;
        }

        .azul {
            color: #ffffff;
        }

        .listo {
            color: #2ecc71;
            font-weight: bold;
        }

        .color_suggestions {
            color: #8e44ad;
        }

        /* Separador */
        hr {
            height: 2px;
            border: none;
            background: linear-gradient(to right, #3498db, #8e44ad);
            margin: 20px 0;
        }

        /* Loader - Efecto de carga inicial */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader-animation {
            width: 80px;
            height: 80px;
            position: relative;
        }

        .loader-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid transparent;
            border-top-color: #3fdb34;
            /* Color verde para el borde giratorio */
            animation: spin 1s linear infinite;
        }

        .loader-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            opacity: 0.8;
        }

        .loader-message {
            position: absolute;
            bottom: -30px;
            width: 100%;
            text-align: center;
            font-weight: 500;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Mantener el spinner original oculto pero disponible para el c√≥digo existente */
        #spinner-container {
            display: none;
        }

        #tabla1 td,
        #tabla1 th {
            text-align: center;
            /* Centrado horizontal */
            vertical-align: middle;
            /* Centrado vertical */
        }

        #cargandoOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            /* fondo semi-transparente */
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 20px;
            font-family: sans-serif;
            z-index: 9999;
            display: none;
            /* Oculto por defecto */
        }

        /* Media queries para dispositivos m√≥viles */
        @media (max-width: 768px) {
            #cont_form {
                padding: 20px 10px;
            }

            .button1,
            .button2,
            .button3 {
                width: 90% !important;
                margin: 5px auto;
                display: block;
            }

            h2 {
                font-size: 1.5rem;
            }

            select,
            input[type="text"] {
                width: 100% !important;
                /* Sobrescribe cualquier ancho inline */
            }

            /* Mejor visualizaci√≥n para el checkbox en m√≥vil */
            input[type="checkbox"] {
                width: 28px;
                height: 28px;
            }
        }
    </style>

</head>

<body>


    <!-- Loader - Se coloca al inicio del body -->
    <div class="loader">
        <div class="loader-animation">
            <div class="loader-circle"></div>
            <img src="logo_MUNI.png" alt="Logo" class="loader-logo">
            <div class="loader-message">Cargando...</div>
        </div>
    </div>


    <div id="cont_form">

        <form id="formulario">

            <div id="cargandoOverlay">Cargando archivos...<br>Por favor espere</div>

            <H2>FORMULARIO DE MODIFICAR PAC ANUAL</H2>

            <br>

            <b>A√±o </b>&nbsp;&nbsp;&nbsp;&nbsp;
            <select id="numAnio" name="numAnio" style="width: 140px;" onchange="continuar_nomUnid()"
                onclick="borrar_div(0)">
            </select>

            &nbsp;&nbsp;&nbsp;
            &nbsp;&nbsp;&nbsp;

            <div id="spinner-container">
                <div class="spinner"></div>
            </div> <!--  RUEDA DE ESPERA POR CARGA -->

            <br>

            <b>UNIDAD</b>&nbsp;&nbsp;
            <select id="nomUnid" name="nomUnid" style="width: 450px;" onchange="continuar_nomCtas()"
                onclick="borrar_div(0)">
            </select>

            <br>

            <b>N¬∞ CTA </b>&nbsp;&nbsp;&nbsp;
            <select id="numCtas" name="numCtas" style="width: 450px;" onchange="continuar_proyect()"
                onclick="borrar_div(0)">
            </select>

            <br>

            <b>Proyecto</b>&nbsp;
            <select id="nomPryt" name="nomPryt" style="width: 450px;" onclick="borrar_div(0)">
            </select>

            <p></p>

            <input class="button1" type="button" value="BUSCAR" onclick="TabularDatos()" style="width: 100px;">

            <p><br></p>

            <center>
                <div class="cont_tabla2" id="tabla-container2"></div> <!--  XXXXXXXXXXXXXXXXX  -->
            </center>

            <br>


            <p></p>

            <center>

                <div id="div_s1" hidden>
                    <input class="button1" type="button" value="GUARDAR" onclick="guardarDatos()" style="width: 100px;">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input class="button3" type="button" value="LIMPIAR" onclick="limpiarDatos()" style="width: 100px;">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input class="button2" id="butt1" type="button" value="CERRAR" style="width: 100px;"
                        onclick="cerrarForm()">
                </div>

                <div id="div_s2">
                    <input class="button2" id="butt2" type="button" value="CERRAR" style="width: 100px;"
                        onclick="cerrarForm()">
                </div>

            </center>

        </form>

    </div>



    <script>

        function ocultarLoader() {
            const loader = document.querySelector('.loader');
            loader.classList.add('hidden');
            setTimeout(function () {
                loader.style.display = 'none';
            }, 500);
        }

        // Reemplazar las funciones existentes que controlan el spinner
        function mostrarSpinner() {
            mostrarLoader();
        }

        function ocultarSpinner() {
            ocultarLoader();
        }

        // Si quieres cambiar el mensaje del loader
        function actualizarMensajeLoader(mensaje) {
            const mensajeElement = document.querySelector('.loader-message');
            if (mensajeElement) {
                mensajeElement.textContent = mensaje;
            }
        }
    </script>
    <!-- Script para el loader -->
    <script>
        // C√≥digo del loader (puedes moverlo a un archivo externo)
        document.addEventListener('DOMContentLoaded', function () {
            // Ocultar el loader cuando la p√°gina termine de cargar
            window.addEventListener('load', function () {
                // A√±adir la clase hidden para activar la transici√≥n
                document.querySelector('.loader').classList.add('hidden');

                // Eliminar completamente despu√©s de la transici√≥n
                setTimeout(function () {
                    document.querySelector('.loader').style.display = 'none';
                }, 500);
            });
        });
    </script>


    <script>


        var num_fil = new Array();

        var separa7 = " - ";

        var caractCheck = "‚úì";
        var listCheck = "";
        var ultimoId = "";

        var form_anio = "";
        var form_unid = "";
        var form_ncta = "";
        var form_desc = "";
        var form_pryt = "";
        var form_cmpr = "";

        var cmpr_tt = 0;          // Valor de la columna comprometido (Total de la cta)
        var cmpr_tx = "";         // Valor de la columna comprom-ID (valor de cada uno)
        var gast_tt = 0;          // Valor de la columna Gasto (Total de la cta)
        var gast_tx = "";         // Valor de la columna gasto-ID (valor de cada uno)
        var sald_tt = 0;          // Valor de la columna Saldo (Total de la cta)

        var separa1 = "&nbsp;";
        var separa5 = "/";        // Separador entre datos de los unitarios

        var fila_dt = 0;
        var fila_pac = 0;

        const anioActual = new Date().getFullYear();
        var este_anio = parseInt(anioActual);

        var maxDoc = "";
        var nnleer = 0;
        var nuevas = 0;
        var permiso = new Array();              // Permiso de la oficina (ejemplo: VMQ)
        permiso[0] = "";

        var xcompr = new Array();

        var antigu = new Array();              // Array con todos los datos originales
        var nuevod = new Array();              // Array con todos los datos incluidos los modificados

        var selec0 = "-- INGRESAR --";
        var permisott = "";

        var colmcta = 0;                        // Columna de Anex 1a donde esta el N¬∞ de cuenta & descripcion

        var chck1 = 0;                          // Check button para modificar registros

        var gast0 = "0/0/0/0/0/0/0/0/0/0";      // Valor inicial del Comprometido y del Gastado por cada compra

        var dato_dt = new Array();              // Todos los datos de la hoja DATOS
        var dat_PAC = new Array();              // Todos los datos de la hoja PAC
        var dato_1a = new Array();              // Todos los datos de la hoja ANEX 1a
        var dato_1b = new Array();              // Todos los datos de la hoja ANEX 1b

        var suggest = new Array();
        suggest = ["suggestionsDocument", "suggestionsDescripc", "suggestionsCuentas"];

        var sel_dept = "";                      // Seleccionar el tipo de DEPTO


        const API_KEY = 'AIzaSyBM9AcgPgM6MzM04Rij1xuti1Uf-n2QUuI';                 // Clave de API
        const SPREADSHEET_ID = '1GEFe7QHsqxV2TX8CKxW4Awq0coKIw8Nq5xATl15ZoOE';     // Direcci√≥n libro de Google Sheets


        // const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw9TfE8-orUBNLrpOtchgrknOEoodAbGbutAS49SukUTwMTu6t3m4LWBScCV3MoFnY/exec';     // Implementacion
        const WEB_APP_URL = dir_pac;

        cargando_icon(1);       // Activar la rueda de LOADING ....

        // ************************************************************************
        // ************************************************************************


        function mostrarToast(tmensaje, tcolor) {
            var toast = document.getElementById('toast1');
            toast.textContent = tmensaje;
            toast.style.backgroundColor = tcolor;
            toast.className = "show";
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
        }


        function guardarDatos() {

            var pp = 0;
            var error = 0;
            var tx_err = new Array();

            if (error == 0) {

                baul_compra = 0;
                for (ii = 0; ii < antigu.length; ii++) {
                    baul1 = (antigu[ii][5 ]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baul2 = (antigu[ii][6 ]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baul3 = (antigu[ii][7 ]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baul4 = (antigu[ii][8 ]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baul5 = (antigu[ii][12]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baul6 = (antigu[ii][14]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    antigu[ii][5 ] = baul1.toString();
                    antigu[ii][6 ] = baul2.toString();
                    antigu[ii][7 ] = baul3.toString();
                    antigu[ii][8 ] = baul4.toString();
                    antigu[ii][12] = baul5.toString();
                    antigu[ii][14] = baul6.toString();
                    var baulm = new Array();
                    for (jj = 0; jj < antigu[0].length; jj++) {
                        baulm[jj] = (document.getElementById("info[" + ii + "][" + jj + "]").value).toString();
                    }
                    taman = antigu[0].length;
                    fila_pac = num_fil[ii];
                    baulm[taman + 0] = (dat_PAC[fila_pac][taman + 0]).toString();
                    baulm[taman + 1] = (dat_PAC[fila_pac][taman + 1]).toString();
                    baulm[taman + 2] = (dat_PAC[fila_pac][taman + 2]).toString();
                    baulm[taman + 3] = (dat_PAC[fila_pac][taman + 3]).toString();
                    baulm[taman + 4] = (dat_PAC[fila_pac][taman + 4]).toString();
                    baulm[5 ] = (baulm[5 ]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baulm[6 ] = (baulm[6 ]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baulm[7 ] = (baulm[7 ]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baulm[8 ] = (baulm[8 ]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baulm[12] = (baulm[12]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baulm[14] = (baulm[14]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baulm[17] = (baulm[17]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baulm[19] = (baulm[19]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    baulm[21] = (baulm[21]).replace(/\./g, '').replace(/\D/g, '');      // Elimina los puntos
                    nuevod.push(baulm);
                }

                var baulfila = 0;
                yy = 0;
                for (ii = 0; ii < antigu.length; ii++) {
                    pp = 0;
                    baulfila = -1;
                    for (jj = 0; jj < antigu[0].length; jj++) {
                        if (antigu[ii][jj] !== nuevod[ii][jj]) {
                            baulfila = num_fil[ii] + 1;
                            pp++;
                            yy++;
                            break;         // Si hay una diferencia se sale
                        }
                    }


                    // %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                    // %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                    // %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


                    if (pp > 0) {      //Guarda la fila diferente
                        dat_PAC[num_fil[ii]] = nuevod[ii];
                        enviarDatos("PAC", baulfila, nuevod[ii], 1);
                    }
                }
                if (yy == 0) {
                    alert("No hay ningun registro por modificar");
                }
                if (yy > 0) {
                    alert("Felicidades, se modificaron " + yy + " registros.");
                    chck1 = 0;
                    modificar_chck();
                }
                yy = 0;

            } else {
                baul = "";
                for (ii = 0; ii < tx_err.length; ii++) { baul = baul + "\n" + tx_err[ii]; }
                alert("Faltan los siguientes datos por completar:" + baul);
            }

        }



        function enviarDatos(pagina, fila, datos, tipo) {

            fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ pagina, fila, datos, tipo })
            })
                .then(() => {
                    // mostrarToast('Datos enviados exitosamente üéâ', '#27ae60');
                    // alert('Datos enviados exitosamente');
                    document.getElementById("cargandoOverlay").style.display = "none";     // Ocultar mensaje Cargando ...
                    ingresar_compra1();
                    window.scrollTo({ top: 0, behavior: 'smooth' });                       // Scroll al inicio con animacion                                            // Scroll sin animaci√≥n
                })
                .catch(error => {
                    // console.error('Error al enviar datos:', error);
                    // mostrarToast('Error al enviar los datos.', '#e74c3c');
                    alert('Error al enviar los datos');
                })
                .finally(() => {
                });

        }



        function limpiarDatos() { location.reload(); }



        function borrar_div(nn) {
            if (nn > 0) {
                for (jj = 0; jj < suggest.length; jj++) {
                    if ((jj + 1) != nn) { document.getElementById(suggest[jj]).innerHTML = ""; }
                }
            }
            if (nn == 0) {
                for (jj = 0; jj < suggest.length; jj++) { document.getElementById(suggest[jj]).innerHTML = ""; }
            }
        }



        function cargando_icon(nn) {        // Rueda de carga (LOADING ...)
            const spinner = document.getElementById('spinner-container');
            if (nn === 1) {
                spinner.style.display = 'block';
            } else {
                spinner.style.display = 'none';
            }
        }


        // ************************************************************************
        // ************************************************************************


        var select = document.getElementById("numAnio");
        select.innerHTML = "";
        var delta = 0;
        for (jj = 0; jj < 4; jj++) {
            if (jj == 0) {
                let option = document.createElement('option');
                option.value = "0";
                option.text = selec0;
                select.appendChild(option);
            }
            baul = ((este_anio + delta) - jj);
            let option = document.createElement('option');
            option.value = (baul).toString();
            option.text = (baul).toString();
            select.appendChild(option);
        }
        form_anio = (este_anio).toString();
        select.value = form_anio;

        var select = document.getElementById("nomUnid");
        select.innerHTML = "";
        var option = document.createElement('option');
        option.value = "0";
        option.text = selec0;
        select.appendChild(option);
        select.value = "0";

        var select = document.getElementById("numCtas");
        select.innerHTML = "";
        var option = document.createElement('option');
        option.value = "0";
        option.text = selec0;
        select.appendChild(option);
        select.value = "0";

        var select = document.getElementById("nomPryt");
        select.innerHTML = "";
        var option = document.createElement('option');
        option.value = "0";
        option.text = selec0;
        select.appendChild(option);
        select.value = "0";

        continuar_nomUnid();




        fetch(WEB_APP_URL + "?h=P")
            .then(response => response.json())
            .then(data => {
                // Asigna los datos recibidos a las variables bidimensionales
                dat_PAC = data.dat_PAC;    // Datos de la hoja "PAC"
                dato_dt = data.dato_dt;    // Datos de la hoja "Registro"
                dato_nx = data.dato_nx;    // Datos de la hoja "Anexo"

                if (dat_PAC.length > 0) {
                    nnleer++;
                    if (nnleer == 2) { cargando_icon(0); }
                    if ((form_anio != "") && (form_anio != "0")) { llenar_select_unid(); }
                }
                if (dato_1a.length > 0) {
                    nnleer++;
                    if (nnleer == 2) { cargando_icon(0); }
                }
            })
            .catch(error => {
                console.error('Error al obtener los datos:', error);
            });


        // *****************************************************************
        // *****************************************************************



        function continuar_nomUnid() {       // Lee el a√±o y va a rellenar el select de la UNIDAD
            form_anio = document.getElementById("numAnio").value;
            baul = parseInt(form_anio);
            if ((baul > 2020) && (baul < (este_anio + 1))) {
                tablaContainer = document.getElementById('tabla-container2');
                tablaContainer.innerHTML = "";
                if (dat_PAC.length > 0) { llenar_select_unid(); }
            }
        }

        function continuar_nomCtas() {       // Lee la unidad y va a rellenar el select de la CUENTAS
            form_unid = document.getElementById("nomUnid").value;
            if ((form_unid != "") && (form_unid != selec0)) {
                tablaContainer = document.getElementById('tabla-container2');
                tablaContainer.innerHTML = "";
                llenar_select_ctas();
            }
        }

        function continuar_proyect() {       // Lee la cuenta y va a rellenar el select de los Proyectos
            form_ncta = document.getElementById("numCtas").value;
            if ((form_ncta != "") && (form_ncta != selec0)) {
                tablaContainer = document.getElementById('tabla-container2');
                tablaContainer.innerHTML = "";
                llenar_select_pryt();
            }
        }

        function ingresar_datos() {          // YA PUEDE LLENAR LOS DATOS DEL PROYECTO
            form_pryt = document.getElementById("nomPryt").value;
            if ((form_pryt != "") && (form_pryt != selec0)) {
                document.getElementById("div_s0").removeAttribute("hidden");
                document.getElementById("div_s2").setAttribute("hidden", "");
                document.getElementById("div_s1").removeAttribute("hidden");
                tablaContainer = document.getElementById('tabla-container2');
                tablaContainer.innerHTML = "";
                document.getElementById("ncompra").innerHTML = "";
                llenar_informacion();
            }
        }



        if (nnleer == 2) {
            if (document.getElementById("area").value != "0") {
                tablaContainer = document.getElementById('tabla-container2');
                tablaContainer.innerHTML = "";
                document.getElementById("ncompra").innerHTML = "";
                llenar_select();
            }
        }


        // **************** SELECT PARA ELEGIR EL PROYECTO **************************


        function llenar_select_unid() {          // Llenar los select de las UNIDADES
            // Suponiendo que dat_PAC[fila][1] contiene los nombres de las √°reas
            const nomUnidSet = new Set();

            // Recorremos dat_PAC para llenar el set con los valores √∫nicos de la columna 1 (A√±o)
            nomUnidSet.add(selec0);
            for (ii = 1; ii < dat_PAC.length; ii++) {
                var unidTx1 = (dat_PAC[ii][1]).toUpperCase();
                var baul1 = (dat_PAC[ii][0]).toString();
                if ((baul1 == form_anio) && (unidTx1 != "")) { nomUnidSet.add(unidTx1.trim().toUpperCase()); }
            }

            // Convertimos el set en un array y lo ordenamos alfab√©ticamente de A - Z
            const nomUnidOrdenadas = Array.from(nomUnidSet).sort((a, b) => a.localeCompare(b));

            // Obtenemos el select del DOM
            const select = document.getElementById("nomUnid");
            select.innerHTML = "";

            // Creamos y a√±adimos las opciones al select
            nomUnidOrdenadas.forEach(unidTx2 => {
                const option = document.createElement("option");
                option.value = unidTx2;
                option.textContent = unidTx2;
                select.appendChild(option);
            });
            select.value = selec0;
        }


        function llenar_select_ctas() {          // Llenar los select de las Cuentas
            // Suponiendo que dat_PAC[fila][1] contiene los nombres de las √°reas
            const nomCtasSet = new Set();

            // Recorremos dat_PAC para llenar el set con los valores √∫nicos de la columna 2 (Cuentas)
            nomCtasSet.add(selec0);
            for (ii = 1; ii < dat_PAC.length; ii++) {
                var unidTx1 = dat_PAC[ii][2] + separa7 + dat_PAC[ii][3];
                var baul1 = (dat_PAC[ii][0]).toString();
                var baul2 = (dat_PAC[ii][1]).toString().toUpperCase();
                if ((baul1 == form_anio) && (baul2 == form_unid) && (dat_PAC[ii][2] != "")) {
                    nomCtasSet.add(unidTx1.trim().toUpperCase());
                }
            }

            // Convertimos el set en un array y lo ordenamos alfab√©ticamente de A - Z
            const nomCtasOrdenadas = Array.from(nomCtasSet).sort((a, b) => a.localeCompare(b));

            // Obtenemos el select del DOM
            const select = document.getElementById("numCtas");
            select.innerHTML = "";

            // Creamos y a√±adimos las opciones al select
            nomCtasOrdenadas.forEach(unidTx2 => {
                var unidTx7 = new Array();
                unidTx7 = (unidTx2).split(separa7);
                const option = document.createElement("option");
                option.value = unidTx7[0];
                option.textContent = unidTx2;
                select.appendChild(option);
            });
            select.value = selec0;
        }


        function llenar_select_pryt() {          // Llenar los select de los Proyectos

            // Suponiendo que dat_PAC[fila][1] contiene los nombres de las √°reas
            const nomPrytSet = new Set();

            // Recorremos dat_PAC para llenar el set con los valores √∫nicos de la columna 2 (Cuentas)
            nomPrytSet.add(selec0);
            for (ii = 1; ii < dat_PAC.length; ii++) {
                var unidTx1 = dat_PAC[ii][4];
                var baul1 = (dat_PAC[ii][0]).toString();
                var baul2 = (dat_PAC[ii][1]).toString().toUpperCase();
                var baul3 = (dat_PAC[ii][2]).toString().toUpperCase();
                if ((baul1 == form_anio) && (baul2 == form_unid) && (baul3 == form_ncta) && (unidTx1 != "")) {
                    form_desc = (dat_PAC[ii][3]).toString().toUpperCase();
                    nomPrytSet.add(unidTx1.trim().toUpperCase());
                }
            }

            // Convertimos el set en un array y lo ordenamos alfab√©ticamente de A - Z
            const nomPrytOrdenadas = Array.from(nomPrytSet).sort((a, b) => a.localeCompare(b));

            // Obtenemos el select del DOM
            const select = document.getElementById("nomPryt");
            select.innerHTML = "";

            // Creamos y a√±adimos las opciones al select
            nomPrytOrdenadas.forEach(unidTx2 => {
                const option = document.createElement("option");
                option.value = unidTx2;
                option.textContent = unidTx2;
                select.appendChild(option);
            });
            select.value = selec0;

        }


        // **************** LLENADO DE INFORMACION DEL PROYECTO **************************


        function llenar_informacion() {         // Llenar todos los select normales

            form_anio = document.getElementById("numAnio").value;
            form_unid = document.getElementById("nomUnid").value;
            form_ncta = document.getElementById("numCtas").value;
            form_pryt = document.getElementById("nomPryt").value;

            fila_pac = 0;
            for (ii = 1; ii < dat_PAC.length; ii++) {
                var unidTx1 = dat_PAC[ii][0];
                if (unidTx1 != "") {
                    var baul0 = (dat_PAC[ii][0]).toString();
                    var baul1 = (dat_PAC[ii][1]).toString().toUpperCase();
                    var baul2 = (dat_PAC[ii][2]).toString().toUpperCase();
                    var baul3 = (dat_PAC[ii][4]).toString().toUpperCase();
                    if ((baul0 == form_anio) && (baul1 == form_unid) && (baul2 == form_ncta) && (baul3 == form_pryt)) {
                        form_desc = (dat_PAC[ii][3]).toString().toUpperCase();
                        fila_pac = ii;
                    }
                } else {
                    break;
                }
            }

        }


        function ingresar_compra1() {         // Llenar el select de los tipos de compras
            select = document.getElementById("ncompra");
            var ncompra = select.value;
            bauls = xcompr[parseInt(ncompra) - 1];
            if ((ncompra != "") && (ncompra != selec0) && (bauls != "ERROR")) {
                bauln = parseInt(xcompr[parseInt(ncompra) - 1]);       // 1 - Nuevo | 2 - Proceso | 3 - Terminado
                rellenar_cuadro(bauln);
            }
            if (bauls == "ERROR") {
                baulx = "Tienes un problema en la compra N¬∞ " + (ii + 1) + ":" + "\n" +
                    "Tienes un $ comprometido y un $ de pago en la misma compra.";
                alert(baulx);
            }
        }



        // ####################################################################################
        // ####################################################################################


        function TabularDatos() {

            tablaContainer = document.getElementById('tabla-container2');
            tablaContainer.innerHTML = "";         // Limpia la tabla de datos

            pp = 0;
            colum_PAC = 17;         // Columna maxima del PAC a mostrar en la tabla

            antigu.length = 0;                     // Limpia la variable antigu
            num_fil.length = 0;        // Limpia la variable num_fil

            for (ii = 1; ii < dat_PAC.length; ii++) {

                baul1 = document.getElementById("numAnio").value.toString().toUpperCase();     // Numero del a√±o
                baul2 = document.getElementById("nomUnid").value.toString().toUpperCase();     // Nombre de la Unidad o Departamento
                baul3 = document.getElementById("numCtas").value.toString().toUpperCase();     // Numero de la Cuenta
                baul4 = document.getElementById("nomPryt").value.toString().toUpperCase();     // Nombre del Proyecto

                var ss1 = 0; var ss2 = 0; var ss3 = 0; var ss4 = 0;
                if ((baul1 == selec0) || (baul1 == "0")) { ss1 = 1; }
                if (baul1 == dat_PAC[ii][0].toString().toUpperCase()) { ss1 = 1; }

                if (ss1 > 0) {
                    if ((baul2 == selec0) || (baul2 == "0")) { ss2 = 1; }
                    if (baul2 == dat_PAC[ii][1].toString().toUpperCase()) { ss2 = 1; }
                }

                if (ss2 > 0) {
                    if ((baul3 == selec0) || (baul3 == "0")) { ss3 = 1; }
                    if (baul3 == dat_PAC[ii][2].toString().toUpperCase()) { ss3 = 1; }
                }

                if (ss3 > 0) {
                    if ((baul4 == selec0) || (baul4 == "0")) { ss4 = 1; }
                    if (baul4 == dat_PAC[ii][4].toString().toUpperCase()) { ss4 = 1; }
                }

                if (ss1 * ss2 * ss3 * ss4 > 0) {

                    if (pp == 0) {
                        table = "<table border=1><thead><tr>";
                        for (jj = 0; jj < colum_PAC; jj++) {
                            table += "<th>" + dat_PAC[0][jj] + "</th>";
                        }
                        table += "</tr></thead><tbody>";
                    }

                    table += "<tr>"
                    var bbnada = new Array();
                    for (jj = 0; jj < colum_PAC; jj++) {
                        table += "<td>" + "<input type='text' id='info[" + pp + "][" + jj + "]' value='" + dat_PAC[ii][jj] + "'></td>";
                        bbnada[jj] = dat_PAC[ii][jj];
                    }
                    antigu.push(bbnada);
                    num_fil[pp] = ii;
                    table += "</tr>";

                    pp++;

                }
            }

            if (pp > 0) {
                table += "</tbody></table>"
                tablaContainer = document.getElementById('tabla-container2');
                tablaContainer.innerHTML = table;         // Escribe la tabla de datos
            }

            document.getElementById("div_s2").setAttribute("hidden", "");
            document.getElementById("div_s1").removeAttribute("hidden");
        }


        // ************************************************************************
        // ************************************************************************


        function cerrarForm() {
            // window.close();
            // window.history.back();
            location.href = "formulario-1.html";
        }


        // ************************************************************************


        function formatearNumero(input) {
            // Eliminar puntos y caracteres no num√©ricos
            let valor = input.value.replace(/\./g, '').replace(/\D/g, '');
            // Convertir a n√∫mero y formatear con puntos
            let numeroFormateado = new Intl.NumberFormat('es-ES').format(valor);
            // Actualizar el valor del input con el formato correcto
            input.value = numeroFormateado;
        }


        function formatearNumero2(valor1) {
            // Eliminar puntos y caracteres no num√©ricos
            let valor2 = valor1.replace(/\./g, '').replace(/\D/g, '');
            // Convertir a n√∫mero y formatear con puntos
            let numeroFormateado = new Intl.NumberFormat('es-ES').format(valor2);
            // Actualizar el valor del input con el formato correcto
            return numeroFormateado;
        }


        // ###############################################################################


        // Pasar la fecha de TEXTO DD/MM/YYYY a una FECHA YYYY-MM-DD (DATE)
        function oficesarFechaTexto(fechaTexto) {
            const partes = fechaTexto.split('/');
            if (partes.length !== 3) return null; // Verifica que el formato sea correcto

            const dia2 = partes[0].padStart(2, '0');  // Asegura 2 d√≠gitos para el d√≠a
            const mes2 = partes[1].padStart(2, '0');  // Asegura 2 d√≠gitos para el mes
            const ano2 = partes[2].padStart(4, '0');  // Asegura 4 d√≠gitos para el a√±o

            // Devuelve la fecha en formato YYYY-MM-DD
            return `${ano2}-${mes2}-${dia2}`;
        }

        // *******************************************************************************

        // Pasar la fecha de un DATE YYY-MM-DD a un texto en formato DD/MM/YYYY
        function transformarFecha(fechaInput) {
            if (!fechaInput) {
                console.log("No se seleccion√≥ una fecha.");
                return null;
            }

            // Crear un objeto de fecha a partir del valor del input (YYYY-MM-DD)
            const fecha1 = new Date(fechaInput);
            fecha1.setHours(fecha1.getHours() + 12);

            // Extraer d√≠a, mes y a√±o, asegurando 2 d√≠gitos para d√≠a y mes y 4 digitos para el a√±o
            const dia1 = String(fecha1.getDate()).padStart(2, '0');
            const mes1 = String(fecha1.getMonth() + 1).padStart(2, '0');   // Los meses empiezan en 0
            const ano1 = String(fecha1.getFullYear());

            // Formatear la fecha como DD/MM/YYYY
            const fechaTexto = `${dia1}/${mes1}/${ano1}`;
            return fechaTexto;
        }


        function borrar_div(nn) { }



    </script>

</body>

</html>