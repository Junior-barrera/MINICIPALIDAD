<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reclamos | Municipalidad de Arica</title>
    <link rel="stylesheet" href="reclamo.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<style>
    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }

    .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .header h1 {
        color: #2c3e50;
        font-size: 2.5rem;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #3498db, #000000);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .header p {
        color: #7f8c8d;
        font-size: 1.1rem;
    }

    .dashboard-grid {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }

    .filters-panel {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 25px;
        height: fit-content;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 20px;
    }

    .filters-panel h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .filter-group {
        margin-bottom: 25px;
    }

    .filter-group label {
        display: block;
        font-weight: 600;
        color: #34495e;
        margin-bottom: 10px;
        font-size: 0.95rem;
    }

    .filter-select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e1e8ed;
        border-radius: 12px;
        font-size: 14px;
        background: white;
        transition: all 0.3s ease;
    }

    .filter-select:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .search-box {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e1e8ed;
        border-radius: 12px;
        font-size: 14px;
        background: white;
        transition: all 0.3s ease;
    }

    .search-box:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .clear-filters {
        width: 100%;
        padding: 12px;
        background: linear-gradient(45deg, #e74c3c, #c0392b);
        color: white;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 15px;
    }

    .clear-filters:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
    }

    .main-content {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: linear-gradient(135deg, #002fff 0%);
        color: white;
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-5px);
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .stat-label {
        font-size: 1rem;
        opacity: 0.9;
    }

    .reclamos-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .reclamo-card {
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        border-left: 5px solid;
    }

    .reclamo-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .reclamo-card.aseo {
        border-left-color: #3498db;
    }

    .reclamo-card.iluminacion {
        border-left-color: #f39c12;
    }

    .reclamo-card.areas-verdes {
        border-left-color: #27ae60;
    }

    .reclamo-card.mantenimiento {
        border-left-color: #e74c3c;
    }

    .reclamo-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }

    .reclamo-id {
        font-weight: bold;
        color: #2c3e50;
        font-size: 1.1rem;
    }

    .estado-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .estado-pendiente {
        background: #fff3cd;
        color: #856404;
    }

    .estado-asignado {
        background: #d1ecf1;
        color: #0c5460;
    }

    .estado-resuelto {
        background: #d4edda;
        color: #155724;
    }

    .prioridad-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-left: 10px;
    }

    .prioridad-baja {
        background: #e8f5e8;
        color: #2e7d32;
    }

    .prioridad-media {
        background: #fff8e1;
        color: #f57f17;
    }

    .prioridad-alta {
        background: #ffebee;
        color: #c62828;
    }

    .prioridad-urgente {
        background: #f3e5f5;
        color: #7b1fa2;
    }

    .departamento-info {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        font-weight: 600;
    }

    .departamento-icon {
        font-size: 1.5rem;
        margin-right: 10px;
    }

    .reclamo-details {
        margin-bottom: 15px;
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 0.9rem;
    }

    .detail-label {
        font-weight: 600;
        color: #7f8c8d;
    }

    .detail-value {
        color: #2c3e50;
    }

    .descripcion {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
        font-style: italic;
        color: #495057;
        border-left: 3px solid #dee2e6;
    }

    .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #7f8c8d;
    }

    .no-results-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.5;
    }

    .export-buttons {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        justify-content: flex-end;
    }

    .export-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .export-pdf {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
        color: white;
    }

    .export-excel {
        background: linear-gradient(45deg, #27ae60, #219a52);
        color: white;
    }

    .export-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    @media (max-width: 1024px) {
        .dashboard-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .container {
            padding: 15px;
        }

        .reclamos-grid {
            grid-template-columns: 1fr;
        }

        .stats-row {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    /* Estilos para la nueva secci√≥n de PDF */
    .pdf-section {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-top: 24px;
    }

    .pdf-section h3 {
        color: #1e40af;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 20px;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .filter-group label {
        font-weight: 600;
        color: #374151;
    }

    .checkbox-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
        max-height: 120px;
        overflow-y: auto;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 12px;
    }

    .checkbox-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .checkbox-item input[type="checkbox"] {
        width: 16px;
        height: 16px;
        accent-color: #1e40af;
    }

    .checkbox-item label {
        font-weight: normal;
        cursor: pointer;
        flex: 1;
    }

    .selected-count {
        background: #dbeafe;
        border: 1px solid #3b82f6;
        border-radius: 8px;
        padding: 12px;
        margin: 16px 0;
        color: #1e40af;
        font-weight: 600;
    }

    .pdf-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    .pdf-btn {
        background: linear-gradient(135deg, #dc2626, #b91c1c);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
    }

    .pdf-btn:hover {
        background: linear-gradient(135deg, #b91c1c, #991b1b);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    }

    .pdf-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .clear-btn {
        background: #6b7280;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .clear-btn:hover {
        background: #4b5563;
    }

    .select-all-btn {
        background: #059669;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        margin-bottom: 8px;
    }

    .select-all-btn:hover {
        background: #047857;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .filter-grid {
            grid-template-columns: 1fr;
        }

        .pdf-actions {
            flex-direction: column;
        }
    }
</style>

<body>
    <!-- Header -->
    <header>
        <div class="top-header">
            <div class="logo">
                <img src="logo_MUNI.png" alt="Logo Municipalidad de Arica">
                <div class="logo-text">
                    <h1>ARICA</h1>
                    <span>MUNICIPALIDAD | mejor ciudad</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main content -->
    <section class="dashboard-container">
        <div class="dashboard-header">
            <h2 class="dashboard-title">Sistema de Reclamos DIMAO</h2>
            <button class="back-button" onclick="window.location.href='formulario-4tml'">
                <span class="back-icon">‚Üê</span> Volver al Inicio
            </button>
        </div>

        <!-- Statistics -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-number" id="totalReclamos">0</div>
                <div class="stat-label">Total Reclamos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="reclamosPendientes">0</div>
                <div class="stat-label">Pendientes</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="reclamosAsignados">0</div>
                <div class="stat-label">Asignados</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="reclamosResueltos">0</div>
                <div class="stat-label">Resueltos</div>
            </div>
        </div>

        <!-- Main content grid -->
        <div class="main-content">
            <!-- Form section -->
            <div class="form-section">
                <div class="form-header">
                    <h3>Nuevo Reclamo</h3>
                    <p>Complete el formulario para reportar su reclamo</p>
                </div>

                <div class="success-message" id="successMessage">
                    ¬°Reclamo enviado exitosamente!<br>Su n√∫mero de seguimiento es: <span id="trackingNumber"></span>
                </div>

                <form id="reclamoForm">
                    <div class="form-group">
                        <label>Departamento</label>
                        <div class="department-cards">
                            <div class="department-card" data-dept="aseo">
                                <div class="icon">üßπ</div>
                                <div class="name">Aseo</div>
                            </div>
                            <div class="department-card" data-dept="iluminacion">
                                <div class="icon">üí°</div>
                                <div class="name">Iluminaci√≥n</div>
                            </div>
                            <div class="department-card" data-dept="areas-verdes">
                                <div class="icon">üå≥</div>
                                <div class="name">√Åreas Verdes</div>
                            </div>
                            <div class="department-card" data-dept="mantenimiento">
                                <div class="icon">üîß</div>
                                <div class="name">Espacios p√∫blicos</div>
                            </div>
                        </div>

                        <!--  Sub-Categoria  -->

                        <!-- Subdepartment options for Aseo -->
                        <div class="subdepartment-options" id="aseo-options">
                            <label><strong>Seleccione la categor√≠a:</strong></label>
                            <div class="subdepartment-option">
                                <input type="radio" name="subdepartamento" value="aseo-calles"
                                    onclick="checkTrabajo('aseo', 0)">
                                <label for="aseo-calles">Aseo de Calles</label>
                            </div>
                            <div class="subdepartment-option">
                                <input type="radio" name="subdepartamento" value="extraccion-residuos"
                                    onclick="checkTrabajo('aseo', 1)">
                                <label for="extraccion-residuos">Extracci√≥n de Residuos (Basura)</label>
                            </div>
                        </div>

                        <!-- Subdepartment options for iluminacion -->
                        <div class="subdepartment-options" id="ilum-options">
                            <label><strong>Seleccione la categor√≠a:</strong></label>
                            <div class="subdepartment-option">
                                <input type="radio" name="subdepartamento" value="Luminarias"
                                    onclick="checkTrabajo('ilum', 0)">
                                <label for="aseo-calles">Luminarias</label>
                            </div>
                            <div class="subdepartment-option">
                                <input type="radio" name="subdepartamento" value="Postes"
                                    onclick="checkTrabajo('ilum', 1)">
                                <label for="extraccion-residuos">Postes</label>
                            </div>
                            <div class="subdepartment-option">
                                <input type="radio" name="subdepartamento" value="Mantenimiento"
                                    onclick="checkTrabajo('ilum', 2)">
                                <label for="extraccion-residuos">Mantenimiento y reposici√≥n</label>
                            </div>
                            <div class="subdepartment-option">
                                <input type="radio" name="subdepartamento" value="Semaforos"
                                    onclick="checkTrabajo('ilum', 3)">
                                <label for="extraccion-residuos">Semaforos</label>
                            </div>
                        </div>

                        <!-- Subdepartment options for Mantenimiento -->
                        <div class="subdepartment-options" id="manten-options">
                            <label><strong>Seleccione la categor√≠a:</strong></label>
                            <div class="subdepartment-option">
                                <input type="radio" name="subdepartamento" value="aseo-calles"
                                    onclick="checkTrabajo('mant', 0)">
                                <label for="aseo-calles">Aseo de Calles</label>
                            </div>
                            <div class="subdepartment-option">
                                <input type="radio" name="subdepartamento" value="extraccion-residuos"
                                    onclick="checkTrabajo('mant', 1)">
                                <label for="extraccion-residuos">Extracci√≥n de Residuos (Basura)</label>
                            </div>
                        </div>

                        <!-- Subdepartment options for Areas Verdes -->
                        <div class="subdepartment-options" id="verdes-options">
                            <label><strong>Seleccione la categor√≠a:</strong></label>
                            <div class="subdepartment-option">
                                <input type="radio" name="subdepartamento" value="aseo-calles"
                                    onclick="checkTrabajo('verd', 0)">
                                <label for="aseo-calles">Aseo de Calles</label>
                            </div>
                            <div class="subdepartment-option">
                                <input type="radio" name="subdepartamento" value="extraccion-residuos"
                                    onclick="checkTrabajo('verd', 1)">
                                <label for="extraccion-residuos">Extracci√≥n de Residuos (Basura)</label>
                            </div>
                        </div>

                    </div>

                    <!--  Sub-Sub-Categoria  -->
                    <div class="form-group">
                        <div id="trabajodept-options"></div>
                    </div>


                    <div class="form-group">
                        <label for="procedencia">Procedencia</label>
                        <select id="procedencia" name="procedencia" required onchange="guardar_Procedencia()">
                            <option value="">Seleccione procedencia</option>
                            <option value="presencial">üè¢ Presencial</option>
                            <option value="telefonica">üìû Telef√≥nica</option>
                            <option value="correo">üìß Correo electr√≥nico</option>
                            <option value="web">üåê P√°gina web</option>
                            <option value="whatsapp">üì± WhatsApp</option>
                            <option value="otro">üîç Otro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="nombre">Nombre Completo *</label>
                        <input type="text" id="nombre" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label for="telefono">Tel√©fono</label>
                        <input type="tel" id="telefono" class="form-control">
                    </div>

                    <div class="form-group">
                        <label for="direccion">Direcci√≥n del Problema *</label>
                        <input type="text" id="direccion" class="form-control" required
                            placeholder="Ej: Calle 21 de Mayo con Maip√∫">
                    </div>

                    <div class="form-group">
                        <label for="prioridad">Prioridad</label>
                        <select id="prioridad" class="form-control select">
                            <option value="baja">Baja</option>
                            <option value="media" selected>Media</option>
                            <option value="alta">Alta</option>
                            <option value="urgente">Urgente</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="descripcion">Descripci√≥n del Problema *</label>
                        <textarea id="descripcion" class="form-control textarea" required
                            placeholder="Describa detalladamente el problema que desea reportar..."></textarea>
                    </div>

                    <button type="submit" class="submit-btn">Enviar Reclamo</button>
                </form>
            </div>

            <!-- Reports section -->
            <div class="reports-section">
                <div class="reports-header">
                    <h3>Reclamos Registrados</h3>

                </div>

                <div class="reports-list" id="reportsList">
                    <div style="text-align: center; padding: 40px; color: #86868b;">
                        <p>No hay reclamos registrados a√∫n.</p>
                        <p>Los reclamos aparecer√°n aqu√≠ una vez que sean enviados.</p>
                    </div>
                </div>

                <div class="reports-header">
                    <p>
                        <hr>
                    </p>
                </div>

                <div class="reports-header">
                    <h3>Reclamos Resueltos</h3>
                    <div hidden>
                        <div class="filter-tabs">
                            <div class="filter-tab active" data-filter="todos" data-section="resueltos">Todos</div>
                            <div class="filter-tab" data-filter="aseo" data-section="resueltos">Aseo</div>
                            <div class="filter-tab" data-filter="iluminacion" data-section="resueltos">Iluminaci√≥n</div>
                            <div class="filter-tab" data-filter="areas-verdes" data-section="resueltos">√Åreas Verdes
                            </div>
                            <div class="filter-tab" data-filter="mantenimiento" data-section="resueltos">Mantenimiento
                            </div>
                        </div>
                    </div>
                </div>
                <div class="reports-list" id="reclamosResueltosList">
                    <div style="text-align: center; padding: 40px; color: #86868b;">
                        <p>No hay reclamos resueltos a√∫n.</p>
                        <p>Los reclamos solucionados aparecer√°n aqu√≠.</p>
                    </div>
                </div>
            </div>

            <!-- FORMULARIO DE ASIGNACION DEL TRABAJO -->

            <div id="formularioAsignacionModal">
                <div class="formularioAsignacion">
                    <h3>Asignacion del trabajo</h3>
                    <br>
                    <label>Trabajador asignado:</label><br>
                    <input type="text" class="form-control" id="trabajador" name="trabajador"
                        placeholder="Ingresa el nombre del trabajador" oninput="showSuggestionsTrabajador()">
                    <div class="color_suggestions" id="suggestionsTrabajador"></div><br>
                    <label>Detalle:</label><br>
                    <textarea id="detalle"></textarea><br>
                    <!--
                    <label>Edad:</label><br>
                    <input type="number" id="edad"><br>
                    <label>Correo:</label><br>
                    <input type="email" id="correo"><br>
                    <label>Pa√≠s:</label><br>
                    <input type="text" id="pais"><br>
                    -->
                    <p></p>
                    <div class="filter-tabs">
                        <div class="filter-tab active" onclick="enviarFormulario()">ASIGNAR</div>
                        <div class="filter-tab" onclick="cerrarFormulario()">SALIR</div>
                    </div>
                </div>
            </div>


        </div>
    </section>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üèõÔ∏è Visualizador de Reclamos DIMAO</h1>
            <p>Sistema de Gesti√≥n Integral - Municipalidad de Arica</p>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Filters Panel -->
            <div class="filters-panel">
                <h3>üîç Filtros Avanzados</h3>

                <div class="filter-group">
                    <label>Buscar en todos los campos:</label>
                    <input type="text" id="searchBox" class="search-box"
                        placeholder="Buscar reclamo, nombre, direcci√≥n...">
                </div>

                <div class="filter-group">
                    <label>Departamento:</label>
                    <select id="filterDepartamento" class="filter-select">
                        <option value="">Todos los departamentos</option>
                        <option value="aseo">üßπ Aseo</option>
                        <option value="iluminacion">üí° Iluminaci√≥n</option>
                        <option value="areas-verdes">üå≥ √Åreas Verdes</option>
                        <option value="mantenimiento">üîß Espacios P√∫blicos</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Estado:</label>
                    <select id="filterEstado" class="filter-select">
                        <option value="">Todos los estados</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="asignado">Asignado</option>
                        <option value="resuelto">Resuelto</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Prioridad:</label>
                    <select id="filterPrioridad" class="filter-select">
                        <option value="">Todas las prioridades</option>
                        <option value="baja">Baja</option>
                        <option value="media">Media</option>
                        <option value="alta">Alta</option>
                        <option value="urgente">Urgente</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Ordenar por:</label>
                    <select id="sortBy" class="filter-select">
                        <option value="fecha-desc">Fecha (M√°s reciente)</option>
                        <option value="fecha-asc">Fecha (M√°s antiguo)</option>
                        <option value="prioridad">Prioridad</option>
                        <option value="departamento">Departamento</option>
                        <option value="estado">Estado</option>
                    </select>
                </div>

                <button class="clear-filters" onclick="clearAllFilters()">
                    üóëÔ∏è Limpiar Filtros
                </button>
            </div>
            <!-- Nueva secci√≥n para generar PDF -->
            <div class="pdf-section">
                <h3>üìÑ Generar Reportes PDF</h3>
                <p>Seleccione los reclamos que desea incluir en el reporte PDF</p>

                <div class="filter-grid">
                    <!-- Filtro por Estado -->
                    <div class="filter-group">
                        <label>Estado de Reclamos</label>
                        <button class="select-all-btn" onclick="selectAllEstados()">Seleccionar Todos</button>
                        <div class="checkbox-group" id="estadoCheckboxes">
                            <div class="checkbox-item">
                                <input type="checkbox" id="estado-pendiente" value="pendiente"
                                    onchange="updateSelection()">
                                <label for="estado-pendiente">Pendientes</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="estado-asignado" value="asignado"
                                    onchange="updateSelection()">
                                <label for="estado-asignado">Asignados</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="estado-resuelto" value="resuelto"
                                    onchange="updateSelection()">
                                <label for="estado-resuelto">Resueltos</label>
                            </div>
                        </div>
                    </div>

                    <!-- Filtro por Departamento -->
                    <div class="filter-group">
                        <label>Departamentos</label>
                        <button class="select-all-btn" onclick="selectAllDepartamentos()">Seleccionar Todos</button>
                        <div class="checkbox-group" id="departamentoCheckboxes">
                            <div class="checkbox-item">
                                <input type="checkbox" id="dept-aseo" value="aseo" onchange="updateSelection()">
                                <label for="dept-aseo">Aseo</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dept-iluminacion" value="iluminacion"
                                    onchange="updateSelection()">
                                <label for="dept-iluminacion">Iluminaci√≥n</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dept-areas-verdes" value="areas-verdes"
                                    onchange="updateSelection()">
                                <label for="dept-areas-verdes">√Åreas Verdes</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="dept-mantenimiento" value="mantenimiento"
                                    onchange="updateSelection()">
                                <label for="dept-mantenimiento">Mantenimiento</label>
                            </div>
                        </div>
                    </div>

                    <!-- Filtro por Prioridad -->
                    <div class="filter-group">
                        <label>Prioridad</label>
                        <button class="select-all-btn" onclick="selectAllPrioridades()">Seleccionar Todos</button>
                        <div class="checkbox-group" id="prioridadCheckboxes">
                            <div class="checkbox-item">
                                <input type="checkbox" id="prio-baja" value="baja" onchange="updateSelection()">
                                <label for="prio-baja">Baja</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="prio-media" value="media" onchange="updateSelection()">
                                <label for="prio-media">Media</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="prio-alta" value="alta" onchange="updateSelection()">
                                <label for="prio-alta">Alta</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="prio-urgente" value="urgente" onchange="updateSelection()">
                                <label for="prio-urgente">Urgente</label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="selected-count" id="selectedCount">
                    Reclamos seleccionados: 0
                </div>

                <div class="pdf-actions">
                    <button class="pdf-btn" id="generatePDFBtn" onclick="generatePDF()" disabled>
                        üìÑ Generar PDF
                    </button>
                    <button class="clear-btn" onclick="clearAllSelections()">
                        Limpiar Selecci√≥n
                    </button>
                </div>
            </div>

            <!-- FORMULARIO DE ASIGNACION DEL TRABAJO -->
            <div id="formularioAsignacionModal">
                <div class="formularioAsignacion">
                    <h3>Asignacion del trabajo</h3>
                    <br>
                    <label>Trabajador asignado:</label><br>
                    <input type="text" class="form-control" id="trabajador" name="trabajador"
                        placeholder="Ingresa el nombre del trabajador" oninput="showSuggestionsTrabajador()">
                    <div class="color_suggestions" id="suggestionsTrabajador"></div><br>
                    <label>Detalle:</label><br>
                    <textarea id="detalle"></textarea><br>
                    <p></p>
                    <div class="filter-tabs">
                        <div class="filter-tab active" onclick="enviarFormulario()">ASIGNAR</div>
                        <div class="filter-tab" onclick="cerrarFormulario()">SALIR</div>
                    </div>
                </div>
            </div>
        </div>
        </section>

        <!-- Footer -->
        <footer>
            <div class="footer-container">
                <div class="footer-column">
                    <h3>Municipalidad de Arica</h3>
                    <p>Renato Rocca, Arica</p>
                    <p>Anexo: 6959</p>
                    <p>Email: roberto.mamani@municipalidadarica.cl</p>
                    <div class="social-icons">
                        <a href="#">üìò</a>
                        <a href="#">üì±</a>
                        <a href="#">üê¶</a>
                        <a href="#">üì∏</a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Sistema de Reclamos</h3>
                    <p style="line-height: 1.6;">
                        Sistema integral para la gesti√≥n de reclamos municipales que permite una
                        <strong>comunicaci√≥n directa</strong> entre ciudadanos y departamentos municipales,
                        facilitando el <strong>seguimiento</strong> y <strong>resoluci√≥n eficiente</strong>
                        de problemas urbanos para mejorar la calidad de vida de los arique√±os.
                    </p>
                </div>
                <div class="footer-column">
                    <h3>Departamentos</h3>
                    <ul>
                        <li><strong>Aseo:</strong> Limpieza y residuos</li>
                        <li><strong>Iluminaci√≥n:</strong> Alumbrado p√∫blico</li>
                        <li><strong>√Åreas Verdes:</strong> Parques y jardines</li>
                        <li><strong>Espacios p√∫blicos:</strong> Mantenimiento</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2025 Municipalidad de Arica. Todos los derechos reservados.</p>
                <p>Desarrollado por Junior Barrera</p>
            </div>
        </footer>

        <!-- Assistant button -->
        <div class="assistant-button" onclick="openAssistance()">üí¨</div>


        <script>

            var departamento = "";
            var datosAsignados = "";
            var setOpera = new Array();
            var inform = new Array();
            var dato_rc = new Array();

            var reclamosPendientes = new Array();
            var reclamosAsignados = new Array();
            var reclamosResueltos = new Array();


            const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwie8fU9eKYFvDkIKOOk7Sahe2FKV3mE3NmYjbGyZNvpeitn2k4ONh0LVP2Zjsh2XU/exec";     // Implementacion
            // const WEB_APP_URL = dir_rec;

            if (localStorage.getItem('reclamos_procedencias')) {
                baul = localStorage.getItem('reclamos_procedencias');
                document.getElementById("procedencia").value = baul;  // Cargar el valor de procedencia
            }

            // Cargar los datos desde la Base de Datos
            aanum = 0;
            var recl_total = 0;
            var recl_pendi = 0;
            var recl_asign = 0;
            var recl_listo = 0;

            var operaIlum = new Array();
            var operaMant = new Array();
            var operaAseo = new Array();
            var operaVerd = new Array();

            var tipOpera = new Array();

            fetch(WEB_APP_URL + "?h=R")           // Lee las hojas RECLAMOS
                .then(response => response.json())
                .then(data => {
                    // Asigna los datos recibidos a las variables bidimensionales
                    dato_rc = data.dato_rc;      // Datos de la hoja "RECLAMOS"

                    if (dato_rc.length > 0) {
                        jj = 0;
                        for (ii = 0; ii < dato_rc.length; ii++) {
                            if (dato_rc[ii][0] == "") { break; }
                            if (dato_rc[ii][1] != "") {
                                if (ii > 0) {
                                    if (dato_rc[ii][2].toLowerCase() == "iluminacion") {
                                        operaIlum.push(dato_rc[ii][13].trim());
                                    } else if (dato_rc[ii][2].toLowerCase() == "mantenimiento") {
                                        operaMant.push(dato_rc[ii][13].trim());
                                    } else if (dato_rc[ii][2].toLowerCase() == "aseo") {
                                        operaAseo.push(dato_rc[ii][13].trim());
                                    } else if (dato_rc[ii][2].toLowerCase() == "areas verdes") {
                                        operaVerd.push(dato_rc[ii][13].trim());
                                    }
                                }
                                if (dato_rc[ii][1].toUpperCase() == "PENDIENTE") { recl_pendi++; }
                                if (dato_rc[ii][1].toUpperCase() == "ASIGNADO") { recl_asign++; }
                                if (dato_rc[ii][1].toUpperCase() == "RESUELTO") { recl_listo++; }
                            }
                        }
                    }
                    recl_total = recl_asign + recl_pendi + recl_listo;
                    document.getElementById("totalReclamos").textContent = recl_total;
                    document.getElementById("reclamosPendientes").textContent = recl_pendi;
                    document.getElementById("reclamosAsignados").textContent = recl_asign;
                    document.getElementById("reclamosResueltos").textContent = recl_listo;
                    // Eliminar duplicados y ordenar
                    operaAseo = [...new Set(operaAseo)].sort();
                    operaIlum = [...new Set(operaIlum)].sort();
                    operaMant = [...new Set(operaMant)].sort();
                    operaVerd = [...new Set(operaVerd)].sort();
                })
                .catch(error => {
                    console.error('Error al obtener los datos:', error);
                });


            // Funci√≥n para manejar el cambio de sub-sub-categor√≠a
            function checkTrabajo(id_dept, nn) {

                var subtrabajo = new Array();

                var subtrab_aseo = new Array();
                var subtrab_ilum = new Array();
                var subtrab_mant = new Array();
                var subtrab_verd = new Array();

                subtrab_aseo[0] = ["Aseo de Calles", "Aseo en los parques", "Aseo en las playas", "Limpieza del humedal", ""];
                subtrab_aseo[1] = ["Extraccion de residuos domiciliarios", "Extraccion de residuos industriales", "Eliminacion de microbasurles", "", ""];

                subtrab_ilum[0] = ["Sector apagado", "Luminarias quemadas", "Instalacion de nueva luminaria", "Eventos", "Reparaci√≥n de TDA"];
                subtrab_ilum[1] = ["Instalaci√≥n nuevo P/T/M", "Instalaci√≥n de poste de concreto", "Instalaci√≥n de brazo", "Retiro de poste derribado", "Instalaci√≥n gancho y luminaria"];
                subtrab_ilum[2] = ["Regular reloj control", "Cambio de reloj control", "Retiro de cables cortados", "Reposici√≥n de cables por robo", "Reparaci√≥n de plaza y/o multicancha"];
                subtrab_ilum[3] = ["Semaforo apagado", "Revisi√≥n de semaforo", "Poner semaforos en verde", "", ""];

                baul = (id_dept).toString().toLowerCase();
                subtrabajo.length = 0; // Limpiar el array antes de agregar nuevos elementos
                if (baul == "aseo") { subtrabajo = subtrab_aseo[nn]; }
                if (baul == "ilum") { subtrabajo = subtrab_ilum[nn]; }
                if (baul == "mant") { subtrabajo = subtrab_mant[nn]; }
                // if (baul == "verd") { subtrabajo = subtrab_verd; }
                baul = "";
                if (subtrabajo.length > 0) {
                    baul = "<label><strong>Seleccione el tipo de trabajo:</strong></label>";
                    for (tt = 0; tt < subtrabajo.length; tt++) {
                        if (subtrabajo[tt] == "") { break; }
                        baul += "<div class='trabajo-option'>" +
                            "<input type='radio' name='trabajo' value=" + subtrabajo[tt].replace(/ /g, '-') + ">" +
                            "<label for='aseo-calles'>" + subtrabajo[tt] + "</label>" +
                            "</div>";
                    }
                    baul += "";
                    document.getElementById("trabajodept-options").innerHTML = baul;
                }
            }


            // Sistema de gesti√≥n de reclamos
            class SistemaReclamos {
                constructor() {
                    this.reclamos = JSON.parse(localStorage.getItem('reclamos') || '[]');
                    this.contadorId = parseInt(localStorage.getItem('contadorId') || '1');
                    this.departamentoSeleccionado = null;
                    this.filtroActivo = 'todos';
                    this.filtroResueltosActivo = 'todos';
                    this.passwordCorrecta = 'dimaoreclamos2025';

                    this.inicializar();
                    this.actualizarEstadisticas();
                    this.mostrarReclamos();
                    this.mostrarReclamosResueltos();
                }

                inicializar() {
                    // Event listeners para departamentos
                    document.querySelectorAll('.department-card').forEach(card => {
                        card.addEventListener('click', (e) => this.seleccionarDepartamento(e));
                    });

                    // Event listener para formulario
                    document.getElementById('reclamoForm').addEventListener('submit', (e) => this.enviarReclamo(e));
                    // document.getElementById('reclamoForm').addEventListener('submit', function (e) { enviarReclamo(e); });

                    // Event listeners para filtros de reclamos pendientes
                    document.querySelectorAll('.filter-tab[data-section="pendientes"]').forEach(tab => {
                        tab.addEventListener('click', (e) => this.cambiarFiltro(e));
                    });

                    // Event listeners para filtros de reclamos resueltos
                    document.querySelectorAll('.filter-tab[data-section="resueltos"]').forEach(tab => {
                        tab.addEventListener('click', (e) => this.cambiarFiltroResueltos(e));
                    });
                }

                seleccionarDepartamento(e) {
                    // Remover selecci√≥n anterior
                    document.querySelectorAll('.department-card').forEach(card => {
                        card.classList.remove('selected');
                    });

                    // Ocultar todas las opciones de subdepartamento
                    document.querySelectorAll('.subdepartment-options').forEach(option => {
                        option.classList.remove('show');
                    });

                    // Ocultar todas las opciones de trabajos
                    document.querySelectorAll('.subdepartment-options').forEach(option => {
                        option.classList.remove('show');
                    });

                    // document.getElementById("subdepartment-options").innerHTML = "";    // Limpiar tipo subdepartamento
                    // document.getElementById("trabajodept-options").innerHTML = "";      // Limpiar tipo trabajo

                    // Seleccionar nuevo departamento
                    const card = e.currentTarget;
                    card.classList.add('selected');
                    this.departamentoSeleccionado = card.dataset.dept;
                    departamento = (this.departamentoSeleccionado).toString().toUpperCase();
                    this.mostrarReclamos();
                    this.mostrarReclamosResueltos();
                    this.actualizarEstadisticas();


                    // Mostrar subdepartamento si es aseo
                    if (this.departamentoSeleccionado === 'aseo') {
                        document.getElementById('aseo-options').classList.add('show');
                        this.actualizarEstadisticas();
                        this.mostrarReclamos();
                        this.mostrarReclamosResueltos();
                        tipOpera = operaAseo;  // Asignar el array de operaciones de aseo
                    }

                    // Mostrar subdepartamento si es iluminacion
                    if (this.departamentoSeleccionado === 'iluminacion') {
                        document.getElementById('ilum-options').classList.add('show');
                        this.actualizarEstadisticas();
                        this.mostrarReclamos();
                        this.mostrarReclamosResueltos();
                        tipOpera = operaIlum;  // Asignar el array de operaciones de iluminacion
                    }

                    // Mostrar subdepartamento si es mantenimiento
                    if (this.departamentoSeleccionado === 'mantenimiento') {
                        // document.getElementById('manten-options').classList.add('show');
                        tipOpera = operaMant;  // Asignar el array de operaciones de mantenimiento
                    }

                    // Mostrar subdepartamento si es areas verdes
                    if (this.departamentoSeleccionado === 'areas-verdes') {
                        // document.getElementById('verde-options').classList.add('show');
                        tipOpera = operaVerd;  // Asignar el array de operaciones de mantenimiento
                    }

                    // Limpiar selecci√≥n de subdepartamento
                    document.querySelectorAll('input[name="subdepartamento"]').forEach(radio => {
                        radio.checked = false;
                    });
                }

                enviarReclamo(e) {

                    // Prevenir el env√≠o del formulario por defecto
                    e.preventDefault();

                    if (!this.departamentoSeleccionado) {
                        alert('Por favor seleccione un departamento');
                        return;
                    }

                    const formData = new FormData(e.target);
                    console.log('Datos del formulario:\n', formData);

                    // Obtener subdepartamento si es aseo
                    let subdepartamento = null;
                    if (this.departamentoSeleccionado === 'aseo') {
                        subdepartamento = formData.get('subdepartamento');
                        if (!subdepartamento) {
                            alert('Por favor seleccione el √°rea espec√≠fica de aseo');
                            return;
                        }
                    }

                    const reclamo = {
                        id: this.contadorId++,
                        trackingNumber: `REC-${Date.now()}`,
                        departamento: this.departamentoSeleccionado,
                        subdepartamento: formData.get('subdepartamento'),
                        trabajo: formData.get('trabajo').replace(/-/g, ' ') || (document.getElementById('trabajo').value).replace(/-/g, ''),
                        nombre: formData.get('nombre') || document.getElementById('nombre').value,
                        telefono: formData.get('telefono') || document.getElementById('telefono').value,
                        direccion: formData.get('direccion') || document.getElementById('direccion').value,
                        prioridad: formData.get('prioridad') || document.getElementById('prioridad').value,
                        descripcion: formData.get('descripcion') || document.getElementById('descripcion').value,
                        fecha: new Date().toISOString(),
                        estado: 'pendiente',
                        solucionado: false,
                        fechaResolucion: null
                    };

                    if (reclamo) {

                        inform.length = 0;
                        baul = reclamo.departamento;
                        inform[0] = "";
                        inform[1] = reclamo.estado.toString().toUpperCase();
                        inform[2] = reclamo.departamento.toString().toUpperCase();
                        inform[3] = reclamo.subdepartamento.toString().toUpperCase();
                        inform[4] = reclamo.trabajo.toString().toUpperCase();
                        inform[5] = reclamo.descripcion.toString().toUpperCase();
                        inform[6] = (document.getElementById("procedencia").value).toString().toUpperCase();
                        inform[7] = reclamo.prioridad.toString().toUpperCase();
                        inform[8] = reclamo.fecha;
                        inform[9] = reclamo.nombre.toString().toUpperCase();
                        inform[10] = reclamo.direccion.toString().toUpperCase();
                        inform[11] = reclamo.telefono.toString().toUpperCase();

                        console.log('Datos de la variable reclamo:\n', reclamo);


                        this.reclamos.push(reclamo);          // Agregar el nuevo reclamo al array de reclamos
                        this.guardarDatos();

                    }



                    // Mostrar mensaje de √©xito
                    document.getElementById('trackingNumber').textContent = reclamo.trackingNumber;
                    document.getElementById('successMessage').style.display = 'block';

                    // Limpiar formulario
                    document.getElementById('reclamoForm').reset();
                    document.querySelectorAll('.department-card').forEach(card => {
                        card.classList.remove('selected');
                    });
                    document.querySelectorAll('.subdepartment-options').forEach(option => {
                        option.classList.remove('show');
                    });
                    this.departamentoSeleccionado = null;

                    // Ocultar mensaje despu√©s de 5 segundos
                    setTimeout(() => {
                        document.getElementById('successMessage').style.display = 'none';
                    }, 5000);

                    if (inform.length > 0) {
                        enviarDatos("RECLAMOS", 0, inform, 1);
                        dato_rc.push(inform);    // Agregar el nuevo reclamo a la lista de datos
                        // Actualizar vista
                        this.actualizarEstadisticas();
                        this.mostrarReclamos();
                        this.mostrarReclamosResueltos();
                        // inform.length = 0;
                    }

                    // Scroll al top
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }


                // Funci√≥n mejorada para marcar reclamo como solucionado
                marcarSolucionado(reclamoId, solucionado) {
                    var reclamo = this.reclamos.find(r => r.id === reclamoId);
                    if (reclamo) {
                        // Si ya est√° solucionado y se quiere desmarcar, pedir contrase√±a
                        if (reclamo.solucionado && !solucionado) {
                            const password = prompt('Ingrese la contrase√±a para desmarcar este reclamo como solucionado:');
                            if (password !== this.passwordCorrecta) {
                                alert('Contrase√±a incorrecta. No se puede modificar el estado del reclamo.');
                                // Revertir el checkbox
                                document.querySelector(`input[onchange*="marcarSolucionado(${reclamoId}"]`).checked = true;
                                return;
                            }
                        }

                        reclamo.solucionado = solucionado;

                        if (solucionado) {
                            reclamo.estado = 'resuelto';
                            reclamo.fechaResolucion = new Date().toISOString();
                        } else {
                            reclamo.estado = 'pendiente';
                            reclamo.fechaResolucion = null;
                        }

                        this.guardarDatos();
                        this.actualizarEstadisticas();
                        this.mostrarReclamos();
                        this.mostrarReclamosResueltos();
                    }
                }

                cambiarFiltro(e) {
                    // Remover filtro activo anterior en la secci√≥n de pendientes
                    document.querySelectorAll('.filter-tab[data-section="pendientes"]').forEach(tab => {
                        tab.classList.remove('active');
                    });

                    // Activar nuevo filtro
                    e.target.classList.add('active');
                    this.filtroActivo = e.target.dataset.filter;

                    // Mostrar reclamos filtrados
                    this.mostrarReclamos();
                }

                cambiarFiltroResueltos(e) {
                    // Remover filtro activo anterior en la secci√≥n de resueltos
                    document.querySelectorAll('.filter-tab[data-section="resueltos"]').forEach(tab => {
                        tab.classList.remove('active');
                    });

                    // Activar nuevo filtro
                    e.target.classList.add('active');
                    this.filtroResueltosActivo = e.target.dataset.filter;

                    // Mostrar reclamos resueltos filtrados
                    this.mostrarReclamosResueltos();
                }

                // Funci√≥n para mostrar solo reclamos NO solucionados
                mostrarReclamos() {

                    document.getElementById("trabajodept-options").innerHTML = "";      // Limpiar tipo trabajo

                    const container = document.getElementById('reportsList');

                    if (dato_rc && dato_rc.length > 0) {
                        this.reclamos.length = 0;     // Objeto contenedor

                        for (let i = 1; i < dato_rc.length; i++) {

                            var baul1 = false;
                            var baul2 = departamento.toUpperCase();

                            if (dato_rc[i][0] == "" && dato_rc[i][1] == "") { break; }
                            if (dato_rc[i][2].toUpperCase() == baul2) {
                                if ((dato_rc[i][1]).toUpperCase() == "TERMINADO") { baul1 = true; }
                                this.reclamos[i - 1] = {
                                    id: Number(i - 1),
                                    trackingNumber: dato_rc[i][0],
                                    departamento: dato_rc[i][2],
                                    subdepartamento: dato_rc[i][3],
                                    trabajo: dato_rc[i][4],
                                    descripcion: dato_rc[i][5],
                                    direccion: dato_rc[i][10],
                                    estado: dato_rc[i][1],
                                    // fecha: new Date(dato_rc[i][8]).toISOString(),
                                    fecha: dato_rc[i][8],
                                    fechaResolucion: dato_rc[i][12],
                                    nombre: dato_rc[i][9],
                                    prioridad: dato_rc[i][7],
                                    procedencia: dato_rc[i][6],
                                    solucionado: baul1,
                                    telefono: dato_rc[i][11]
                                };
                            }
                        }
                    }

                    // Filtrar solo reclamos NO solucionados
                    reclamosPendientes = this.reclamos.filter(reclamo => !reclamo.solucionado);

                    // Aplicar filtro adicional por departamento
                    if (this.filtroActivo !== 'todos') {
                        reclamosPendientes = reclamosPendientes.filter(reclamo =>
                            reclamo.departamento === this.filtroActivo
                        );
                    }

                    if (reclamosPendientes.length === 0) {
                        container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #86868b;">
                    <p>No hay reclamos pendientes${this.filtroActivo !== 'todos' ? ' para este departamento' : ' en este momento'}.</p>
                    <p>Los reclamos aparecer√°n aqu√≠ una vez que sean enviados.</p>
                </div>
            `;
                        return;
                    }

                    var numerar = 0;

                    if (localStorage.getItem('reclamos_procedencias')) {
                        baul = localStorage.getItem('reclamos_procedencias');
                        document.getElementById("procedencia").value = baul;  // Cargar el valor de procedencia
                    }

                    // Mostrar reclamos ordenados por fecha (m√°s recientes primero)
                    reclamosPendientes.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

                    container.innerHTML = reclamosPendientes.map(reclamo => {

                        if (numerar == 0) {
                            baul = reclamo.departamento;
                            inform[0] = "0";
                            inform[1] = reclamo.estado.toString().toUpperCase();
                            inform[2] = reclamo.departamento.toString().toUpperCase();
                            inform[3] = reclamo.subdepartamento.toString().toUpperCase();
                            inform[4] = reclamo.trabajo.toString().toUpperCase();
                            inform[5] = reclamo.descripcion.toString().toUpperCase();
                            inform[6] = (document.getElementById("procedencia").value).toString().toUpperCase();
                            inform[7] = reclamo.prioridad.toString().toUpperCase();
                            // inform[8] = formatearFecha2(reclamo.fecha);
                            inform[8] = reclamo.fecha;
                            inform[9] = reclamo.nombre.toString().toUpperCase();
                            inform[10] = reclamo.direccion.toString().toUpperCase();
                            inform[11] = reclamo.telefono.toString().toUpperCase();
                        }
                        numerar++;

                        return `
            <div class="report-item">
                <div class="report-header">
                    <div class="report-id">#${reclamo.id} - ${reclamo.trackingNumber}</div>
                    <div class="report-status status-${reclamo.estado}">${this.obtenerTextoEstado(reclamo.estado)}</div>
                    <div class="checkbox-container">
                        <label class="checkbox-label">
                            <input type="checkbox" 
                                   class="solucion-checkbox" 
                                   onchange="sistemaGlobal.marcarSolucionado(${reclamo.id}, this.checked)">
                            <span class="checkmark"></span>
                            Marcar como Solucionado
                        </label>
                    </div>
                </div>
                <div class="report-info">
                    <strong>Departamento:</strong> ${this.obtenerNombreDepartamento(reclamo.departamento)}
                    ${reclamo.subdepartamento ? ` - ${this.obtenerNombreSubdepartamento(reclamo.subdepartamento)}` : ''}
                </div>
                <div class="report-info">
                    <strong>Trabajo:</strong> ${this.obtenerNombretrabajo(reclamo.trabajo)}
                </div>
                <div class="report-info">
                    <strong>Direcci√≥n:</strong> ${reclamo.direccion}
                </div>
                <div class="report-info">
                    <strong>Prioridad:</strong> ${reclamo.prioridad.charAt(0).toUpperCase() + reclamo.prioridad.slice(1)}
                </div>
                <div class="report-info">
                    <strong>Fecha del Reclamo:</strong> ${this.formatearFecha(reclamo.fecha)}
                </div>
                <a></a> ${datosAsignados}   
                <div class="report-description">
                    <strong>Descripci√≥n:</strong> ${reclamo.descripcion}
                </div>
                <br>
                <!--
                <div class="filter-tabs">
                    <div class="filter-tab active" onclick="abrirFormulario()">Asignar trabajo</div>
                </div>
                -->
            </div>
        `}).join('');

                    if (baul == "iluminacion") { tipOpera = operaIlum; }
                    if (baul == "aseo") { tipOpera = operaAseo; }
                    if (baul == "mantenimiento") { tipOpera = operaMant; }
                    if (baul == "areas-verdes") { tipOpera = operaVerd; }
                    baul = 0;

                    // enviarDatos("RECLAMOS", 0, inform, 1);

                }

                // Nueva funci√≥n para mostrar reclamos resueltos
                mostrarReclamosResueltos() {
                    const container = document.getElementById('reclamosResueltosList');

                    if (!container) {
                        console.warn('Contenedor de reclamos resueltos no encontrado');
                        return;
                    }

                    // Filtrar solo reclamos solucionados
                    let reclamosResueltos = this.reclamos.filter(reclamo => reclamo.solucionado);

                    // Aplicar filtro adicional por departamento
                    if (this.filtroResueltosActivo !== 'todos') {
                        reclamosResueltos = reclamosResueltos.filter(reclamo =>
                            reclamo.departamento === this.filtroResueltosActivo
                        );
                    }

                    if (reclamosResueltos.length === 0) {
                        container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #86868b;">
                    <p>No hay reclamos resueltos${this.filtroResueltosActivo !== 'todos' ? ' para este departamento' : ' a√∫n'}.</p>
                    <p>Los reclamos solucionados aparecer√°n aqu√≠.</p>
                </div>
            `;
                        return;
                    }

                    // Mostrar reclamos resueltos ordenados por fecha de resoluci√≥n (m√°s recientes primero)
                    reclamosResueltos.sort((a, b) => new Date(b.fechaResolucion) - new Date(a.fechaResolucion));

                    container.innerHTML = reclamosResueltos.map(reclamo => `
            <div class="report-item solucionado">
                <div class="report-header">
                    <div class="report-id">#${reclamo.id} - ${reclamo.trackingNumber}</div>
                    <div class="report-status status-resuelto">Resuelto</div>
                    <div class="checkbox-container">
                        <label class="checkbox-label">
                            <input type="checkbox" 
                                   class="solucion-checkbox" 
                                   checked
                                   onchange="sistemaGlobal.marcarSolucionado(${reclamo.id}, this.checked)">
                            <span class="checkmark"></span>
                            Solucionado ‚úì
                        </label>
                    </div>
                </div>
                <div class="report-info">
                    <strong>Departamento:</strong> ${this.obtenerNombreDepartamento(reclamo.departamento)}
                    ${reclamo.subdepartamento ? ` - ${this.obtenerNombreSubdepartamento(reclamo.subdepartamento)}` : ''}
                </div>
                <div class="report-info">
                    <strong>Direcci√≥n:</strong> ${reclamo.direccion}
                </div>
                <div class="report-info">
                    <strong>Prioridad:</strong> ${reclamo.prioridad.charAt(0).toUpperCase() + reclamo.prioridad.slice(1)}
                </div>
                <div class="report-info">
                    <strong>Fecha del Reclamo:</strong> ${this.formatearFecha(reclamo.fecha)}
                </div>
                <div class="report-info">
                    <strong>Fecha de Resoluci√≥n:</strong> ${this.formatearFecha(reclamo.fechaResolucion)}
                </div>
                <a></a> ${datosAsignados}
                <div class="report-description">
                    <strong>Descripci√≥n:</strong> ${reclamo.descripcion}
                </div>
                <div class="solucion-marca">‚úÖ RECLAMO SOLUCIONADO</div>
            </div>
        `).join('');
                }

                obtenerTextoEstado(estado) {
                    const estados = {
                        'pendiente': 'Pendiente',
                        'proceso': 'En Proceso',
                        'resuelto': 'Resuelto'
                    };
                    return estados[estado] || 'Pendiente';
                }

                obtenerNombreDepartamento(dept) {
                    const departamentos = {
                        'aseo': 'Aseo',
                        'iluminacion': 'Iluminaci√≥n',
                        'areas-verdes': '√Åreas Verdes',
                        'mantenimiento': 'Mantenimiento'
                    };
                    return departamentos[dept] || dept;
                }

                obtenerNombreSubdepartamento(subdept) {
                    const subdepartamentos = {
                        'aseo-calles': 'Aseo de Calles',
                        'extraccion-residuos': 'Extracci√≥n de Residuos (Basura)'
                    };
                    return subdepartamentos[subdept] || subdept;
                }

                obtenerNombretrabajo(trabajodept) {
                    return trabajodept.replace(/-/g, " ");
                }

                formatearFecha(fechaISO) {
                    if (!fechaISO) return 'No disponible';
                    const fecha = new Date(fechaISO);
                    return fecha.toLocaleDateString('es-CL', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }

                actualizarEstadisticas() {

                    var pendiente = 0;
                    var enProceso = 0;
                    var resueltos = 0;
                    var total = 0;
                    var baul = "";
                    if (dato_rc.length > 0) {
                        for (var tt = 0; tt < dato_rc.length; tt++) {
                            if (dato_rc[tt][0] == "" && dato_rc[tt][1] == "") { break; }
                            if (dato_rc[tt][2] != "") {
                                baul = dato_rc[tt][2].toUpperCase();
                                if (baul == departamento) {
                                    total++;
                                    if (dato_rc[tt][1].toUpperCase() == "PENDIENTE") {
                                        pendiente++;
                                    } else if (dato_rc[tt][1].toUpperCase() == "ASIGNADO") {
                                        enProceso++;
                                    } else if (dato_rc[tt][1].toUpperCase() == "RESUELTO") {
                                        resueltos++;
                                    }
                                }
                            }
                        }
                        // const total = this.reclamos.length;
                        // const pendientes = this.reclamos.filter(r => !r.solucionado && r.estado === 'pendiente').length;
                        // const enProceso = this.reclamos.filter(r => !r.solucionado && r.estado === 'proceso').length;
                        // const resueltos = this.reclamos.filter(r => r.solucionado).length;

                        // Actualizar contadores con animaci√≥n
                        this.animarContador('totalReclamos', total);
                        this.animarContador('reclamosPendientes', pendiente);
                        this.animarContador('reclamosAsignados', enProceso);
                        this.animarContador('reclamosResueltos', resueltos);
                    }
                }

                animarContador(elementId, valorFinal) {
                    const elemento = document.getElementById(elementId);
                    if (!elemento) return;

                    const valorInicial = parseInt(elemento.textContent) || 0;
                    const duracion = 1000;
                    const pasos = 60;
                    const incremento = (valorFinal - valorInicial) / pasos;
                    let valorActual = valorInicial;
                    let contador = 0;

                    const intervalo = setInterval(() => {
                        contador++;
                        valorActual = valorInicial + (incremento * contador);

                        if (contador >= pasos) {
                            elemento.textContent = valorFinal;
                            clearInterval(intervalo);
                        } else {
                            elemento.textContent = Math.round(valorActual);
                        }
                    }, duracion / pasos);
                }

                guardarDatos() {
                    try {
                        console.log('Datos guardados:', this.reclamos);
                        console.log('Total de reclamos:', this.reclamos.length);
                        console.log('Reclamos solucionados:', this.reclamos.filter(r => r.solucionado).length);
                    } catch (error) {
                        console.error('Error al guardar datos:', error);
                    }
                }
            }

            // Funci√≥n para abrir asistencia
            function openAssistance() {
                alert('¬°Hola! Soy el asistente virtual de la Municipalidad de Arica.\n\n' +
                    '¬øEn qu√© puedo ayudarte?\n\n' +
                    '‚Ä¢ Informaci√≥n sobre c√≥mo llenar el formulario\n' +
                    '‚Ä¢ Seguimiento de tu reclamo\n' +
                    '‚Ä¢ Contacto con departamentos espec√≠ficos\n' +
                    '‚Ä¢ Horarios de atenci√≥n\n\n' +
                    'Escr√≠benos a: roberto.mamani@municipalidadarica.cl');
            }

            // Hacer disponible globalmente
            let sistemaGlobal;
            document.addEventListener('DOMContentLoaded', () => {
                sistemaGlobal = new SistemaReclamos();
                window.sistemaReclamos = sistemaGlobal;
            });

            // Funci√≥n para simular cambios de estado (para demo)
            function simularCambiosEstado() {
                const sistema = window.sistemaReclamos;
                if (sistema && sistema.reclamos.length > 0) {
                    const reclamosPendientes = sistema.reclamos.filter(r => !r.solucionado);
                    if (reclamosPendientes.length > 0) {
                        const reclamo = reclamosPendientes[Math.floor(Math.random() * reclamosPendientes.length)];
                        const estados = ['pendiente', 'proceso'];
                        const estadoActual = estados.indexOf(reclamo.estado);
                        if (estadoActual < estados.length - 1) {
                            reclamo.estado = estados[estadoActual + 1];
                            sistema.guardarDatos();
                            sistema.actualizarEstadisticas();
                            sistema.mostrarReclamos();
                        }
                    }
                }
            }
            // ************************************************************************************
            // ************************************************************************************
            // ************************************************************************************


            function abrirFormulario() {
                document.getElementById("formularioAsignacionModal").style.display = "block";
            }

            function cerrarFormulario() {
                document.getElementById("formularioAsignacionModal").style.display = "none";
            }

            function enviarFormulario() {
                const container = document.getElementById('reportsList');
                datos = container.innerHTML;
                fechasig = new Date();
                trabajad = document.getElementById("trabajador").value;
                baul = '<div class="report-info">' +
                    '<strong>Fecha de asignaci√≥n:</strong> ' + formatearFecha2(fechasig) +
                    '</div>' +
                    '<div class="report-info">' +
                    '<strong>Trabajador asignado:</strong> ' + trabajad +
                    '</div>';
                datosAsignados = baul;
                datos = datos.replace("<a></a>", baul);
                container.innerHTML = datos;
                cerrarFormulario();
            }


            function showSuggestionsTrabajador() {

                const input = document.getElementById("trabajador").value.toLowerCase();
                const suggestionsDiv = document.getElementById("suggestionsTrabajador");
                suggestionsDiv.innerHTML = '';      // Limpiar las sugerencias anteriores

                if (input && input.length > 1) {
                    const filteredJobs = tipOpera.filter(opera => opera.toLowerCase().includes(input));
                    filteredJobs.forEach(opera => {
                        const suggestionItem = document.createElement("div");
                        suggestionItem.textContent = opera;
                        suggestionItem.onclick = () => selectOpera(opera);
                        suggestionsDiv.appendChild(suggestionItem);
                    });
                }
            }

            function selectOpera(opera) {
                document.getElementById("trabajador").value = opera;
                document.getElementById("suggestionsTrabajador").innerHTML = '';   // Limpiar las sugerencias una vez seleccionado
            }

            function formatearFecha2(fechaISO) {
                if (!fechaISO) { return 'No disponible'; }
                const fecha = new Date(fechaISO);
                return fecha.toLocaleDateString('es-CL', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            function guardar_Procedencia() {
                const procedencia = document.getElementById("procedencia").value;
                localStorage.setItem('reclamos_procedencias', procedencia);
            }


            // ************************************************************************************
            // *************************************************************************************

            function enviarDatos(pagina, fila, datos, tipo) {
                fetch(WEB_APP_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pagina, fila, datos, tipo })
                })
                    .then(response => response.json())
                    .then(result => {
                        if (result.estado === "OK") {
                            var idGenerado = result.id;
                            console.log("ID Generado: ", idGenerado);

                            if (dato_rc.length > 0) {
                                dato_rc[dato_rc.length - 1][0] = idGenerado;
                            }

                            alert('Datos enviados exitosamente');
                        } else {
                            alert("Error en el servidor: " + result.mensaje);
                        }
                    })
                    .catch(error => {
                        alert('Error al enviar los datos');
                        console.error('Error:', error);
                    })
                    .finally(() => {
                        console.log('Proceso terminado');
                    });
            }

            // Variables globales para el filtrado de PDF
            let selectedFilters = {
                estados: [],
                departamentos: [],
                prioridades: []
            };

            // Funci√≥n para seleccionar todos los estados
            function selectAllEstados() {
                const checkboxes = document.querySelectorAll('#estadoCheckboxes input[type="checkbox"]');
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);

                checkboxes.forEach(checkbox => {
                    checkbox.checked = !allChecked;
                });

                updateSelection();
            }

            // Funci√≥n para seleccionar todos los departamentos
            function selectAllDepartamentos() {
                const checkboxes = document.querySelectorAll('#departamentoCheckboxes input[type="checkbox"]');
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);

                checkboxes.forEach(checkbox => {
                    checkbox.checked = !allChecked;
                });

                updateSelection();
            }

            // Funci√≥n para seleccionar todas las prioridades
            function selectAllPrioridades() {
                const checkboxes = document.querySelectorAll('#prioridadCheckboxes input[type="checkbox"]');
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);

                checkboxes.forEach(checkbox => {
                    checkbox.checked = !allChecked;
                });

                updateSelection();
            }

            // Funci√≥n para actualizar la selecci√≥n y conteo
            function updateSelection() {
                // Obtener estados seleccionados
                selectedFilters.estados = Array.from(document.querySelectorAll('#estadoCheckboxes input:checked'))
                    .map(cb => cb.value);

                // Obtener departamentos seleccionados
                selectedFilters.departamentos = Array.from(document.querySelectorAll('#departamentoCheckboxes input:checked'))
                    .map(cb => cb.value);

                // Obtener prioridades seleccionadas
                selectedFilters.prioridades = Array.from(document.querySelectorAll('#prioridadCheckboxes input:checked'))
                    .map(cb => cb.value);

                // Contar reclamos que coinciden con los filtros
                const reclamosFiltrados = filtrarReclamos();
                const count = reclamosFiltrados.length;

                // Actualizar contador
                document.getElementById('selectedCount').textContent = `Reclamos seleccionados: ${count}`;

                // Habilitar/deshabilitar bot√≥n de generar PDF
                const generateBtn = document.getElementById('generatePDFBtn');
                generateBtn.disabled = count === 0;
                generateBtn.textContent = count === 0 ? 'üìÑ Seleccione reclamos' : `üìÑ Generar PDF (${count} reclamos)`;
            }

            // Funci√≥n para filtrar reclamos seg√∫n los criterios seleccionados
            function filtrarReclamos() {
                if (!window.sistemaReclamos || !window.sistemaReclamos.reclamos) {
                    return [];
                }

                return window.sistemaReclamos.reclamos.filter(reclamo => {
                    // Filtro por estado
                    let estadoCoincide = selectedFilters.estados.length === 0;
                    if (selectedFilters.estados.includes('pendiente') && !reclamo.solucionado && reclamo.estado === 'pendiente') {
                        estadoCoincide = true;
                    }
                    if (selectedFilters.estados.includes('asignado') && !reclamo.solucionado && reclamo.estado === 'proceso') {
                        estadoCoincide = true;
                    }
                    if (selectedFilters.estados.includes('resuelto') && reclamo.solucionado) {
                        estadoCoincide = true;
                    }

                    // Filtro por departamento
                    const departamentoCoincide = selectedFilters.departamentos.length === 0 ||
                        selectedFilters.departamentos.includes(reclamo.departamento);

                    // Filtro por prioridad
                    const prioridadCoincide = selectedFilters.prioridades.length === 0 ||
                        selectedFilters.prioridades.includes(reclamo.prioridad);

                    return estadoCoincide && departamentoCoincide && prioridadCoincide;
                });
            }

            // Funci√≥n para limpiar todas las selecciones
            function clearAllSelections() {
                document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(cb => {
                    cb.checked = false;
                });
                updateSelection();
            }

            // Funci√≥n principal para generar PDF
            function generatePDF() {
                const reclamosFiltrados = filtrarReclamos();

                if (reclamosFiltrados.length === 0) {
                    alert('No hay reclamos seleccionados para generar el PDF.');
                    return;
                }

                // CORRECCI√ìN: Verificar jsPDF con diferentes formas de acceso
                let jsPDF;

                // Intentar diferentes formas de acceder a jsPDF
                if (typeof window.jspdf !== 'undefined' && window.jspdf.jsPDF) {
                    jsPDF = window.jspdf.jsPDF; // Forma m√°s com√∫n con CDN
                } else if (typeof window.jsPDF !== 'undefined') {
                    jsPDF = window.jsPDF; // Forma alternativa
                } else if (typeof jspdf !== 'undefined' && jspdf.jsPDF) {
                    jsPDF = jspdf.jsPDF; // Otra forma alternativa
                } else {
                    console.error('jsPDF no encontrado. Objeto window:', window.jspdf || window.jsPDF);
                    alert('Error: La librer√≠a jsPDF no est√° disponible. Verifique que est√© correctamente cargada.');
                    return;
                }

                try {
                    const doc = new jsPDF();

                    // Configuraci√≥n inicial
                    const pageWidth = doc.internal.pageSize.width;
                    const pageHeight = doc.internal.pageSize.height;
                    const margin = 20;
                    const lineHeight = 7;
                    let yPosition = margin;

                    // Funci√≥n para agregar nueva p√°gina si es necesario
                    function checkNewPage(requiredHeight = 20) {
                        if (yPosition + requiredHeight > pageHeight - margin) {
                            doc.addPage();
                            yPosition = margin;
                            addHeader();
                        }
                    }

                    // Funci√≥n para agregar encabezado
                    function addHeader() {
                        doc.setFontSize(16);
                        doc.setFont('helvetica', 'bold');
                        doc.text('MUNICIPALIDAD DE ARICA', pageWidth / 2, yPosition, { align: 'center' });
                        yPosition += 10;

                        doc.setFontSize(14);
                        doc.text('Sistema de Reclamos DIMAO - Reporte', pageWidth / 2, yPosition, { align: 'center' });
                        yPosition += 10;

                        doc.setFontSize(10);
                        doc.setFont('helvetica', 'normal');
                        doc.text(`Fecha de generaci√≥n: ${new Date().toLocaleDateString('es-CL')}`, pageWidth / 2, yPosition, { align: 'center' });
                        yPosition += 15;
                    }

                    // Agregar encabezado inicial
                    addHeader();

                    // Resumen de filtros aplicados
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'bold');
                    doc.text('FILTROS APLICADOS:', margin, yPosition);
                    yPosition += lineHeight;

                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'normal');

                    if (selectedFilters.estados.length > 0) {
                        doc.text(`Estados: ${selectedFilters.estados.join(', ')}`, margin, yPosition);
                        yPosition += lineHeight;
                    }

                    if (selectedFilters.departamentos.length > 0) {
                        const deptNames = selectedFilters.departamentos.map(dept => {
                            const nombres = {
                                'aseo': 'Aseo',
                                'iluminacion': 'Iluminaci√≥n',
                                'areas-verdes': '√Åreas Verdes',
                                'mantenimiento': 'Mantenimiento'
                            };
                            return nombres[dept] || dept;
                        });
                        doc.text(`Departamentos: ${deptNames.join(', ')}`, margin, yPosition);
                        yPosition += lineHeight;
                    }

                    if (selectedFilters.prioridades.length > 0) {
                        doc.text(`Prioridades: ${selectedFilters.prioridades.join(', ')}`, margin, yPosition);
                        yPosition += lineHeight;
                    }

                    yPosition += 10;

                    // Estad√≠sticas
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'bold');
                    doc.text('RESUMEN ESTAD√çSTICO:', margin, yPosition);
                    yPosition += lineHeight + 3;

                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'normal');
                    doc.text(`Total de reclamos en el reporte: ${reclamosFiltrados.length}`, margin, yPosition);
                    yPosition += lineHeight;

                    const pendientes = reclamosFiltrados.filter(r => !r.solucionado && r.estado === 'pendiente').length;
                    const asignados = reclamosFiltrados.filter(r => !r.solucionado && r.estado === 'proceso').length;
                    const resueltos = reclamosFiltrados.filter(r => r.solucionado).length;

                    doc.text(`‚Ä¢ Pendientes: ${pendientes}`, margin + 5, yPosition);
                    yPosition += lineHeight;
                    doc.text(`‚Ä¢ Asignados: ${asignados}`, margin + 5, yPosition);
                    yPosition += lineHeight;
                    doc.text(`‚Ä¢ Resueltos: ${resueltos}`, margin + 5, yPosition);
                    yPosition += 15;

                    // L√≠nea separadora
                    doc.line(margin, yPosition, pageWidth - margin, yPosition);
                    yPosition += 10;

                    // Reclamos detallados
                    doc.setFontSize(12);
                    doc.setFont('helvetica', 'bold');
                    doc.text('DETALLE DE RECLAMOS:', margin, yPosition);
                    yPosition += 10;

                    // Ordenar reclamos por fecha (m√°s recientes primero)
                    reclamosFiltrados.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

                    reclamosFiltrados.forEach((reclamo, index) => {
                        checkNewPage(50); // Verificar si necesita nueva p√°gina

                        // N√∫mero de reclamo y estado
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'bold');
                        doc.text(`${index + 1}. Reclamo #${reclamo.id} - ${reclamo.trackingNumber}`, margin, yPosition);
                        yPosition += lineHeight;

                        // Estado con color
                        doc.setFontSize(9);
                        const estado = reclamo.solucionado ? 'RESUELTO' :
                            reclamo.estado === 'proceso' ? 'ASIGNADO' : 'PENDIENTE';
                        doc.text(`Estado: ${estado}`, margin + 5, yPosition);
                        yPosition += lineHeight;

                        // Informaci√≥n del reclamo
                        doc.setFont('helvetica', 'normal');
                        const info = [
                            `Departamento: ${obtenerNombreDepartamento(reclamo.departamento)}`,
                            `Direcci√≥n: ${reclamo.direccion}`,
                            `Prioridad: ${reclamo.prioridad.charAt(0).toUpperCase() + reclamo.prioridad.slice(1)}`,
                            `Usuario: ${reclamo.nombre}`,
                            `Tel√©fono: ${reclamo.telefono || 'No proporcionado'}`,
                            `Fecha: ${formatearFechaParaPDF(reclamo.fecha)}`
                        ];

                        if (reclamo.solucionado && reclamo.fechaResolucion) {
                            info.push(`Fecha de resoluci√≥n: ${formatearFechaParaPDF(reclamo.fechaResolucion)}`);
                        }

                        info.forEach(line => {
                            checkNewPage(lineHeight);
                            doc.text(line, margin + 5, yPosition);
                            yPosition += lineHeight;
                        });

                        // Descripci√≥n
                        checkNewPage(lineHeight * 3);
                        doc.text('Descripci√≥n:', margin + 5, yPosition);
                        yPosition += lineHeight;

                        // Dividir descripci√≥n en l√≠neas para ajustar al ancho
                        const descripcionLines = doc.splitTextToSize(reclamo.descripcion, pageWidth - margin - 30);
                        descripcionLines.forEach(line => {
                            checkNewPage(lineHeight);
                            doc.text(line, margin + 10, yPosition);
                            yPosition += lineHeight;
                        });

                        yPosition += 5;

                        // L√≠nea separadora entre reclamos
                        if (index < reclamosFiltrados.length - 1) {
                            doc.line(margin, yPosition, pageWidth - margin, yPosition);
                            yPosition += 8;
                        }
                    });

                    // Pie de p√°gina en la √∫ltima p√°gina
                    yPosition += 10;
                    checkNewPage(20);
                    doc.setFontSize(8);
                    doc.setFont('helvetica', 'italic');
                    doc.text('Documento generado autom√°ticamente por el Sistema de Reclamos DIMAO',
                        pageWidth / 2, yPosition, { align: 'center' });
                    doc.text('Municipalidad de Arica - Roberto Mamani - roberto.mamani@municipalidadarica.cl',
                        pageWidth / 2, yPosition + 5, { align: 'center' });

                    // Generar nombre del archivo
                    const fecha = new Date().toISOString().split('T')[0];
                    const fileName = `Reclamos_DIMAO_${fecha}_${reclamosFiltrados.length}reclamos.pdf`;

                    // Guardar el PDF
                    doc.save(fileName);

                    // Mostrar mensaje de √©xito
                    alert(`PDF generado exitosamente!\n\nArchivo: ${fileName}\nReclamos incluidos: ${reclamosFiltrados.length}`);

                } catch (error) {
                    console.error('Error al generar PDF:', error);
                    alert('Error al generar el PDF. Por favor, int√©ntelo nuevamente.');
                }
            }

            // Funciones auxiliares
            function obtenerNombreDepartamento(dept) {
                const departamentos = {
                    'aseo': 'Aseo',
                    'iluminacion': 'Iluminaci√≥n',
                    'areas-verdes': '√Åreas Verdes',
                    'mantenimiento': 'Mantenimiento'
                };
                return departamentos[dept] || dept;
            }

            function formatearFechaParaPDF(fechaISO) {
                if (!fechaISO) return 'No disponible';
                const fecha = new Date(fechaISO);
                return fecha.toLocaleDateString('es-CL', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            // Inicializar los event listeners cuando el DOM est√© listo
            document.addEventListener('DOMContentLoaded', function () {
                // Event listeners para checkboxes
                document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', updateSelection);
                });

                // Inicializar conteo
                updateSelection();
            });

            // Hacer las funciones disponibles globalmente
            window.selectAllEstados = selectAllEstados;
            window.selectAllDepartamentos = selectAllDepartamentos;
            window.selectAllPrioridades = selectAllPrioridades;
            window.updateSelection = updateSelection;
            window.clearAllSelections = clearAllSelections;
            window.generatePDF = generatePDF; </script>
</body>

</html>