<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bodega Virtual - Toner & Tintas | Municipalidad de Arica</title>
 
    <script src="dir_formularioapps.js"></script>
    <link rel="stylesheet" href="styles_licitacion.css" />
    <meta charset="UTF-8">

    <style>
    * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f7;
            min-height: 100vh;
            color: #333;
        }

        .container1 {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            text-align: center;
            color: #4a5568;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            text-align: center;
            color: #718096;
            font-size: 1.1em;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #4a5568;
        }

        .form-group input, 
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, 
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #002fff, #201f20);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        .warehouse-map {
            background: linear-gradient(135deg, #e2e8f0 0%, #f7fafc 100%);
            border: 3px solid #4a5568;
            border-radius: 15px;
            padding: 15px;
            height: 500px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Elementos estructurales de la bodega */
        .wall {
            position: absolute;
            background: #2d3748;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }

        .wall-top { top: 0; left: 0; width: 100%; height: 8px; }
        .wall-bottom { bottom: 0; left: 0; width: 100%; height: 8px; }
        .wall-left { top: 0; left: 0; width: 8px; height: 100%; }
        .wall-right { top: 0; right: 0; width: 8px; height: 100%; }

        .aisle {
            position: absolute;
            background: repeating-linear-gradient(
                90deg,
                #cbd5e0 0px,
                #cbd5e0 2px,
                #e2e8f0 2px,
                #e2e8f0 20px
            );
            border: 1px dashed #a0aec0;
        }

        .main-aisle { top: 180px; left: 15px; width: calc(100% - 30px); height: 40px; }
        .vertical-aisle { top: 15px; left: 180px; width: 40px; height: 150px; }
        .vertical-aisle-2 { top: 15px; left: 280px; width: 40px; height: 150px; }
        .side-aisle { top: 240px; left: 15px; width: calc(100% - 30px); height: 30px; }

        .loading-dock {
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 80px;
            height: 40px;
            background: linear-gradient(45deg, #f56565, #e53e3e);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 10px;
            box-shadow: 0 2px 8px rgba(229, 62, 62, 0.3);
        }

        .office {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 60px;
            height: 50px;
            background: linear-gradient(45deg, #48bb78, #38a169);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 9px;
            box-shadow: 0 2px 8px rgba(72, 187, 120, 0.3);
        }

        /* Estanter√≠as realistas */
        .shelf {
            position: absolute;
            background: linear-gradient(45deg, #4a5568, #2d3748);
            border: 2px solid #1a202c;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 11px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .shelf::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #e2e8f0, #cbd5e0, #e2e8f0);
            border-radius: 3px 3px 0 0;
        }

        .shelf::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #e2e8f0, #cbd5e0, #e2e8f0);
            border-radius: 0 0 3px 3px;
        }

        .shelf:hover {
            background: linear-gradient(45deg, #0230ff, #000000);
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .shelf.selected {
            background: linear-gradient(45deg, #002efb, #000000);
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
        }

        /* Elementos editables */
        .editable {
            cursor: move;
            user-select: none;
            border: 2px dashed transparent;
            transition: all 0.2s ease;
        }

        .editable:hover {
            border-color: #3e5dea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .editable.dragging {
            opacity: 0.8;
            transform: scale(1.05);
            z-index: 1000;
            border-color: #e53e3e;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #667eea;
            border: 2px solid white;
            border-radius: 50%;
            cursor: nw-resize;
            display: none;
        }

        .resize-handle.bottom-right {
            bottom: -5px;
            right: -5px;
        }

        .editable:hover .resize-handle,
        .editable.selected .resize-handle {
            display: block;
        }

        .edit-controls {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            border: 1px solid #4966e6;
        }

        .edit-mode-btn {
            background: linear-gradient(45deg, #0e3afe, #131313);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .edit-mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .edit-mode-btn.active {
            background: linear-gradient(45deg, #e53e3e, #c53030);
        }

        .save-layout-btn {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .save-layout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        .reset-layout-btn {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .reset-layout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.4);
        }

        .edit-instructions {
            margin-top: 10px;
            font-size: 12px;
            color: #4a5568;
            line-height: 1.4;
        }

        /* Indicadores de productos en estanter√≠as */
        .shelf-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #e53e3e;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            border: 2px solid white;
            pointer-events: none;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .inventory-table th,
        .inventory-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .inventory-table th {
            background: #f7fafc;
            font-weight: bold;
            color: #4a5568;
        }

        .inventory-table tr:hover {
            background: #f7fafc;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
        }

        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }

        .search-bar::after {
            content: "üîç";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #c6f6d5;
            color: #2d7d32;
            border: 1px solid #9ae6b4;
        }

        .alert.error {
            background: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .zone-info {
            margin-top: 15px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        /* Estilos para el formulario existente */
        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .form-title {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
            text-align: center;
        }

        .form-section {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #4a5568;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .hidden-fields {
            display: none;
        }

        .color_suggestions {
            position: absolute;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            width: calc(100% - 24px);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 2px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .color_suggestions div {
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .color_suggestions div:hover {
            background-color: #f0f4f8;
        }

        /* Loading overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 1.5em;
            text-align: center;
        }

        .loading-message {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        /* Footer styles */
        footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .footer-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .footer-column {
            padding: 15px;
        }

        .footer-column h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }

        .footer-column p {
            color: #718096;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .social-icons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .social-icons a {
            color: #4a5568;
            font-size: 1.2em;
            text-decoration: none;
        }

        .licitaciones-list {
            list-style: none;
        }

        .licitaciones-list li {
            margin-bottom: 8px;
        }

        .licitaciones-list a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s;
        }

        .licitaciones-list a:hover {
            color: #4a5568;
            text-decoration: underline;
        }

        .footer-bottom {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
            text-align: center;
            color: #718096;
            font-size: 0.9em;
        }

       
    </style>
</head>

<body onload="iniciando()">

    <!-- Loading overlay -->
    <div id="loading-overlay">
        <div class="loading-message">Cargando datos...<br>por favor espere</div>
    </div>

    <!-- Header -->
    <div class="container">
        <header>
            <div class="top-header">
                <div class="logo">
                    <img src="logo_MUNI.png" alt="Logo Municipalidad de Arica">
                    <div class="logo-text">
                        <h1>ARICA</h1>
                        <span>MUNICIPALIDAD | mejor ciudad</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="container1">
        <div class="header">
            <h2 class="form-title">üñ®Ô∏è Bodega Virtual - T√≥ner<h3>Sistema inteligente para la gesti√≥n de insumos de impresi√≥n</h3></h2>

            <form id="formulario">
                <div class="form-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Fecha de Movimiento</label>
                            <input type="date" id="fecha" name="fecha" class="form-control" onchange="cambiarFecha()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tipo de Movimiento</label>
                            <select class="form-select" name="movimiento" id="movimiento" onchange="updateSelect()">
                                <option value="INGRESO">INGRESO</option>
                                <option value="EGRESO">EGRESO</option>
                                <option value="TRASLADO">TRASLADO</option>
                                <option value="AJUSTE">AJUSTE</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Responsable</label>
                            <input type="text" class="form-control" id="responsable" name="responsable"
                                placeholder="Ingresa el nombre del responsable" oninput="showSuggestionsResponsable()">
                            <div class="color_suggestions" id="suggestionsResponsable"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tipo de Producto</label>
                            <select class="form-select" name="tipoProducto" id="tipoProducto" onchange="cargarModelos()">
                                <option value="">Seleccione un tipo</option>
                                <option value="TONER">TONER</option>
                                <option value="TINTA">TINTA</option>
                                <option value="CARTUCHO">CARTUCHO</option>
                                <option value="DRUM">DRUM</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Modelo</label>
                            <select class="form-select" name="modelo" id="modelo">
                                <option value="">Seleccione un modelo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Cantidad</label>
                            <input class="form-control" type="number" name="cantidad" id="cantidad" value="1" min="1">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ubicaci√≥n</label>
                            <select class="form-select" name="ubicacion" id="ubicacion">
                                <option value="BODEGA CENTRAL">BODEGA CENTRAL</option>
                                <option value="DEPTO. INFORMATICA">DEPTO. INFORMATICA</option>
                                <option value="DEPTO. ADMINISTRACION">DEPTO. ADMINISTRACION</option>
                                <option value="DEPTO. FINANZAS">DEPTO. FINANZAS</option>
                                <option value="OTRA UBICACION">OTRA UBICACION</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Estado</label>
                            <select class="form-select" name="estado" id="estado">
                                <option value="NUEVO">NUEVO</option>
                                <option value="USADO">USADO</option>
                                <option value="RECARGADO">RECARGADO</option>
                                <option value="DEFECTUOSO">DEFECTUOSO</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 style="width: 100%; margin-bottom: 15px; font-size: 18px; color: #4a5568; border-bottom: 1px solid #e2e8f0; padding-bottom: 8px;">Informaci√≥n del Producto</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">N¬∞ de Serie/Lote</label>
                            <input type="text" class="form-control" id="serie" name="serie" placeholder="Ingrese n√∫mero de serie o lote">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Proveedor</label>
                            <input type="text" class="form-control" id="proveedor" name="proveedor" placeholder="Ingrese nombre del proveedor" oninput="showSuggestionsProveedor()">
                            <div class="color_suggestions" id="suggestionsProveedor"></div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Factura/OC</label>
                            <input type="text" class="form-control" id="factura" name="factura" placeholder="N¬∞ de factura u orden de compra">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3 style="width: 100%; margin-bottom: 15px; font-size: 18px; color: #4a5568; border-bottom: 1px solid #e2e8f0; padding-bottom: 8px;">Informaci√≥n Adicional</h3>

                    <div class="form-row">
                        <div class="form-group" style="flex: 1 0 100%;">
                            <label class="form-label">Observaciones</label>
                            <textarea class="form-control" name="observaciones" id="observaciones" rows="3" placeholder="Escribe tus observaciones..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Hidden fields -->
                <div class="hidden-fields">
                    <input type="text" name="fecha2" id="fecha2">
                    <input type="text" name="fecha3" id="fecha3">
                </div>

                <div class="btn-container">
                    <button class="btn btn-primary" type="button" onclick="enviarFormulario1()">Registar</button>
                    <button class="btn btn-secondary" type="button" onclick="nuevoFormulario1()">NUEVO REGISTRO</button>
                </div>
            </form>
        </div>
    </div>
      <div class="right-panel">
            <div class="card">
              <h2>üì¶ Plano de Estanter√≠as</h2>
              <div class="warehouse-map" id="warehouseMap">
                <div class="shelf shelf-l1 editable" data-zone="L1" onclick="selectZone('L1')" title="HP" style="top: 30px; left: 30px; width: 100px; height: 60px;">
                  L1<br>üî≤ HP
                  <div class="shelf-indicator" id="indicator-l1">0</div>
                  <div class="resize-handle bottom-right"></div>
                </div>
                <div class="shelf shelf-l2 editable" data-zone="L2" onclick="selectZone('L2')" title="Canon" style="top: 30px; left: 140px; width: 100px; height: 60px;">
                  L2<br>üî≤ Canon
                  <div class="shelf-indicator" id="indicator-l2">0</div>
                  <div class="resize-handle bottom-right"></div>
                </div>
                <div class="shelf shelf-l3 editable" data-zone="L3" onclick="selectZone('L3')" title="Epson" style="top: 30px; left: 250px; width: 100px; height: 60px;">
                  L3<br>üî≤ Epson
                  <div class="shelf-indicator" id="indicator-l3">0</div>
                  <div class="resize-handle bottom-right"></div>
                </div>
                <div class="shelf shelf-l4 editable" data-zone="L4" onclick="selectZone('L4')" title="Brother" style="top: 110px; left: 30px; width: 100px; height: 60px;">
                  L4<br>üî≤ Brother
                  <div class="shelf-indicator" id="indicator-l4">0</div>
                  <div class="resize-handle bottom-right"></div>
                </div>
                <div class="shelf shelf-l5 editable" data-zone="L5" onclick="selectZone('L5')" title="Samsung" style="top: 110px; left: 140px; width: 100px; height: 60px;">
                  L5<br>üî≤ Samsung
                  <div class="shelf-indicator" id="indicator-l5">0</div>
                  <div class="resize-handle bottom-right"></div>
                </div>
                <div class="shelf shelf-l6 editable" data-zone="L6" onclick="selectZone('L6')" title="Xerox" style="top: 110px; left: 250px; width: 100px; height: 60px;">
                  L6<br>üî≤ Xerox
                  <div class="shelf-indicator" id="indicator-l6">0</div>
                  <div class="resize-handle bottom-right"></div>
                </div>
                <div class="shelf shelf-l7 editable" data-zone="L7" onclick="selectZone('L7')" title="Otros" style="top: 190px; left: 30px; width: 100px; height: 60px;">
                  L7<br>üî≤ Otros
                  <div class="shelf-indicator" id="indicator-l7">0</div>
                  <div class="resize-handle bottom-right"></div>
                </div>
              </div>
           
    
       
                    <div class="zone-info" id="zoneInfo">
                        <strong>üè≠ Bodega de Iluminaci√≥n Virtual</strong><br>
                        <small>‚Ä¢ Haz clic en cualquier estanter√≠a para ver los productos almacenados<br>
                        ‚Ä¢ Los n√∫meros rojos indican la cantidad de productos en cada zona<br>
                        ‚Ä¢ Activa el modo edici√≥n para personalizar el dise√±o de tu bodega</small>
                    </div>
                </div>
 <!-- Controles de edici√≥n -->
 <div class="edit-controls">
    <button class="edit-mode-btn" id="editModeBtn" onclick="toggleEditMode()">
        ‚úèÔ∏è Activar Modo Edici√≥n
    </button>
    <button class="save-layout-btn" onclick="saveLayout()">
        üíæ Guardar Dise√±o
    </button>
    <button class="reset-layout-btn" onclick="resetLayout()">
        üîÑ Restaurar Original
    </button>
    <div class="edit-instructions" id="editInstructions" style="display: none;">
        <strong>Modo Edici√≥n Activo:</strong><br>
        ‚Ä¢ Arrastra cualquier elemento para moverlo<br>
        ‚Ä¢ Usa los puntos azules en las esquinas para redimensionar<br>
        ‚Ä¢ Haz clic fuera del elemento para deseleccionarlo<br>
        ‚Ä¢ Los cambios se guardan autom√°ticamente
    </div>
</div>
    
            </div>
        </div>
    </div>
<!-- Secci√≥n de Inventario Visual - Agregar despu√©s del formulario -->
<div class="container1" style="margin-top: 30px;">
    <div class="header">
        <h2 class="form-title">üìã Inventario Visual de T√≥ner</h2>
        <h3>Consulta y gesti√≥n de productos en tiempo real</h3>
        
        <!-- Controles de b√∫squeda y filtros -->
        <div class="form-section">
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">üîç Buscar Producto</label>
                    <input type="text" id="buscarProducto" class="form-control" 
                           placeholder="Buscar por modelo, c√≥digo o tipo..." 
                           oninput="filtrarInventario()">
                </div>
                <div class="form-group">
                    <label class="form-label">Filtrar por Tipo</label>
                    <select id="filtroTipo" class="form-select" onchange="filtrarInventario()">
                        <option value="">Todos los productos</option>
                        <option value="TONER">TONER</option>
                        <option value="TINTA">TINTA</option>
                        <option value="CARTUCHO">CARTUCHO</option>
                        <option value="DRUM">DRUM</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Filtrar por Zona</label>
                    <select id="filtroZona" class="form-select" onchange="filtrarInventario()">
                        <option value="">Todas las zonas</option>
                        <option value="L1">L1 - HP</option>
                        <option value="L2">L2 - Canon</option>
                        <option value="L3">L3 - Epson</option>
                        <option value="L4">L4 - Brother</option>
                        <option value="L5">L5 - Samsung</option>
                        <option value="L6">L6 - Xerox</option>
                        <option value="L7">L7 - Otros</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <button class="btn btn-primary" onclick="cargarInventario()">üîÑ Actualizar Inventario</button>
                </div>
                <div class="form-group">
                    <button class="btn btn-secondary" onclick="exportarInventario()">üìÑ Exportar a Excel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Resumen de inventario -->
    <div class="form-section">
        <div class="form-row">
            <div class="form-group" style="text-align: center; background: #e8f5e8; padding: 15px; border-radius: 8px;">
                <h4>üìä Resumen del Inventario</h4>
                <p><strong>Total de productos:</strong> <span id="totalProductos">0</span></p>
                <p><strong>Productos disponibles:</strong> <span id="productosDisponibles">0</span></p>
                <p><strong>Stock bajo (‚â§5):</strong> <span id="stockBajo">0</span></p>
            </div>
        </div>
    </div>

    <!-- Tabla de inventario -->
    <div class="form-section">
        <div style="overflow-x: auto;">
            <table id="tablaInventario" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                <thead>
                    <tr style="background-color: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                        <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">C√≥digo</th>
                        <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">Modelo</th>
                        <th style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">Cantidad</th>
                        <th style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">Zona</th>
                        <th style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">Tipo</th>
                        <th style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">Estado</th>
                        <th style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">√öltima Act.</th>
                        <th style="padding: 12px; text-align: center; border: 1px solid #dee2e6;">Acciones</th>
                    </tr>
                </thead>
                <tbody id="cuerpoTablaInventario">
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #6c757d;">
                            üì¶ Cargando inventario... Haz clic en "Actualizar Inventario"
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Paginaci√≥n -->
    <div class="form-section">
        <div class="form-row" style="justify-content: center; align-items: center;">
            <div class="form-group">
                <button class="btn btn-secondary" id="btnAnterior" onclick="cambiarPagina(-1)" disabled>‚Üê Anterior</button>
            </div>
            <div class="form-group">
                <span id="infoPaginacion" style="margin: 0 15px; font-weight: bold;">P√°gina 1 de 1</span>
            </div>
            <div class="form-group">
                <button class="btn btn-secondary" id="btnSiguiente" onclick="cambiarPagina(1)" disabled>Siguiente ‚Üí</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para detalles del producto -->
<div id="modalDetalle" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
        <h3 style="margin-bottom: 20px; color: #2c3e50;">üì¶ Detalles del Producto</h3>
        <div id="contenidoDetalle"></div>
        <div style="text-align: center; margin-top: 20px;">
            <button class="btn btn-secondary" onclick="cerrarModal()">Cerrar</button>
        </div>
    </div>
</div>



    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-column">
                <h3>Municipalidad de Arica</h3>
                <p>Renato Rocca , Arica</p>
                <p>Anexo:6959 </p>
                <p>Email:roberto.mamani@municipalidadarica.cl </p>
                <div class="social-icons">
                    <a href="#">üìò</a>
                    <a href="#">üì±</a>
                    <a href="#">üê¶</a>
                    <a href="#">üì∏</a>
                </div>
            </div>
            <div class="footer-column">
                <h3>Colaboraci√≥n Interdepartamental</h3>
                <p style="line-height: 1.6;">
                    Este proyecto surge con el prop√≥sito de fortalecer la colaboraci√≥n entre diversas √°reas municipales,
                    como <strong>inform√°tica</strong>, <strong>compras</strong>, <strong>administraci√≥n</strong>, 
                    <strong>finanzas</strong> y m√°s, en un solo sistema integral.
                    Buscando consolidar la informaci√≥n y los procesos en un solo sistema, permitiendo un <strong>mayor
                        control operativo</strong>, <strong>gesti√≥n por √°reas</strong> y una visi√≥n integral para la
                    <strong>mejora continua de los servicios municipales</strong>.
                </p>
            </div>
            <div class="footer-column licitaciones">
                <h3>Licitaciones</h3>
                <ul class="licitaciones-list">
                    <li><a href="licitacion_agil.html">Licitaci√≥n √Ågil</a></li>
                    <li><a href="licitacion_gran_compra.html">Gran Compra</a></li>
                    <li><a href="licitacion_trato_directo.html">Trato Directo</a></li>
                    <li><a href="licitacion_publica.html">Licitaci√≥n P√∫blica</a></li>
                    <li><a href="licitacion_convenio_marco.html">Convenio Marco</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2025 Municipalidad de Arica. Todos los derechos reservados.</p>
            <p>Desarrollado por Junior Barrera</p>
        </div>
    </footer>

    <script>
        mostrarCargando_1(1);

        var nuevo = new Array();         // Array para guardar los datos del formulario
        var maxId = 0;                   // Variable para el n√∫mero de control (ahora no se usa)
        var ultimoId = 0;                // Para evitar duplicados (ahora no se usa)

        // Arrays para autocompletar
        var tipResponsable = new Array();      // Listado de Responsables
        var tipProveedor = new Array();        // Listado de Proveedores
        var modelosToner = new Array();        // Modelos de Toner
        var modelosTinta = new Array();        // Modelos de Tinta
        var modelosCartucho = new Array();     // Modelos de Cartucho
        var modelosDrum = new Array();         // Modelos de Drum

        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby3GLsAo6ysbZABunaohdAx8Tu923lvdxwBc9kdQR87uLUpop3B8Nw1LqLL00hElBA6DQ/exec";     // Implementacion
        // const WEB_APP_URL = dir_mec;

        document.addEventListener('DOMContentLoaded', function () {
            mostrarFormulario();
        });

        function mostrarFormulario() {
            var modalContainer = document.getElementById('modalContainer');
            var modalContent = document.getElementById('modalContent');
            setTimeout(function () {
                // modalContent.classList.add('show');
            }, 100);
        }

        function iniciando() {
            document.getElementById("fecha").value = obtenerFechaActual();
            cambiarFecha();
            cargarDatosGenerales();
            cargarModelosPredefinidos();
        }

        function cambiarFecha() {
            fech99 = document.getElementById("fecha").value;
            document.getElementById("fecha2").value = fech99;
            const fechaInput = fech99;

            if (fechaInput) {
                // Dividir la fecha en a√±o, mes y d√≠a
                const [year, month, day] = fechaInput.split('-');

                // Reorganizar la fecha en formato dd-mm-aaaa
                const fechaFormateada = `${day}-${month}-${year}`;

                // Colocar la fecha formateada en el input fecha3
                document.getElementById("fecha3").value = fechaFormateada;
            }
        }

        function cargarDatosGenerales() {
            fetch(WEB_APP_URL + "?h=INVENTARIO")
                .then(response => response.json())
                .then(data => {
                    mostrarCargando_1(0);

                    // Cargar datos de responsables y proveedores
                    if (data.responsables && data.responsables.length > 0) {
                        tipResponsable = data.responsables;
                    }

                    if (data.proveedores && data.proveedores.length > 0) {
                        tipProveedor = data.proveedores;
                    }
                })
                .catch(error => {
                    console.error('Error al obtener los datos:', error);
                });
        }

        function cargarModelosPredefinidos() {
            // Modelos de Toner predefinidos (pueden cargarse desde la base de datos)
            modelosToner = [
                "HP 85A (CF285A)",
                "HP 83A (CF283A)",
                "HP 36A (Q2612A)",
                "SAMSUNG MLT-D101S",
                "LEXMARK CS410/CS510"
            ];

            // Modelos de Tinta predefinidos
            modelosTinta = [
                "HP 664XL Negro",
                "HP 664XL Tricolor",
                "CANON PG-245 Negro",
                "CANON CL-246 Color",
                "EPSON 252 Negro"
            ];

            // Modelos de Cartucho predefinidos
            modelosCartucho = [
                "HP 123 Negro",
                "HP 123 Tricolor",
                "CANON 245 Negro",
                "CANON 246 Color"
            ];

            // Modelos de Drum predefinidos
            modelosDrum = [
                "HP 85X (CF285X)",
                "HP 83X (CF283X)",
                "HP 36X (Q2612X)"
            ];
        }

        function cargarModelos() {
            var tipoProducto = document.getElementById("tipoProducto").value;
            var selectModelo = document.getElementById("modelo");
            
            // Limpiar select
            selectModelo.innerHTML = '';
            
            // Agregar opci√≥n por defecto
            var defaultOption = document.createElement('option');
            defaultOption.value = "";
            defaultOption.text = "Seleccione un modelo";
            selectModelo.appendChild(defaultOption);
            
            // Cargar modelos seg√∫n el tipo de producto seleccionado
            if (tipoProducto === "TONER" && modelosToner.length > 0) {
                modelosToner.forEach(function(modelo) {
                    var option = document.createElement('option');
                    option.value = modelo;
                    option.text = modelo;
                    selectModelo.appendChild(option);
                });
            } else if (tipoProducto === "TINTA" && modelosTinta.length > 0) {
                modelosTinta.forEach(function(modelo) {
                    var option = document.createElement('option');
                    option.value = modelo;
                    option.text = modelo;
                    selectModelo.appendChild(option);
                });
            } else if (tipoProducto === "CARTUCHO" && modelosCartucho.length > 0) {
                modelosCartucho.forEach(function(modelo) {
                    var option = document.createElement('option');
                    option.value = modelo;
                    option.text = modelo;
                    selectModelo.appendChild(option);
                });
            } else if (tipoProducto === "DRUM" && modelosDrum.length > 0) {
                modelosDrum.forEach(function(modelo) {
                    var option = document.createElement('option');
                    option.value = modelo;
                    option.text = modelo;
                    selectModelo.appendChild(option);
                });
            }
        }

        function enviarFormulario1() {
            var error = 0;
            var terror = new Array();

            // Validar campos obligatorios
            if (document.getElementById("tipoProducto").value == "") { terror[error] = "falta el tipo de producto"; error++; }
            if (document.getElementById("modelo").value == "") { terror[error] = "falta el modelo"; error++; }
            if (document.getElementById("cantidad").value == "" || parseInt(document.getElementById("cantidad").value) <= 0) { 
                terror[error] = "la cantidad debe ser mayor a 0"; error++; 
            }
            if (document.getElementById("responsable").value == "") { terror[error] = "falta el responsable"; error++; }

            if (error == 0) {
                // Preparar datos para enviar (sin n√∫mero de control)
                nuevo[0] = transformarFecha(document.getElementById("fecha").value);
                nuevo[1] = (document.getElementById("movimiento").value).toString().toUpperCase();
                nuevo[2] = (document.getElementById("tipoProducto").value).toString().toUpperCase();
                nuevo[3] = (document.getElementById("modelo").value).toString().toUpperCase();
                nuevo[4] = (document.getElementById("cantidad").value).toString();
                nuevo[5] = (document.getElementById("ubicacion").value).toString().toUpperCase();
                nuevo[6] = (document.getElementById("serie").value).toString().toUpperCase();
                nuevo[7] = (document.getElementById("estado").value).toString().toUpperCase();
                nuevo[8] = (document.getElementById("proveedor").value).toString().toUpperCase();
                nuevo[9] = (document.getElementById("factura").value).toString().toUpperCase();
                nuevo[10] = (document.getElementById("responsable").value).toString().toUpperCase();
                nuevo[11] = (document.getElementById("observaciones").value).toString().toUpperCase();

                enviarDatos("INVENTARIO", 0, nuevo, 1);
                
                // Mostrar mensaje de √©xito y desplazarse al inicio
                alert("Registro guardado exitosamente");
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                var mensajeError = "ERROR - Falta rellenar los siguientes campos:";
                for (var i = 0; i < terror.length; i++) {
                    mensajeError += "\n - " + terror[i];
                }
                alert(mensajeError);
            }
        }

        function enviarDatos(pagina, fila, datos, tipo) {
            fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ pagina, fila, datos, tipo })
            })
            .then(() => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            })
            .catch(error => {
                alert('Error al enviar los datos');
            });
        }

        function nuevoFormulario1() {
            // Limpiar campos del formulario
            document.getElementById("fecha").value = obtenerFechaActual();
            document.getElementById("movimiento").selectedIndex = 0;
            document.getElementById("tipoProducto").selectedIndex = 0;
            document.getElementById("modelo").innerHTML = '<option value="">Seleccione un modelo</option>';
            document.getElementById("cantidad").value = "1";
            document.getElementById("ubicacion").selectedIndex = 0;
            document.getElementById("serie").value = "";
            document.getElementById("estado").selectedIndex = 0;
            document.getElementById("proveedor").value = "";
            document.getElementById("factura").value = "";
            document.getElementById("responsable").value = "";
            document.getElementById("observaciones").value = "";

            // Desplazarse al inicio
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Mostrar mensaje
            alert("Formulario listo para un nuevo registro");
        }

        function updateSelect() {
            // Puedes agregar l√≥gica adicional aqu√≠ si es necesario
        }

        function mostrarCargando_1(nn) {
            var overlay = document.getElementById('loading-overlay');
            if (nn == 1) { overlay.style.visibility = 'visible'; }
            if (nn == 0) { overlay.style.visibility = 'hidden'; }
        }

        // Funciones para autocompletar
        function showSuggestionsResponsable() {
            const input = document.getElementById("responsable").value.toLowerCase();
            const suggestionsDiv = document.getElementById("suggestionsResponsable");
            suggestionsDiv.innerHTML = '';

            if (input) {
                const filtered = tipResponsable.filter(item => item.toLowerCase().includes(input));

                filtered.forEach(item => {
                    const suggestionItem = document.createElement("div");
                    suggestionItem.textContent = item;
                    suggestionItem.onclick = () => {
                        document.getElementById("responsable").value = item;
                        suggestionsDiv.innerHTML = '';
                    };
                    suggestionsDiv.appendChild(suggestionItem);
                });
            }
        }

        function showSuggestionsProveedor() {
            const input = document.getElementById("proveedor").value.toLowerCase();
            const suggestionsDiv = document.getElementById("suggestionsProveedor");
            suggestionsDiv.innerHTML = '';

            if (input) {
                const filtered = tipProveedor.filter(item => item.toLowerCase().includes(input));

                filtered.forEach(item => {
                    const suggestionItem = document.createElement("div");
                    suggestionItem.textContent = item;
                    suggestionItem.onclick = () => {
                        document.getElementById("proveedor").value = item;
                        suggestionsDiv.innerHTML = '';
                    };
                    suggestionsDiv.appendChild(suggestionItem);
                });
            }
        }

        // Funci√≥n para formatear fecha
        function transformarFecha(fechaInput) {
            if (!fechaInput) return "";
            
            const fecha = new Date(fechaInput);
            fecha.setHours(fecha.getHours() + 12);
            
            const dia = String(fecha.getDate()).padStart(2, '0');
            const mes = String(fecha.getMonth() + 1).padStart(2, '0');
            const ano = String(fecha.getFullYear());
            
            return `${dia}/${mes}/${ano}`;
        }

        function obtenerFechaActual() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        // Variables para el modo edici√≥n
let editMode = false;
let selectedShelf = null;
let isDragging = false;
let startX, startY, startLeft, startTop, startWidth, startHeight;

// Funci√≥n para seleccionar una zona/estanter√≠a
function selectZone(zoneId) {
    if (editMode) {
        // En modo edici√≥n, seleccionamos el elemento para mover/redimensionar
        if (selectedShelf) {
            selectedShelf.classList.remove('selected');
        }
        selectedShelf = document.querySelector(`.shelf-${zoneId.toLowerCase()}`);
        selectedShelf.classList.add('selected');
    } else {
        // En modo normal, mostramos los productos de esa zona
        mostrarProductosEnZona(zoneId);
    }
}

// Funci√≥n para alternar el modo edici√≥n
function toggleEditMode() {
    editMode = !editMode;
    const btn = document.getElementById('editModeBtn');
    const instructions = document.getElementById('editInstructions');
    
    if (editMode) {
        btn.innerHTML = '‚úèÔ∏è Desactivar Modo Edici√≥n';
        btn.classList.add('active');
        instructions.style.display = 'block';
        
        // Mostrar todos los handles de redimensionamiento
        document.querySelectorAll('.resize-handle').forEach(handle => {
            handle.style.display = 'block';
        });
    } else {
        btn.innerHTML = '‚úèÔ∏è Activar Modo Edici√≥n';
        btn.classList.remove('active');
        instructions.style.display = 'none';
        
        // Ocultar todos los handles de redimensionamiento
        document.querySelectorAll('.resize-handle').forEach(handle => {
            handle.style.display = 'none';
        });
        
        // Deseleccionar cualquier estanter√≠a seleccionada
        if (selectedShelf) {
            selectedShelf.classList.remove('selected');
            selectedShelf = null;
        }
    }
}

// Funci√≥n para guardar el dise√±o actual en la base de datos
function saveLayout() {
    const shelves = document.querySelectorAll('.shelf');
    const layoutData = [];
    
    shelves.forEach(shelf => {
        const zone = shelf.getAttribute('data-zone');
        const style = window.getComputedStyle(shelf);
        const position = {
            zone,
            top: style.top,
            left: style.left,
            width: style.width,
            height: style.height
        };
        layoutData.push(position);
    });
    
    // Enviar datos al servidor
    fetch(WEB_APP_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            pagina: "LAYOUT", 
            fila: 0, 
            datos: layoutData, 
            tipo: 1 
        })
    })
    .then(() => {
        alert('Dise√±o guardado exitosamente');
    })
    .catch(error => {
        alert('Error al guardar el dise√±o');
    });
}

// Funci√≥n para restaurar el dise√±o original
function resetLayout() {
    if (confirm('¬øEst√°s seguro de que deseas restaurar el dise√±o original? Esto no afectar√° los productos, solo la disposici√≥n de las estanter√≠as.')) {
        fetch(WEB_APP_URL + "?h=RESET_LAYOUT")
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    cargarLayout();
                    alert('Dise√±o restaurado exitosamente');
                }
            })
            .catch(error => {
                alert('Error al restaurar el dise√±o');
            });
    }
}

// Funci√≥n para cargar el layout desde la base de datos
function cargarLayout() {
    fetch(WEB_APP_URL + "?h=LAYOUT")
        .then(response => response.json())
        .then(data => {
            if (data && data.length > 0) {
                data.forEach(shelf => {
                    const shelfElement = document.querySelector(`.shelf-${shelf.zone.toLowerCase()}`);
                    if (shelfElement) {
                        shelfElement.style.top = shelf.top;
                        shelfElement.style.left = shelf.left;
                        shelfElement.style.width = shelf.width;
                        shelfElement.style.height = shelf.height;
                    }
                });
            }
        })
        .catch(error => {
            console.error('Error al cargar el layout:', error);
        });
}

// Funci√≥n para mostrar productos en una zona espec√≠fica
function mostrarProductosEnZona(zoneId) {
    fetch(WEB_APP_URL + "?h=PRODUCTOS_ZONA&zona=" + zoneId)
        .then(response => response.json())
        .then(data => {
            let message = `Productos en zona ${zoneId}:\n\n`;
            
            if (data && data.length > 0) {
                data.forEach(producto => {
                    message += `‚Ä¢ ${producto.modelo} (${producto.cantidad} unidades)\n`;
                    message += `  Estado: ${producto.estado}\n`;
                    message += `  Serie: ${producto.serie || 'N/A'}\n\n`;
                });
            } else {
                message += "No hay productos en esta zona.";
            }
            
            alert(message);
        })
        .catch(error => {
            console.error('Error al obtener productos:', error);
            alert('Error al cargar los productos de esta zona');
        });
}

// Funci√≥n para actualizar los contadores de productos por zona
function actualizarContadores() {
    fetch(WEB_APP_URL + "?h=CONTADORES_ZONAS")
        .then(response => response.json())
        .then(data => {
            if (data) {
                Object.keys(data).forEach(zone => {
                    const indicator = document.getElementById(`indicator-${zone.toLowerCase()}`);
                    if (indicator) {
                        indicator.textContent = data[zone];
                    }
                });
            }
        })
        .catch(error => {
            console.error('Error al actualizar contadores:', error);
        });
}

// Event listeners para arrastrar y redimensionar
document.addEventListener('DOMContentLoaded', function() {
    const warehouseMap = document.getElementById('warehouseMap');
    
    // Cargar el layout y los contadores al iniciar
    cargarLayout();
    actualizarContadores();
    
    // Event listeners para arrastrar estanter√≠as
    warehouseMap.addEventListener('mousedown', function(e) {
        if (!editMode) return;
        
        const target = e.target.closest('.editable');
        if (target && target.classList.contains('shelf')) {
            isDragging = true;
            selectedShelf = target;
            selectedShelf.classList.add('selected', 'dragging');
            
            startX = e.clientX;
            startY = e.clientY;
            startLeft = parseInt(selectedShelf.style.left || '0');
            startTop = parseInt(selectedShelf.style.top || '0');
            
            e.preventDefault();
        }
    });
    
    document.addEventListener('mousemove', function(e) {
        if (!isDragging || !selectedShelf) return;
        
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        
        selectedShelf.style.left = (startLeft + dx) + 'px';
        selectedShelf.style.top = (startTop + dy) + 'px';
    });
    
    document.addEventListener('mouseup', function() {
        if (isDragging && selectedShelf) {
            selectedShelf.classList.remove('dragging');
            isDragging = false;
        }
    });
    
    // Event listeners para redimensionar
    warehouseMap.addEventListener('mousedown', function(e) {
        if (!editMode) return;
        
        const handle = e.target.closest('.resize-handle');
        if (handle && selectedShelf) {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            startWidth = parseInt(selectedShelf.style.width || '0');
            startHeight = parseInt(selectedShelf.style.height || '0');
            
            e.preventDefault();
        }
    });
    
    document.addEventListener('mousemove', function(e) {
        if (!isDragging || !selectedShelf || !e.target.closest('.resize-handle')) return;
        
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        
        selectedShelf.style.width = (startWidth + dx) + 'px';
        selectedShelf.style.height = (startHeight + dy) + 'px';
    });
});

    </script>
</body>
</html>